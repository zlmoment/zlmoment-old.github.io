<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    

    <title>
      Make Your Program | Hackecho 
    </title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    
      <meta name="author" content="Zhaoyu Li">
    
    
      <meta name="description" content="这学期选了两门挺有意思的课，一门叫Programming High Performance Computing，还有一门Parallel and Distributed Processing。两周刚刚上下来，感觉传递的知识量有我之前悠哉悠哉一学期学到的都多。不知道是美国本科生的基础好还是美国大学的教育好，同班的美国同学接受这些知识看起来都毫无压力。不过语言确实是一个因素，比如HPC的老师两节课讲了">
    

    <meta name="description" content="这学期选了两门挺有意思的课，一门叫Programming High Performance Computing，还有一门Parallel and Distributed Processing。两周刚刚上下来，感觉传递的知识量有我之前悠哉悠哉一学期学到的都多。不知道是美国本科生的基础好还是美国大学的教育好，同班的美国同学接受这些知识看起来都毫无压力。不过语言确实是一个因素，比如HPC的老师两节课讲了">
<meta property="og:type" content="article">
<meta property="og:title" content="Make Your Program | Hackecho">
<meta property="og:url" content="http://hackecho.com/2013/02/make-your-program/">
<meta property="og:site_name" content="Hackecho">
<meta property="og:description" content="这学期选了两门挺有意思的课，一门叫Programming High Performance Computing，还有一门Parallel and Distributed Processing。两周刚刚上下来，感觉传递的知识量有我之前悠哉悠哉一学期学到的都多。不知道是美国本科生的基础好还是美国大学的教育好，同班的美国同学接受这些知识看起来都毫无压力。不过语言确实是一个因素，比如HPC的老师两节课讲了">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Make Your Program | Hackecho">
<meta name="twitter:description" content="这学期选了两门挺有意思的课，一门叫Programming High Performance Computing，还有一门Parallel and Distributed Processing。两周刚刚上下来，感觉传递的知识量有我之前悠哉悠哉一学期学到的都多。不知道是美国本科生的基础好还是美国大学的教育好，同班的美国同学接受这些知识看起来都毫无压力。不过语言确实是一个因素，比如HPC的老师两节课讲了">

    
    
    
      <link rel="icon" type="image/x-icon" href="/favicon.png">
    
    <link rel="stylesheet" href="/css/uno.css" type="text/css">


    <script src="/js/jquery.min.js"></script>

</head>
<body>

    <span class="mobile btn-mobile-menu">
        <i class="icon icon-list btn-mobile-menu__icon"></i>
        <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
    </span>

    

<header class="panel-cover panel-cover--collapsed">



  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        

        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage">Hackecho</a></h1>

        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">
          Blog by Zhaoyu Li
        </p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">

              
                
                <li class="navigation__item"><a href="/#blog" title="" class="blog-button">Blogs</a></li>
              
                
                <li class="navigation__item"><a href="/about" title="" class="">About</a></li>
              
                
                <li class="navigation__item"><a href="/projects" title="" class="">Projects</a></li>
              
                
                <li class="navigation__item"><a href="https://github.com/zlmoment/Leetcode-Solutions" title="" class="">LeetCode</a></li>
              

            </ul>
          </nav>

          <!-- ----------------------------
To add a new social icon simply duplicate one of the list items from below
and change the class in the <i> tag to match the desired social network
and then add your link to the <a>. Here is a full list of social network
classes that you can use:

    icon-social-500px
    icon-social-behance
    icon-social-delicious
    icon-social-designer-news
    icon-social-deviant-art
    icon-social-digg
    icon-social-dribbble
    icon-social-facebook
    icon-social-flickr
    icon-social-forrst
    icon-social-foursquare
    icon-social-github
    icon-social-google-plus
    icon-social-hi5
    icon-social-instagram
    icon-social-lastfm
    icon-social-linkedin
    icon-social-medium
    icon-social-myspace
    icon-social-path
    icon-social-pinterest
    icon-social-rdio
    icon-social-reddit
    icon-social-skype
    icon-social-spotify
    icon-social-stack-overflow
    icon-social-steam
    icon-social-stumbleupon
    icon-social-treehouse
    icon-social-tumblr
    icon-social-twitter
    icon-social-vimeo
    icon-social-xbox
    icon-social-yelp
    icon-social-youtube
    icon-social-zerply
    icon-mail

------------------------------ -->

<nav class="cover-navigation navigation--social">
  <ul class="navigation">


  <!-- Github -->
  <li class="navigation__item">
    <a href="https://github.com/zlmoment" title="Zhaoyu Li on GitHub">
      <i class='icon icon-social-github'></i>
      <span class="label">GitHub</span>
    </a>
  </li>
  <li class="navigation__item">
    <a href="http://www.linkedin.com/pub/zhaoyu-li/63/65/950/" title="Zhaoyu Li on LinkedIn">
      <i class='icon icon-social-linkedin'></i>
      <span class="label">LinkedIn</span>
    </a>
  </li>

  </ul>
</nav>

        </div>

      </div>

    </div>

    <div class="panel-cover--overlay cover-aqua"></div>
  </div>
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner entry">
            

  <article class="post-container post-container--single">

    <header class="post-header">
    
      
      <div class="post-meta">
        <time datetime="Feb 5 2013" class="post-meta__date date">Feb 5 2013</time> &#8226; 

        <span class="post-meta__tags tags">

            <font class="categories">
              
            </font>
            
              <font class="tags">
                <a class="tags-link" href="/tags/makefile/">makefile</a>
              </font>
            

        </span>
      </div>
      

      <h1 class="post-title">Make Your Program</h1>
    </header>

    <section class="post">
      <p>这学期选了两门挺有意思的课，一门叫Programming High Performance Computing，还有一门Parallel and Distributed Processing。两周刚刚上下来，感觉传递的知识量有我之前悠哉悠哉一学期学到的都多。不知道是美国本科生的基础好还是美国大学的教育好，同班的美国同学接受这些知识看起来都毫无压力。不过语言确实是一个因素，比如HPC的老师两节课讲了几十个英文缩写，还都与电路有关，感觉回到了当年狂补计算机组成原理的时候。这些英文缩写估计对于美国学生接受起来要更好一点吧。我只有更努力了。</p>
<p>重新好好学习一下以前的知识，认真记住。PDP的教授第一节课说了一句话让我印象非常深刻，他说：“They value you not because what you can search but what you can do.”其实非常羡慕老教授课堂上信手拈来的各种复杂代码和命令参数，只靠Google是不行的。</p>
<p>本篇博客就来复习一下Makefile吧，这两门课每次交作业都要求必须包含Makefile，就像HPC的Slides中说的：“Real programmers use Makefiles!”</p>
<h3 id="Outline">Outline</h3>
<ul>
<li><p>What’s Makefile</p>
</li>
<li><p>Generating Multiple Targets</p>
</li>
<li><p>Macros</p>
</li>
</ul>
<h3 id="What’s_Makefile">What’s Makefile</h3>
<p>Under the UNIX shell, make is a command generator. The makefile is a description file which creates a sequence of commands for execution by the UNIX shell.</p>
<p>Generally, a program is built from one or more files and each of these files may have other files as prerequisites in turn. In a makefile, the prerequisites should be carefully stated. There are two important types of lines in a description file. A dependency line or rule line contains a colon, and a command line always starts <strong>with a tab</strong>.</p>
<p>To the left of the colon on the dependency line is a target; to the right of the colon are the target’s prerequisites. If myprog has prerequisites a.c and b.c, we have</p>
<pre><code> myprog :  a.<span class="built_in">c</span>  b.<span class="built_in">c</span>
</code></pre><p>The command lines just tells make how to make the target. For example,</p>
<pre><code> myprog : a.<span class="built_in">c</span> b.<span class="built_in">c</span>
      gcc -o myprog a.<span class="built_in">c</span> b.<span class="built_in">c</span>
</code></pre><p>Then, type <code>make</code>, the UNIX prompt will excute the command as you typed.</p>
<h3 id="Generating_Multiple_Targets">Generating Multiple Targets</h3>
<p>If we want to generate more than one programs, for example, let program prog01 depend on a.c and b.c, prog02 depend on m.c and n.c, and prog03 depend on u.c, v.c and w.c. </p>
<pre><code> all : prog01 prog02 prog03

 prog01 : a.<span class="built_in">c</span> b.<span class="built_in">c</span>
      gcc -o prog01 a.<span class="built_in">c</span> b.<span class="built_in">c</span>

 prog02 : m.<span class="built_in">c</span> n.<span class="built_in">c</span>
      gcc -o prog02 m.<span class="built_in">c</span> n.<span class="built_in">c</span>

 prog03 : u.<span class="built_in">c</span> v.<span class="built_in">c</span> w.<span class="built_in">c</span>
      gcc -o prog03 u.<span class="built_in">c</span> v.<span class="built_in">c</span> w.<span class="built_in">c</span>
</code></pre><p>Thus, if one of these three programs is not up-to-date, <code>all</code> will be generated which in turn causes all programs compiled. If the dependency line defining <code>all</code> is the first line of your Makefile, just type <code>make</code> will be the same as typing <code>make all</code>.</p>
<h3 id="Macros">Macros</h3>
<p>A macro definition is a line containing an equal sign (=). When make encounters a name that appears to the left of the equal sign, that name is replaced by the contents to the right of the equal sign. It is not necessary to delimit the text string with double quote (“) or single quote (‘). If they are used, they become part of the text string.</p>
<p>If we have the macro definition as follows,</p>
<pre><code><span class="attribute"> NAME </span>=<span class="string"> Zhaoyu Li</span>
</code></pre><p>Then subsequent references to <code>${NAME}</code> or <code>$(NAME)</code> are interpreted as <code>Zhaoyu Li</code>.</p>
<h3 id="Examples">Examples</h3>
<p>Here are two examples,</p>
<pre><code> <span class="constant">SUBDIRS</span> = src analyze

 <span class="symbol">all:</span> subdirs test analysis
      <span class="variable">@echo</span> <span class="string">"After Build, run 'make analysis' to run analysis"</span>

 <span class="symbol">test:</span> 
      <span class="variable">@echo</span> <span class="string">"About to self-test"</span>; ./src/hw1

 <span class="symbol">analysis:</span> 
      <span class="variable">@cd</span> analyze &amp;&amp; make analysis

 <span class="symbol">subdirs:</span>
      <span class="variable">@for</span> dir <span class="keyword">in</span> <span class="variable">$(</span><span class="constant">SUBDIRS</span>); <span class="keyword">do</span> \
           <span class="variable">$(</span><span class="constant">MAKE</span>) -<span class="constant">C</span> <span class="variable">$$</span>dir; \
      done

 <span class="symbol">clean:</span>
      <span class="variable">@for</span> dir <span class="keyword">in</span> <span class="variable">$(</span><span class="constant">SUBDIRS</span>); <span class="keyword">do</span> \
           <span class="variable">$(</span><span class="constant">MAKE</span>) -<span class="constant">C</span> <span class="variable">$$</span>dir clean; \
      done
</code></pre><p>Let’s see another example. Suppose you are provided with two files, MyThreads.h and MyThreads.o. The former is a header file that has to be included into your source files and the latter is a library of functions for you to use. In other words, your source files in which multithreaded capability is used depend on MyThreads.h and your executable depends on MyThreads.o.</p>
<p>Suppose your assignment has the following files, prog01.c (the main function), and abc.c, def.c and xyz.c. All of these files contain access to multithread functions defined in MyThreads.h. You also designed some utility functions collected in files ut1.c and ut2.c. None of these two have access to the multithread capability. However, in your judgment, you believe any change made to ut1.c and ut2.c requires recompilation of abc.c and xyz.c. Therefore, on the source level, prog01.c, abc.c, def.c and xyz.c depend on MyThreads.h, and abc.c and xyz.c also depend on ut1.c and ut2.c. Suppose the final executable is to be called prog01.</p>
<pre><code> <span class="type">CC</span> = gcc -ansi

 prog01 : prog01.o abc.o def.o xyz.o ut1.o ut2.o <span class="type">MyThreads</span>.o
      ${<span class="type">CC</span>} -o prog01 prog01.o abc.o def.o xyz.o ut1.o ut2.o <span class="type">MyThreads</span>.o -lthread

 prog01.o : prog01.<span class="built_in">c</span> <span class="type">MyThreads</span>.h
      ${<span class="type">CC</span>} -<span class="built_in">c</span> prog01.<span class="built_in">c</span>

 abc.o : abc.<span class="built_in">c</span> <span class="built_in">c</span> ut2.<span class="built_in">c</span> <span class="type">MyThreads</span>.h
      ${<span class="type">CC</span>} -<span class="built_in">c</span> abc.<span class="built_in">c</span>
 def.o : def.<span class="built_in">c</span> <span class="type">MyThreads</span>.h
      ${<span class="type">CC</span>} -<span class="built_in">c</span> def.<span class="built_in">c</span>
 xyz.o : xyz.<span class="built_in">c</span> ut1.<span class="built_in">c</span> ut2.<span class="built_in">c</span> <span class="type">MyThreads</span>.h
      ${<span class="type">CC</span>} -<span class="built_in">c</span> xyz.<span class="built_in">c</span>

 ut1.o : ut1.<span class="built_in">c</span>
      ${<span class="type">CC</span>} -<span class="built_in">c</span> ut1.<span class="built_in">c</span>
 ut2.o : ut2.<span class="built_in">c</span>
      ${<span class="type">CC</span>} -<span class="built_in">c</span> ut2.<span class="built_in">c</span>
</code></pre><p>Above is the basic concepts of Makefile. If you want to be more expert, try the offcial documents.</p>

    </section>

    

<section class="post-comments">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
      var disqus_shortname = 'zlmoment'; 
      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>


  </article>


            <footer class="footer">
    <span class="footer__copyright">&copy; 2014. All rights reserved.</span>
    <span class="footer__copyright"><a href="http://uno.daleanthony.com" title="link to page for Uno Ghost theme">Uno theme</a> by <a href="http://daleanthony.com" title="link to website for Dale-Anthony">Dale-Anthony</a> | Redesign by <a href="http://letiantian.me" title="">樂天</a></span>
</footer>
        </div>
    </div>

    <!-- The main JavaScript file for Casper -->
    <script src="/js/main.js"></script>
    <script src="/js/scale.fix.js"></script>
    <script src="/js/jquery.imagesloaded.min.js"></script>
    <script src="/js/gallery.js"></script>
    <script src="/js/jquery.githubRepoWidget.min.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config"> 
      MathJax.Hub.Config({ 
        tex2jax: {inlineMath: [['[latex]','[/latex]'], ['\\(','\\)']]} 
    }); 
    </script>

    <!--kill ie6 -->
    <!--[if IE 6]>
      <script src="//letskillie6.googlecode.com/svn/trunk/2/zh_CN.js"></script>
    <![endif]-->

    <!--  google analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-37227120-1', 'hackecho.com');
      ga('send', 'pageview');
    </script>

    <!-- totop -->
    <div id="totop" style="position:fixed;bottom:50px;right:30px;cursor: pointer;">
    <a title="back to top"><img style="width:30px;height:30px;" src="/images/totop.png"/></a>
    </div>
    <script>
    (function($) { 
      var upperLimit = 100;
      var scrollElem = $('#totop');
      var scrollSpeed = 500; 
      scrollElem.hide();
      $(window).scroll(function () {            
        var scrollTop = $(document).scrollTop();       
        if ( scrollTop > upperLimit ) {
          $(scrollElem).stop().fadeTo(300, 1); // fade back in           
        }else{       
          $(scrollElem).stop().fadeTo(300, 0); // fade out
        }
      });
      $(scrollElem).click(function(){
        $('html, body').animate({scrollTop:0}, scrollSpeed); return false;
      });
    })(jQuery);
    </script>

    <!-- fancybox -->
    
    <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
    <script src="/fancybox/jquery.fancybox.pack.js"></script>
    <script type="text/javascript">
      (function($){
        $('.fancybox').fancybox();
      })(jQuery);
    </script>
    
    <script src="/js/instantclick.min.js" data-no-instant></script>
    <script data-no-instant>InstantClick.init();</script>
</body>
</html>
