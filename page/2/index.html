<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Page 2 | Hackecho</title>
  <meta name="author" content="Zhaoyu Li">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Hackecho"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Hackecho" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-37227120-1', 'hackecho.com');
      ga('send', 'pageview');

    </script>

  <!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Hackecho</a></h1>
  <h2><a href="/">Blog by Zhaoyu Li</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/" data-no-instant>Home</a></li>
    
      <li><a href="/archives" data-no-instant>Archives</a></li>
    
      <li><a href="/about" data-no-instant>About</a></li>
    
      <li><a href="https://github.com/zlmoment/Leetcode-Solutions" data-no-instant>LeetCode</a></li>
    
      <li><a href="/bigdata" data-no-instant>BigData</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-02-05T23:04:00.000Z"><a href="/2013/02/make-your-program/">Feb 5 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/02/make-your-program/">Make Your Program</a></h1>
  

    </header>
    <div class="entry">
      
        <p>这学期选了两门挺有意思的课，一门叫Programming High Performance Computing，还有一门Parallel and Distributed Processing。两周刚刚上下来，感觉传递的知识量有我之前悠哉悠哉一学期学到的都多。不知道是美国本科生的基础好还是美国大学的教育好，同班的美国同学接受这些知识看起来都毫无压力。不过语言确实是一个因素，比如HPC的老师两节课讲了几十个英文缩写，还都与电路有关，感觉回到了当年狂补计算机组成原理的时候。这些英文缩写估计对于美国学生接受起来要更好一点吧。我只有更努力了。</p>
<p>重新好好学习一下以前的知识，认真记住。PDP的教授第一节课说了一句话让我印象非常深刻，他说：“They value you not because what you can search but what you can do.”其实非常羡慕老教授课堂上信手拈来的各种复杂代码和命令参数，只靠Google是不行的。</p>
<p>本篇博客就来复习一下Makefile吧，这两门课每次交作业都要求必须包含Makefile，就像HPC的Slides中说的：“Real programmers use Makefiles!”</p>
<h3 id="Outline">Outline</h3>
<ul>
<li><p>What’s Makefile</p>
</li>
<li><p>Generating Multiple Targets</p>
</li>
<li><p>Macros</p>
</li>
</ul>
<h3 id="What’s_Makefile">What’s Makefile</h3>
<p>Under the UNIX shell, make is a command generator. The makefile is a description file which creates a sequence of commands for execution by the UNIX shell.</p>
<p>Generally, a program is built from one or more files and each of these files may have other files as prerequisites in turn. In a makefile, the prerequisites should be carefully stated. There are two important types of lines in a description file. A dependency line or rule line contains a colon, and a command line always starts <strong>with a tab</strong>.</p>
<p>To the left of the colon on the dependency line is a target; to the right of the colon are the target’s prerequisites. If myprog has prerequisites a.c and b.c, we have</p>
<pre><code> myprog :  a.<span class="built_in">c</span>  b.<span class="built_in">c</span>
</code></pre><p>The command lines just tells make how to make the target. For example,</p>
<pre><code> myprog : a.<span class="built_in">c</span> b.<span class="built_in">c</span>
      gcc -o myprog a.<span class="built_in">c</span> b.<span class="built_in">c</span>
</code></pre><p>Then, type <code>make</code>, the UNIX prompt will excute the command as you typed.</p>
<h3 id="Generating_Multiple_Targets">Generating Multiple Targets</h3>
<p>If we want to generate more than one programs, for example, let program prog01 depend on a.c and b.c, prog02 depend on m.c and n.c, and prog03 depend on u.c, v.c and w.c. </p>
<pre><code> all : prog01 prog02 prog03

 prog01 : a.<span class="built_in">c</span> b.<span class="built_in">c</span>
      gcc -o prog01 a.<span class="built_in">c</span> b.<span class="built_in">c</span>

 prog02 : m.<span class="built_in">c</span> n.<span class="built_in">c</span>
      gcc -o prog02 m.<span class="built_in">c</span> n.<span class="built_in">c</span>

 prog03 : u.<span class="built_in">c</span> v.<span class="built_in">c</span> w.<span class="built_in">c</span>
      gcc -o prog03 u.<span class="built_in">c</span> v.<span class="built_in">c</span> w.<span class="built_in">c</span>
</code></pre><p>Thus, if one of these three programs is not up-to-date, <code>all</code> will be generated which in turn causes all programs compiled. If the dependency line defining <code>all</code> is the first line of your Makefile, just type <code>make</code> will be the same as typing <code>make all</code>.</p>
<h3 id="Macros">Macros</h3>
<p>A macro definition is a line containing an equal sign (=). When make encounters a name that appears to the left of the equal sign, that name is replaced by the contents to the right of the equal sign. It is not necessary to delimit the text string with double quote (“) or single quote (‘). If they are used, they become part of the text string.</p>
<p>If we have the macro definition as follows,</p>
<pre><code><span class="attribute"> NAME </span>=<span class="string"> Zhaoyu Li</span>
</code></pre><p>Then subsequent references to <code>${NAME}</code> or <code>$(NAME)</code> are interpreted as <code>Zhaoyu Li</code>.</p>
<h3 id="Examples">Examples</h3>
<p>Here are two examples,</p>
<pre><code> <span class="constant">SUBDIRS</span> = src analyze

 <span class="symbol">all:</span> subdirs test analysis
      <span class="variable">@echo</span> <span class="string">"After Build, run 'make analysis' to run analysis"</span>

 <span class="symbol">test:</span> 
      <span class="variable">@echo</span> <span class="string">"About to self-test"</span>; ./src/hw1

 <span class="symbol">analysis:</span> 
      <span class="variable">@cd</span> analyze &amp;&amp; make analysis

 <span class="symbol">subdirs:</span>
      <span class="variable">@for</span> dir <span class="keyword">in</span> <span class="variable">$(</span><span class="constant">SUBDIRS</span>); <span class="keyword">do</span> \
           <span class="variable">$(</span><span class="constant">MAKE</span>) -<span class="constant">C</span> <span class="variable">$$</span>dir; \
      done

 <span class="symbol">clean:</span>
      <span class="variable">@for</span> dir <span class="keyword">in</span> <span class="variable">$(</span><span class="constant">SUBDIRS</span>); <span class="keyword">do</span> \
           <span class="variable">$(</span><span class="constant">MAKE</span>) -<span class="constant">C</span> <span class="variable">$$</span>dir clean; \
      done
</code></pre><p>Let’s see another example. Suppose you are provided with two files, MyThreads.h and MyThreads.o. The former is a header file that has to be included into your source files and the latter is a library of functions for you to use. In other words, your source files in which multithreaded capability is used depend on MyThreads.h and your executable depends on MyThreads.o.</p>
<p>Suppose your assignment has the following files, prog01.c (the main function), and abc.c, def.c and xyz.c. All of these files contain access to multithread functions defined in MyThreads.h. You also designed some utility functions collected in files ut1.c and ut2.c. None of these two have access to the multithread capability. However, in your judgment, you believe any change made to ut1.c and ut2.c requires recompilation of abc.c and xyz.c. Therefore, on the source level, prog01.c, abc.c, def.c and xyz.c depend on MyThreads.h, and abc.c and xyz.c also depend on ut1.c and ut2.c. Suppose the final executable is to be called prog01.</p>
<pre><code> <span class="type">CC</span> = gcc -ansi

 prog01 : prog01.o abc.o def.o xyz.o ut1.o ut2.o <span class="type">MyThreads</span>.o
      ${<span class="type">CC</span>} -o prog01 prog01.o abc.o def.o xyz.o ut1.o ut2.o <span class="type">MyThreads</span>.o -lthread

 prog01.o : prog01.<span class="built_in">c</span> <span class="type">MyThreads</span>.h
      ${<span class="type">CC</span>} -<span class="built_in">c</span> prog01.<span class="built_in">c</span>

 abc.o : abc.<span class="built_in">c</span> <span class="built_in">c</span> ut2.<span class="built_in">c</span> <span class="type">MyThreads</span>.h
      ${<span class="type">CC</span>} -<span class="built_in">c</span> abc.<span class="built_in">c</span>
 def.o : def.<span class="built_in">c</span> <span class="type">MyThreads</span>.h
      ${<span class="type">CC</span>} -<span class="built_in">c</span> def.<span class="built_in">c</span>
 xyz.o : xyz.<span class="built_in">c</span> ut1.<span class="built_in">c</span> ut2.<span class="built_in">c</span> <span class="type">MyThreads</span>.h
      ${<span class="type">CC</span>} -<span class="built_in">c</span> xyz.<span class="built_in">c</span>

 ut1.o : ut1.<span class="built_in">c</span>
      ${<span class="type">CC</span>} -<span class="built_in">c</span> ut1.<span class="built_in">c</span>
 ut2.o : ut2.<span class="built_in">c</span>
      ${<span class="type">CC</span>} -<span class="built_in">c</span> ut2.<span class="built_in">c</span>
</code></pre><p>Above is the basic concepts of Makefile. If you want to be more expert, try the offcial documents.</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-02-03T00:35:00.000Z"><a href="/2013/02/posix-threads-programming/">Feb 2 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/02/posix-threads-programming/">POSIX Threads Programming</a></h1>
  

    </header>
    <div class="entry">
      
        <p>I am writing this article for a memo of CS8860, Parallel and distributed system.</p>
<h3 id="Overview">Overview</h3>
<p>Technically, a thread is defined as an independent stream of instructions that can be scheduled to run as such by the operating system.</p>
<p>In the UNIX environment a thread:</p>
<ul>
<li><p>Exists within a process and uses the process resources</p>
</li>
<li><p>Has its own independent flow of control as long as its parent process exists and the OS supports it</p>
</li>
<li><p>Duplicates only the essential resources it needs to be independently schedulable</p>
</li>
<li><p>May share the process resources with other threads that act equally independently (and dependently)</p>
</li>
<li><p>Dies if the parent process dies - or something similar</p>
</li>
<li><p>Is “lightweight” because most of the overhead has already been accomplished through the creation of its process.</p>
</li>
</ul>
<p>All threads within a process share the same address space.</p>
<h3 id="Several_common_models">Several common models</h3>
<p>Several common models for threaded programs exist:</p>
<ul>
<li><p><strong>Manager/worker:</strong> a single thread, the manager assigns work to other threads, the workers. Typically, the manager handles all input and parcels out work to the other tasks. At least two forms of the manager/worker model are common: static worker pool and dynamic worker pool.</p>
</li>
<li><p><strong>Pipeline:</strong> a task is broken into a series of suboperations, each of which is handled in series, but concurrently, by a different thread. An automobile assembly line best describes this model.</p>
</li>
<li><p><strong>Peer:</strong> similar to the manager/worker model, but after the main thread creates other threads, it participates in the work.</p>
</li>
</ul>
<h3 id="Shared_Memory_Model:">Shared Memory Model:</h3>
<ul>
<li><p>All threads have access to the same global, shared memory</p>
</li>
<li><p>Threads also have their own private data</p>
</li>
<li><p>Programmers are responsible for synchronizing access (protecting) globally shared data.</p>
</li>
</ul>
<h3 id="The_Pthreads_API">The Pthreads API</h3>
<p>The Pthreads API contains around 100 subroutines. This article will focus on a subset of these.</p>
<h3 id="Compiling_Threaded_Programs">Compiling Threaded Programs</h3>
<pre><code><span class="title">INTEL</span> Linux:          icc -pthread
PGI Linux:            pgcc -lpthread
GNU Linux:            gcc -pthread
</code></pre><h3 id="Threading_Management">Threading Management</h3>
<p><strong> Creating and Terminating Threads </strong></p>
<p>Initially, your <code>main()</code> program comprises a single, default thread. All other threads must be explicitly created by the programmer.</p>
<p><code>pthread_create</code> creates a new thread and makes it executable. This routine can be called any number of times from anywhere within your code.</p>
<p><code>pthread_create</code> arguments:</p>
<ul>
<li><p><code>thread:</code> An opaque, unique identifier for the new thread returned by the subroutine.</p>
</li>
<li><p><code>attr:</code> An opaque attribute object that may be used to set thread attributes. You can specify a thread attributes object, or NULL for the default values.</p>
</li>
<li><p><code>start_routine:</code> the C routine that the thread will execute once it is created.</p>
</li>
<li><p><code>arg:</code> A single argument that may be passed to start_routine. It must be passed by reference as a pointer cast of type void. NULL may be used if no argument is to be passed.</p>
</li>
</ul>
<p>Once created, threads are peers, and may create other threads. There is no implied hierarchy or dependency between threads.</p>
<p>There are several ways in which a thread may be terminated:</p>
<ul>
<li><p>The thread returns normally from its starting routine. It’s work is done.</p>
</li>
<li><p>The thread makes a call to the <code>pthread_exit</code> subroutine - whether its work is done or not.</p>
</li>
<li><p>The thread is canceled by another thread via the <code>pthread_cancel</code> routine.</p>
</li>
<li><p>The entire process is terminated due to making a call to either the <code>exec()</code> or <code>exit()</code></p>
</li>
<li><p>If <code>main()</code> finishes first, without calling <code>pthread_exit</code> explicitly itself</p>
</li>
</ul>
<p>Pay attention, the pthread_exit() routine does not close files; any files opened inside the thread will remain open after the thread is terminated.</p>
<p>Example:</p>
<pre><code><span class="preprocessor">#<span class="keyword">include</span> &lt;pthread.h&gt; </span>
<span class="preprocessor">#<span class="keyword">include</span> &lt;stdio.h&gt; </span>
<span class="preprocessor">#<span class="keyword">define</span> NUM_THREADS  5 </span>

<span class="keyword">void</span> *PrintHello(<span class="keyword">void</span> *threadid) 
{ 
   <span class="keyword">int</span> tid; 
   tid = (<span class="keyword">int</span>)threadid; 
   <span class="built_in">printf</span>(<span class="string">"Hello World! It's me, thread #%d!\n"</span>, tid); 
   pthread_exit(NULL); 
} 

<span class="keyword">int</span> main (<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[]) 
{ 
   pthread_t threads[NUM_THREADS]; 
   <span class="keyword">int</span> rc, t; 
   <span class="keyword">for</span>(t=<span class="number">0</span>; t&lt;NUM_THREADS; t++){ 
      <span class="built_in">printf</span>(<span class="string">"In main: creating thread %d\n"</span>, t); 
      rc = pthread_create(&amp;threads[t], NULL, PrintHello, (<span class="keyword">void</span> *)t); 
      <span class="keyword">if</span> (rc){ 
         <span class="built_in">printf</span>(<span class="string">"ERROR; return code from pthread_create() is %d\n"</span>, rc); 
         <span class="built_in">exit</span>(-<span class="number">1</span>); 
      } 
   } 
   pthread_exit(NULL); 
}
</code></pre><p><strong> Passing Arguments to Threads </strong></p>
<p>All arguments must be passed by reference and cast to (void *).</p>
<p><strong> Joining and Detaching Threads </strong></p>
<pre><code><span class="attribute">:::C</span>
int pthread<span class="emphasis">_join(pthread_</span>t target<span class="emphasis">_thread, void **status);</span>
</code></pre><p>“Joining” is one way to accomplish synchronization between threads. This means that some other thread is required to call pthread_join to collect a terminated thread, in a fashion similar to the requirement for a parent process to collect status for terminated child processes.For example:</p>
<p><a href="/images/2013/02/forkjoin.gif"><img src="/images/2013/02/forkjoin.gif" alt=""></a></p>
<p>The <code>pthread_join()</code> subroutine blocks the calling thread until the specified threadid thread terminates.</p>
<p>To explicitly create a thread as joinable or detached, the attr argument in the <code>pthread_create()</code> routine is used. The typical 4 step process is:</p>
<ul>
<li><p>Declare a pthread attribute variable of the <code>pthread_attr_t</code> data type</p>
</li>
<li><p>Initialize the attribute variable with <code>pthread_attr_init()</code></p>
</li>
<li><p>Set the attribute detached status with <code>pthread_attr_setdetachstate()</code></p>
</li>
<li><p>When done, free library resources used by the attribute with p<code>thread_attr_destroy()</code></p>
</li>
</ul>
<p>Example:</p>
<pre><code>:::C
/<span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span>
 <span class="keyword">*</span> FILE: join.c
 <span class="keyword">*</span> DESCRIPTION:
 <span class="keyword">*</span>   This example demonstrates how to <span class="string">"wait"</span> for thread completions by using
 <span class="keyword">*</span>   the Pthread join routine.  Threads are explicitly created in a joinable
 <span class="keyword">*</span>   state for portability reasons. Use of the pthread_exit status argument is
 <span class="keyword">*</span>   also shown. Compare to detached.c
 <span class="keyword">*</span> AUTHOR: 8/98 Blaise Barney
 <span class="keyword">*</span> LAST REVISED:  01/30/09
 <span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span>/
<span class="comment">#include &lt;pthread.h&gt;</span>
<span class="comment">#include &lt;stdio.h&gt;</span>
<span class="comment">#include &lt;stdlib.h&gt;</span>
<span class="comment">#define NUM_THREADS    4</span>

void <span class="keyword">*</span>BusyWork(void <span class="keyword">*</span>t)
{
    int i;
    long tid;
    double result=0.0;
    tid = (long)t;
    printf(<span class="string">"Thread %ld starting...\n"</span>,tid);
    for (i=0; i<span class="variable">&lt;1000000; i++)
    {
        result = result + sin(i) * tan(i);
    }
    printf("Thread %ld done. Result = %e\n",tid, result);
    pthread_exit((void*) t);
}

int main (int argc, char *argv[])
{
    pthread_t thread[NUM_THREADS];
    pthread_attr_t attr;
    int rc;
    long t;
    void *status;

    /* Initialize and set thread detached attribute */
    pthread_attr_init(&amp;attr);
    pthread_attr_setdetachstate(&amp;attr, PTHREAD_CREATE_JOINABLE);

    for(t=0; t&lt;NUM_THREADS; t++) {
        printf("Main: creating thread %ld\n", t);
        rc = pthread_create(&amp;thread[t], &amp;attr, BusyWork, (void *)t);
        if (rc) {
            printf("ERROR; return code from pthread_create() is %d\n", rc);
            exit(-1);
        }
    }

    /* Free attribute and wait for the other threads */
    pthread_attr_destroy(&amp;attr);
    for(t=0; t&lt;NUM_THREADS; t++) {
        rc = pthread_join(thread[t], &amp;status);
        if (rc) {
            printf("ERROR; return code from pthread_join() is %d\n", rc);
            exit(-1);
        }
        printf("Main: completed join with thread %ld having a status of %ld\n",t,(long)status);
    }

    printf("Main: program completed. Exiting.\n");
    pthread_exit(NULL);
}</span>
</code></pre>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-12-31T19:57:00.000Z"><a href="/2012/12/python-yield/">Dec 31 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/12/python-yield/">Python中yield备忘</a></h1>
  

    </header>
    <div class="entry">
      
        <p>总是记不起来yield的用法，大概是因为实践中还没有用过的缘故吧。不过发现它真的是个非常实用的关键字，在这里草草记下几笔备忘。</p>
<p>带有 yield 的函数在 Python 中被称之为 generator（生成器）。</p>
<p>我们已生成斐波那契数列为例，来循序渐进了解yield。</p>
<p>生成斐波那契数列：</p>
<pre><code>:::Python
<span class="function"><span class="keyword">def</span> <span class="title">fab</span><span class="params">(max)</span>:</span> 
    n, a, b = <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span> 
    <span class="keyword">while</span> n &lt; max: 
        <span class="keyword">print</span> b 
        a, b = b, a + b 
        n = n + <span class="number">1</span> 
</code></pre><p>上面这个函数中直接用到了print函数，导致该函数复用性极差。我们想到可以返回一个List，改写如下：</p>
<pre><code>:::Python
<span class="function"><span class="keyword">def</span> <span class="title">fab</span><span class="params">(max)</span>:</span> 
    n, a, b = <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span> 
    L = [] 
    <span class="keyword">while</span> n &lt; max: 
        L.append(b) 
        a, b = b, a + b 
        n = n + <span class="number">1</span> 
    <span class="keyword">return</span> L 
</code></pre><p>但这个函数的内存占用会随着max的增大而增大，如果要控制内存占用，最好不要用List保存中间结果，而是通过iterable对象来迭代。举个例子：</p>
<pre><code><span class="attribute">:::Python</span>
for i in range(1000): pass
</code></pre><p>上述代码会生成一个1000元素的List；</p>
<pre><code><span class="attribute">:::Python</span>
for i in xrange(1000): pass 
</code></pre><p>而上述代码则会产生一个iterable对象，每次迭代中返回下一个值，内存占用很小。</p>
<p>我们来改写一下fab函数：</p>
<pre><code>:::Python
<span class="class"><span class="keyword">class</span> <span class="title">Fab</span><span class="params">(object)</span>:</span> 

    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, max)</span>:</span> 
        self.max = max 
        self.n, self.a, self.b = <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span> 

    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span> 
        <span class="keyword">return</span> self 

    <span class="function"><span class="keyword">def</span> <span class="title">next</span><span class="params">(self)</span>:</span> 
        <span class="keyword">if</span> self.n &lt; self.max: 
            r = self.b 
            self.a, self.b = self.b, self.a + self.b 
            self.n = self.n + <span class="number">1</span> 
            <span class="keyword">return</span> r 
        <span class="keyword">raise</span> StopIteration() 
</code></pre><p>这样就可以通过循环返回下一个值了：for n in Fab(5)。</p>
<p>但毕竟使用类重写后函数显得更加复杂，这时，yield 就派上用场了。</p>
<pre><code>:::Python
<span class="function"><span class="keyword">def</span> <span class="title">fab</span><span class="params">(max)</span>:</span> 
    n, a, b = <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span> 
    <span class="keyword">while</span> n &lt; max: 
        <span class="keyword">yield</span> b 
        <span class="comment"># print b </span>
        a, b = b, a + b 
        n = n + <span class="number">1</span> 
</code></pre><p>简单地讲，yield 的作用就是把一个函数变成一个 generator，带有 yield 的函数不再是一个普通函数，Python 解释器会将其视为一个 generator，调用 fab(5) 不会执行 fab 函数，而是返回一个 iterable 对象！在 for 循环执行时，每次循环都会执行 fab 函数内部的代码，执行到 yield b 时，fab 函数就返回一个迭代值，下次迭代时，代码从 yield b 的下一条语句继续执行，而函数的本地变量看起来和上次中断执行前是完全一样的，于是函数继续执行，直到再次遇到 yield。<br>也可以手动调用 fab(5) 的 next() 方法（因为 fab(5) 是一个 generator 对象，该对象具有 next() 方法），这样我们就可以更清楚地看到 fab 的执行流程：</p>
<pre><code><span class="input"><span class="prompt">:::Python
&gt;&gt;&gt;</span> f = fab(<span class="number">5</span>) </span>
<span class="input"><span class="prompt">&gt;&gt;&gt;</span> f.next() </span>
<span class="input"><span class="prompt">1 
&gt;&gt;&gt;</span> f.next() </span>
<span class="input"><span class="prompt">1 
&gt;&gt;&gt;</span> f.next() </span>
<span class="input"><span class="prompt">2 
&gt;&gt;&gt;</span> f.next() </span>
<span class="input"><span class="prompt">3 
&gt;&gt;&gt;</span> f.next() </span>
<span class="input"><span class="prompt">5 
&gt;&gt;&gt;</span> f.next() </span>
<span class="constant">Traceback</span> (most recent call last)<span class="symbol">:</span> 
 <span class="constant">File</span> <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;<span class="class"><span class="keyword">module</span>&gt; </span>
<span class="constant">StopIteration</span> 
</code></pre><p>yield 的好处是显而易见的，把一个函数改写为一个 generator 就获得了迭代能力，比起用类的实例保存状态来计算下一个 next() 的值，不仅代码简洁，而且执行流程异常清晰。</p>
<p>每次调用 fab 函数都会生成一个新的 generator 实例，各实例互不影响。</p>
<p><strong>另一个例子</strong></p>
<p>另一个 yield 的例子来源于文件读取。如果直接对文件对象调用 read() 方法，会导致不可预测的内存占用。比较好的方法是利用固定长度的缓冲区来不断读取文件内容。通过 yield，我们不再需要编写读文件的迭代类，就可以轻松实现文件读取：</p>
<pre><code>:::Python
<span class="function"><span class="keyword">def</span> <span class="title">read_file</span><span class="params">(fpath)</span>:</span> 
    BLOCK_SIZE = <span class="number">1024</span> 
    <span class="keyword">with</span> open(fpath, <span class="string">'rb'</span>) <span class="keyword">as</span> f: 
        <span class="keyword">while</span> <span class="keyword">True</span>: 
            block = f.read(BLOCK_SIZE) 
            <span class="keyword">if</span> block: 
                <span class="keyword">yield</span> block 
            <span class="keyword">else</span>: 
                <span class="keyword">return</span> 
                <span class="comment"># 在一个 generator function 中，如果没有 return，则默认执行至函数完毕，如果在执行过程中 return，则直接抛出 StopIteration 终止迭代。</span>
</code></pre><p>参考资料：<a href="http://www.ibm.com/developerworks/cn/opensource/os-cn-python-yield/" target="_blank" rel="external">廖雪峰-Python yield 使用浅析</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-11-03T21:01:47.000Z"><a href="/2012/11/disappear-day/">Nov 3 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/11/disappear-day/">消失的这几天</a></h1>
  

    </header>
    <div class="entry">
      
        <p>突然间，这里已经11月3日了，现在是凌晨1：20。在遥远的故乡，正是下午2：2o。朋友们，下午好。</p>
<p>好久没写东西了，哪怕是技术方面的，也没有一篇。最新的一篇日志还停留在7月份，记得那是离签证还有一星期的时候，忙里偷闲转的一篇。一转眼，万圣节已过，开始期盼Thanksgiving的时候，却发现到处都开始准备圣诞树了。时间好快，恍惚之间，不敢苟且。</p>
<p>如今，三个月过去了，每天的安排开始有了规律。不过回想起这三个月的种种，心头也会涌起一股莫名的感情。经常会想写一些东西记录，而一切变化太快，未等提笔，便已忙于身外，只能享受那片刻欢愉。</p>
<p>也许有一天，我会将这些见闻与经历写一写，而现在还没有准备好。因为没有经过沉淀的思想，永远都是肤浅的。有一天回忆的时候，我要找寻那种想哭的感动。</p>
<p>不过，我喜欢这种充实的生活，每一天都在创造价值，哥伦比亚是个小镇，宁静安详，不吵不闹，这里有传统的美国文化，也有纯真朴实的来自世界各地的人们，每天都有新发现，每天都会带给你新的的感受。</p>
<p>明天又将是充实的一天，Ellis图书馆的教堂式屋顶真的让我在第一次见到时目瞪口呆，而屋顶下是一群群怀有梦想的学子，这里，是梦开始的地方。</p>
<p>晚安。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-07-01T15:15:00.000Z"><a href="/2012/07/fhs-introduction/">Jul 1 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/07/fhs-introduction/">Linux文件系统备忘录</a></h1>
  

    </header>
    <div class="entry">
      
        <p>与Windows将硬盘看做“C盘”、“D盘”几个独立的分区不同，Linux将整个文件系统看做一棵树，这棵树的树根叫做根文件系统，用/表示。各个分区通过“挂载”（Mount）以文件夹的形式访问。</p>
<p>在/中的文件夹很多，本文介绍常见文件夹的意义。Linux的目录结构确实比较复杂，但设置合理、层次鲜明。本文以<a href="http://www.pathname.com/fhs/" target="_blank" rel="external">FHS 2.3</a>为例进行介绍。</p>
<h2 id="根文件系统">根文件系统</h2>
<p><strong>/bin</strong></p>
<p>这一目录中存放了供所有用户使用的完成基本维护任务的命令。其中bin是binary的缩写，表示二进制文件，通常为可执行文件。一些常用的系统命令，如cp、ls等保存在该目录中。</p>
<p><strong>/boot</strong></p>
<p>这里存放的是启动Linux时使用的一些核心文件。如操作系统内核、引导程序Grub等。</p>
<p><strong>/dev</strong></p>
<p>在此目录中包含所有的系统设备文件。从此目录可以访问各种系统设备。如CD-ROM，磁盘驱动器，调制解调器和内存等。在该目录中还包含有各种实用功能，如用于创建设备文件的MAKEDEV。</p>
<p><strong>/etc</strong></p>
<p>该目录中包含系统和应用软件的配置文件。</p>
<p><strong>/etc/passwd</strong></p>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2012/07/fhs-introduction/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-06-23T06:05:00.000Z"><a href="/2012/06/my-faile-can-be-copied/">Jun 23 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/06/my-faile-can-be-copied/">我的失败可以复制</a></h1>
  

    </header>
    <div class="entry">
      
        <p>常听人说，如果你开始回忆过去，说明你老了。而我却时常会怀念过去，或者说，是忏悔。</p>
<p>有时候会想，如果大学的前三年可以重新来过，让我们都回到那个懵懂的年纪，重新开始全新的大学生活，一定会选择一种完全不一样的生活。我一直以为，世界上有另外一个我，在过着我想过的生活，在做着我想做的事，而我却永远无法重新选择。</p>
<p>永远不能回头，在不断的选择中，我们创造了自己的生活。然而，当我们回首时看到的却满是错误与失去，多想穿越时空告诉那时的自己，你的选择，错了。可是，这些都是没有用的，回不去的事情再勉强也是幻想，走好余下的路才是最重要的，过去的错误永远是最宝贵的财富。</p>
<p>生命中，我们竭尽全力都无法改变的事情：倒向你的墙，离你而去的人，流逝的时间，和永远的过去。</p>
<p>就像这句歌词一样：“如果骄傲没被现实大海冷冷拍下，又怎会懂得要多努力才走得到远方；如果梦想不曾坠落悬崖千钧一发，又怎会晓得执着的人有隐形翅牓。”</p>
<p>所以，不要难过了。离过去越近，离未来就越远。过精彩的生活，遇到精彩的人，找到精彩的未来。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-06-06T04:52:47.000Z"><a href="/2012/06/my-ncee/">Jun 5 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/06/my-ncee/">我的高考</a></h1>
  

    </header>
    <div class="entry">
      
        <p>后天就要高考了，但这似乎已经与我无关。那段时光已经过去三年，可每每到这个时候，都会禁不住想起当年的我，当年的18班。</p>
<p>时间正在将过往一丝一丝地抹去，我想在淡忘之前，再次品味一下那年的生活。</p>
<p>关键字：运动场，角落，封闭的军事化管理，星空，考试那天</p>
<h3 id="运动场">运动场</h3>
<p>每天晚饭吃过以后，大约6点半，我们会三三两两到运动场上跑步，一般是跑6圈，然后满头大汗地回到教室等待晚自修。不管天气多么热，尤其是临近6月的时候，跑道上塑胶的味道很具有冲击感，但我们都依旧坚持着。当时的想法很简单，身体好才能保证学习，而要想身体好就要锻炼。那时候跟我一起跑的通常是永明，我高三时的同桌，物理超牛逼的一个人，现在在北大学物理系。跑步完之后，有时候我们会坐在草坪上，望着天空，莫名地感叹一下高三的生活，憧憬一下美好的未来，讨论一下大学，讨论一下理想。那时候没有多余的想法，黑色的高三也没那么苦，只是觉得很充实，很带感。</p>
<h3 id="角落">角落</h3>
<p>后来，我们在教室的位置换成了桌子和桌子相互隔开的布局，谁也不是谁的同桌。我特别向往教室最后面的角落里的那个座位，或许只是想求得一份宁静，在聒噪的高三里，能有一片属于自己的瓦尔登湖。</p>
<p>再后来，我后面的位置成了兴华的山水宝地。6月初即将高考的时候，我们还会在角落里说一些不着边的话题，整晚整晚地讨论。晚间下课，这个角落会是一帮人的美食之地，食堂买来的烧饼、馒头，超市买来的虾皮、老干妈，偶尔还会有一些新奇的玩意儿，大家热闹地讨论着，玩笑着。</p>
<h3 id="封闭的军事化管理">封闭的军事化管理</h3>
<p>我们学校向河北的衡中学习，实行封闭式的军事化管理，加上我们竞争压力比较大，每个人都拼命地学习。你永远无法体会高考面对98万考生同省竞争的压力，同样的大学，对于我们的分数会高出很多。每天五点半就要起床，一直到晚上十点半，紧张、规律的生活按照预定的轨道有条不紊。</p>
<p>不过我却很感谢这样的生活，磨练了那个时候的我们。就像永明走路一样，只有加快步伐，才能缩短浪费在路途中的时间。如今，永明走路的步伐依旧是那么快，我总也赶不上。</p>
<h3 id="星空">星空</h3>
<p>冬天的时候，每天5点半起床，走在去教室的路上，总会抬头找北斗七星的形状。清晨的感觉，就是夜的感觉；夜的感觉，就是努力的感觉。</p>
<p>清晨的夜，还有停车棚的自行车，留给我了永远无法磨灭的记忆。只要抬头仰望星空，就好像回到了那个时候，再来一首周杰伦的《简单爱》，我会觉得是时光倒流。</p>
<h3 id="考试那天">考试那天</h3>
<p>靠！考试那天，我的嘴唇被蚊子咬了。听起来貌似很荒谬，但更荒谬的是，初中中考的那一天，我的嘴唇也被蚊子咬了。我一直觉得冥冥之中是谁在安排着，或许上辈子我与蚊子有仇吧，简直巧合的难以令人相信。而且，截至目前，我的嘴唇总共被蚊子咬过两次，就是这两次。</p>
<p>说实话，考试那两天记忆不太深，感觉跟平常一样。语文作文搞砸了，理综没感觉，数学还不错，英语还凑合。然后，考完英语的那天下午，我们不像其他人一样，而是来到了教室估分。随后，奋斗在批阅前线的老师们发来了参考答案，那几天便疯狂地选校、填志愿。那时侯谁知道，这一选，选的是自己整个青春。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-05-20T23:33:03.000Z"><a href="/2012/05/how-to-keep-alive-with-less-sleep/">May 20 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/05/how-to-keep-alive-with-less-sleep/">(转)如何在保证睡眠的情况下高效学习</a></h1>
  

    </header>
    <div class="entry">
      
        <p>来源：<a href="http://blog.renren.com/blog/230557688/844071536" target="_blank" rel="external">http://blog.renren.com/blog/230557688/844071536</a></p>
<p>少睡不是长久之计，关键还是要高效地管理时间，提供十条高效做事的经验。</p>
<p>每天都过的很快，好像起床以后忙活几下，又到了晚上，很快又要睡觉了。To-do-list上的事好像总是做不完，有的时候积压地太多以至于都不想去碰了。每天从早到晚都是忙碌状态，但是总觉得做不了几件事，要是给我1天48小时该多好。</p>
<p>事情太多时间不够，但是睡少了又效率低下，这实在是个悖论。似乎很多牛人都可以睡的很少，每天4-5小时睡眠，或者间歇式的睡眠，就可以高效地做事。这个境界我总是达不到，也没有想去达到。少睡不是长久之计，关键还是要高效地管理时间。</p>
<p>我今天和一个朋友请教了这个问题，很受启发。我朋友是卡内基梅陇大学的计算机在读博士，发表了好几篇顶级论文，科研做的很牛。除学术以外，他还忙活不少其他的事，他是云飞跃留学平台的兼职编辑，他业余时间喜欢研究摄影，最近又在开发一款手机游戏，他周末也会花不少时间陪女朋友。尽管做那么多事，他告诉我说他每天都精力充沛，做事效率很高！</p>
<p>但是他每天可以睡8小时！</p>
<p>他讲了好几条高效做事的经验：</p>
<h3 id="1、作息要规律，这是重中之重。">1、作息要规律，这是重中之重。</h3>
<p>他的作息大致是这样的：</p>
<p>6:00 起床和早餐</p>
<p>7:15 – 7:30 跑步到学校</p>
<p>7:30 – 8:15 健身</p>
<p>8:30 – 11:30 做事</p>
<p>11:30 – 13:00 午饭+午睡</p>
<p>13:00 – 18:00 做事</p>
<p>18:00 – 19:30 晚饭</p>
<p>19:30 – 22:30 做事</p>
<p>22:30 睡觉</p>
<p>所以每天约有11小时在做事。他说只有作息规律了，身体机能才能达到最大的发挥。就像生产线一样，只有流程化了，效率才能提高。作息经常不规律，身体就要不断调整，这个调整很消耗能量，影响效率。就像一个GPS，总是在re-calculating，还怎么指路呢？</p>
<h3 id="2、不要熬夜，熬夜伤身。">2、不要熬夜，熬夜伤身。</h3>
<p>很多人觉得12点，1点睡觉没关系，只要习惯就行了，人的适应能力很好的。但是大量的医学研究表明，长期熬夜会引发很多病，而且这些病一旦爆发，往往后果很严重。我知道卡内基梅陇的人很能熬夜，刚来的时候我有几次半夜2点回家，等校车的有不少人。但后来我感觉这边的课程和科研压力很大，一直熬夜下去会一发不可收拾，我就强迫自己改变。改变前你要先明白一点：只要睡眠不减少，不管早睡晚睡，每天做事的时间实际是差不多的。</p>
<h3 id="3、每天要有固定的时间锻炼，至少半小时。">3、每天要有固定的时间锻炼，至少半小时。</h3>
<p>锻炼可以促进新城代谢，调节身体机能。每天经常锻炼的人，虽然消耗了体力，但是换来的是精神充沛，相反那些不锻炼的人，经常觉得累。</p>
<h3 id="4、做事之前多想想。">4、做事之前多想想。</h3>
<p>想明白你为什么做这件事，怎样做可以达到最佳的效果。很多人是拿起事情就做，兵来将挡水来土掩，一股脑的做完了事。这实际上是非常不明智而且低效的做法，因为目的不清晰就会走岔路，做事方法不优化就会浪费时间。有的时候你花5分钟多想想，可以节省你好几个小时。</p>
<h3 id="5、做事不要拖。">5、做事不要拖。</h3>
<p>很多人喜欢拖，事情就不断积累下来了，然后被一个又一个的deadline折磨。重要的事情一定要在合适的时间尽快处理掉。一件事如果比较耗时，要做好规划，每天做一点。</p>
<h3 id="6、每天要做的事尽量写下来，不要只是放在脑中。">6、每天要做的事尽量写下来，不要只是放在脑中。</h3>
<h3 id="7、做事要专注。">7、做事要专注。</h3>
<p>很多人做事的时候，开着renren、Facebook、weibo、QQ和其他网页，不时会去看看有什么新情况。你以为它们只会占居你很少的时间，其实这些时间碎片严重影响了你的效率。就像睡觉一样，你如果被断断续续的声音影响，你就没法进入深度睡眠。所以，做重要的事情的时候，把这些务必都关了，邮件也尽量定期去查看，免得经常被新来的邮件打断。</p>
<h3 id="8、控制好做事的节奏，张弛有度。">8、控制好做事的节奏，张弛有度。</h3>
<p>从早到晚做事不可能保持一样的效率，如果你早上精神好，那就在早上尽量做重要的事，下午和晚上做一些相对轻松的事。在1小时内做事，也要把握节奏，可以高强度地做50分钟，然后低强度的做10分钟或者休息。道理大家都懂，但很多人一忙起来就不能自拔了。</p>
<p>我再根据自己的经验补充2条吧：</p>
<h3 id="9、如果你喜欢multi-task（多任务处理），尽量减少task之间频繁切换，并且每个task的时间要控制好。">9、如果你喜欢multi-task（多任务处理），尽量减少task之间频繁切换，并且每个task的时间要控制好。</h3>
<p>我一般一小时内就做一个task，如果1小时到了，我通常就会换下一个（如果没有deadline限制）。长时间做一个task往往会效率低下。</p>
<h3 id="10、知道什么事你能做，什么事你不能做。">10、知道什么事你能做，什么事你不能做。</h3>
<p>我们经常想做很多事，但是精力有限，能力有限，使得我们必须做出选择。有些事你如果做不好就尽量不要去接受去承诺。选择是一种智慧，有所放弃才能保证你的睡眠。</p>
<p>希望这些经验对你有帮助！</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-05-12T04:38:01.000Z"><a href="/2012/05/python-decorator/">May 11 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/05/python-decorator/">Python中的装饰器Decorator</a></h1>
  

    </header>
    <div class="entry">
      
        <p>Stackoverflow上面有一个问题（<a href="http://stackoverflow.com/questions/739654/understanding-python-decorators" target="_blank" rel="external">Here</a>），问题是这样的：</p>
<p>如果使用如下的代码：</p>
<pre><code>:::Python
<span class="decorator">@makebold</span>
<span class="decorator">@makeitalic</span>
<span class="function"><span class="keyword">def</span> <span class="title">say</span><span class="params">()</span>:</span>
    <span class="keyword">return</span> <span class="string">"Hello"</span>
</code></pre><p>打印出如下的输出：</p>
<pre><code><span class="attribute">:::HTML</span>
&lt;b&gt;&lt;i&gt;Hello&lt;/i&gt;&lt;/b&gt;
</code></pre><p>你会怎么做？最后给出的答案是：</p>
<pre><code>:::Python
<span class="function"><span class="keyword">def</span> <span class="title">makebold</span><span class="params">(fn)</span>:</span>
    <span class="function"><span class="keyword">def</span> <span class="title">wrapped</span><span class="params">()</span>:</span>
        <span class="keyword">return</span> <span class="string">"&lt;b&gt;"</span> + fn() + <span class="string">"&lt;/b&gt;"</span>
    <span class="keyword">return</span> wrapped

<span class="function"><span class="keyword">def</span> <span class="title">makeitalic</span><span class="params">(fn)</span>:</span>
    <span class="function"><span class="keyword">def</span> <span class="title">wrapped</span><span class="params">()</span>:</span>
        <span class="keyword">return</span> <span class="string">"&lt;i&gt;"</span> + fn() + <span class="string">"&lt;/i&gt;"</span>
    <span class="keyword">return</span> wrapped

<span class="decorator">@makebold</span>
<span class="decorator">@makeitalic</span>
<span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">()</span>:</span>
    <span class="keyword">return</span> <span class="string">"hello world"</span>

<span class="keyword">print</span> hello() <span class="comment">## 返回 &lt;b&gt;&lt;i&gt;hello world&lt;/i&gt;&lt;/b&gt;</span>
</code></pre><p>其中的@其实就是Python的装饰器。</p>
<p>装饰器模式可以在不影响其它对象的情况下，以动态、透明的方式给单个对象添加职责，也能够处理那些可以撤销的职责。经常用于日志记录、性能测试等场合。</p>
<p>想象一下这个很常见的场景，你写了一个方法只提供给以登陆的用户访问，你可以写以下代码：</p>
<pre><code>:::Python
<span class="function"><span class="keyword">def</span> <span class="title">A</span><span class="params">()</span>:</span>
    <span class="keyword">if</span> user.is_login():
        do something
    <span class="keyword">else</span>:
        <span class="keyword">pass</span>
</code></pre><p>这当然没什么问题，但是你又写了一个方法B，也要求只有登录用户可以访问，于是有写了以下代码：</p>
<pre><code>:::Python
<span class="function"><span class="keyword">def</span> <span class="title">B</span><span class="params">()</span>:</span>
    <span class="keyword">if</span> user.is_login():
        do something
    <span class="keyword">else</span>:
        <span class="keyword">pass</span>
</code></pre><p>问题出来了，如果不是两个方法而是一堆方法，你可能就有点受不了啦。当然聪明的你可以想出这个方法：</p>
<pre><code>:::Python
<span class="function"><span class="keyword">def</span> <span class="title">A</span><span class="params">()</span>:</span>
    <span class="keyword">pass</span>
<span class="function"><span class="keyword">def</span> <span class="title">B</span><span class="params">()</span>:</span>
    <span class="keyword">pass</span>
<span class="function"><span class="keyword">def</span> <span class="title">login_required</span><span class="params">(fn)</span>:</span>
    <span class="function"><span class="keyword">def</span> <span class="title">ff</span><span class="params">()</span>:</span>
        <span class="keyword">if</span> user.is_login():
            fn()
        <span class="keyword">else</span>:
            <span class="keyword">pass</span>
    <span class="keyword">return</span> ff

A = login_required(A)
B = login_required(B)
</code></pre><p>你可能没有想到，对于这么好用的东西，python优雅的支持，这就是@修饰符：</p>
<pre><code>:::Python
<span class="function"><span class="keyword">def</span> <span class="title">login_required</span><span class="params">(fn)</span>:</span>
    <span class="function"><span class="keyword">def</span> <span class="title">ff</span><span class="params">()</span>:</span>
        <span class="keyword">if</span> user.is_login():
            fn()
        <span class="keyword">else</span>:
            <span class="keyword">pass</span>
    <span class="keyword">return</span> ff

<span class="decorator">@login_required</span>
<span class="function"><span class="keyword">def</span> <span class="title">A</span><span class="params">()</span>:</span>
    <span class="keyword">pass</span>
<span class="decorator">@login_required</span>
<span class="function"><span class="keyword">def</span> <span class="title">B</span><span class="params">()</span>:</span>
    <span class="keyword">pass</span>
</code></pre><p><strong>在方法A上边写一个@修饰符，调用方法A的时候会调用修饰符后边的方法B，方法B以A方法为参数，而且需要返回一个可调用的对象，这个可调用的对象会使用A方法提供的参数执行。</strong>看这个例子：</p>
<pre><code>:::Python
<span class="comment">#!/usr/bin/env python  </span>

<span class="function"><span class="keyword">def</span> <span class="title">a</span><span class="params">(fn)</span>:</span>
    <span class="keyword">print</span> <span class="string">'a'</span>
    <span class="function"><span class="keyword">def</span> <span class="title">d</span><span class="params">(st)</span>:</span>
        <span class="keyword">print</span> st+<span class="string">'d'</span>
    <span class="keyword">return</span> d

<span class="function"><span class="keyword">def</span> <span class="title">b</span><span class="params">(fn)</span>:</span>
    <span class="keyword">print</span> <span class="string">'b'</span>
    <span class="keyword">return</span> fn

<span class="decorator">@a</span>
<span class="decorator">@b</span>
<span class="function"><span class="keyword">def</span> <span class="title">c</span><span class="params">(st)</span>:</span>
    <span class="keyword">print</span> st

c(<span class="string">'c'</span>)
</code></pre><p>输出结果是：bacd</p>
<p>我们调用c(‘c’)的时候会先调用b(c)，b(c)打印字符”b”然后返回c，然后再调用a(c)，a(c)打印字符”a”，然后返回方法d，然后再执行d(‘c’)，打印cd。</p>
<p>参考资料：<a href="http://blog.csdn.net/shangzhihaohao" target="_blank" rel="external">http://blog.csdn.net/shangzhihaohao</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-05-11T04:11:29.000Z"><a href="/2012/05/my-recent-life-things/">May 10 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/05/my-recent-life-things/">近况 &amp; 忙里偷闲</a></h1>
  

    </header>
    <div class="entry">
      
        <p>我觉得有必要记录一下生活。</p>
<p>两年前，我对自己的生活就一个要求：“每天都要创造价值”。当时还和某某人深入探讨过，什么是价值，怎样去创造的问题。不知到某某人还记得否，当年为此想法兴高采烈，一致认为应该将其写本书，也像那谁谁一样火一把。后来遗憾的是，再也没有机会和某某人探讨这个问题了，只好躬身而行，久而久之，竟然也成了一种习惯性的思维。如果某天不能创造点价值（在自己看来），就没有勇气结束一天。不过毕竟人无完人，长期以来，这种思维导致的直接后果就是养成了晚睡的好习惯…看来必须调整一下了。</p>
<p>最近几天，除了迫在眉睫的TOEFL、GRE外，其它时间全部沉浸在Tornado中。想起以前的时候，阿北坐在星巴克，用四五个月的时间创造了豆瓣，我就有种莫名的冲动。但我创造的不是豆瓣，而是一个中国的关于Python的开源社区。细节就不透露了，PyPub.com，敬请期待。</p>
<p>其实我想吐槽一下Tornado，就不能有一个像样的文档吗！各种问题搞不清楚，查不到资料。还好Tornado是个轻量级的框架，还可以读一读源码找找问题。其实也是一举两得的事情，就像当我把Markdown的Python实现的源码过了一遍的时候，其语法也就了解的差不多了，也就是说，如果你把JAVA的C++源码读一遍，大抵也就可以用JAVA编程了（偷笑）。但一举两得的事往往要艰难得多，很多时候我们不愿意去做罢了。</p>
<p>最近比较有感触的一句话：“世界是一本书，没旅行过的人只看到其中一页。”比起中规中矩的生活，我更喜欢有挑战的生活，更喜欢新的气息，我想去阅读这本书，因为我们只有这一次生命来阅读它。阅尽人世繁华，何尝不是一种人生。因为如此，也许我不会过早地结婚，但我会从结婚的那一天起，带我的爱人环游世界。</p>
<p>嗯，忙里偷闲，简简单单寥寥数语，共勉青春年华。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





<nav id="pagination">
  
    <a href="/" class="alignleft prev">Prev</a>
  
  
    <a href="/page/3/" class="alignright next">Next</a>
  
  <div class="clearfix"></div>
</nav></div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:hackecho.com">
  </form>
</div>

  

  
<div class="widget tag">
  <h3 class="title">Recent Posts</h3>
  <ul class="entry">
    
      <li>
        <a href="/2014/05/connecting-to-emr-masternode-via-ssh/">Connecting to EMR masternode via SSH</a>
      </li>
    
      <li>
        <a href="/2014/04/notes-about-maven/">Notes about Maven</a>
      </li>
    
      <li>
        <a href="/2014/04/hadoop-cluster-setup-instruction-with-fedora-20/">Hadoop Cluster Setup Instruction with Fedora 20</a>
      </li>
    
      <li>
        <a href="/2013/10/real-time-emotion-analysis-on-twitter/">Real-time Emotion Analysis On Twitter</a>
      </li>
    
      <li>
        <a href="/2013/04/cuda-parallel-reduction/">CUDA中并行规约（Parallel Reduction）的优化</a>
      </li>
    
      <li>
        <a href="/2013/04/basics-of-mpi/">MPI 并行程序设计基础</a>
      </li>
    
      <li>
        <a href="/2013/03/a-letter-to-myself/">写给四年前刚开始编程的自己</a>
      </li>
    
  </ul>
</div>


  <div class="widget tag">
<h3 class="title">Links</h3>
<ul class="entry">
	<li><a href="http://vicdory.com/" target="_blank" title="Kailun Shi">Kailun Shi</a></li>
	<li><a href="http://guo-min-zhi.github.io/" target="_blank" title="远方">远方</a></li>
	<li><a href="http://mingplusplus.com/blog/" target="_blank" title="Ming++">Ming++</a></li>
	<li><a href="http://ruiwu.me/" target="_blank" title="RuiWu">RuiWu</a></li>
</ul>
</div>

  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/Android/">Android</a><small>1</small></li>
  
    <li><a href="/tags/Android,AsyncTask/">Android,AsyncTask</a><small>1</small></li>
  
    <li><a href="/tags/Android,SharedPreferences/">Android,SharedPreferences</a><small>1</small></li>
  
    <li><a href="/tags/BidData/">BidData</a><small>1</small></li>
  
    <li><a href="/tags/Decorator,Python/">Decorator,Python</a><small>1</small></li>
  
    <li><a href="/tags/EMR/">EMR</a><small>1</small></li>
  
    <li><a href="/tags/GBK,Mac,UTF8/">GBK,Mac,UTF8</a><small>1</small></li>
  
    <li><a href="/tags/Git/">Git</a><small>1</small></li>
  
    <li><a href="/tags/Google+/">Google+</a><small>1</small></li>
  
    <li><a href="/tags/Hadoop/">Hadoop</a><small>1</small></li>
  
    <li><a href="/tags/JSON,XML,PHP/">JSON,XML,PHP</a><small>1</small></li>
  
    <li><a href="/tags/Life/">Life</a><small>1</small></li>
  
    <li><a href="/tags/Linux,HFS/">Linux,HFS</a><small>1</small></li>
  
    <li><a href="/tags/MPI/">MPI</a><small>1</small></li>
  
    <li><a href="/tags/MVC,-PHP/">MVC, PHP</a><small>1</small></li>
  
    <li><a href="/tags/Maven/">Maven</a><small>1</small></li>
  
    <li><a href="/tags/PHP,Socket/">PHP,Socket</a><small>1</small></li>
  
    <li><a href="/tags/Python/">Python</a><small>1</small></li>
  
    <li><a href="/tags/ThinkPHP/">ThinkPHP</a><small>1</small></li>
  
    <li><a href="/tags/WebSocket,HTML5/">WebSocket,HTML5</a><small>1</small></li>
  
    <li><a href="/tags/Wordpress/">Wordpress</a><small>2</small></li>
  
    <li><a href="/tags/boost,thread/">boost,thread</a><small>1</small></li>
  
    <li><a href="/tags/cuda,parallel,reduction/">cuda,parallel,reduction</a><small>1</small></li>
  
    <li><a href="/tags/fly-of-promgrammer/">fly-of-promgrammer</a><small>1</small></li>
  
    <li><a href="/tags/gcc/">gcc</a><small>1</small></li>
  
    <li><a href="/tags/ipc,semaphores/">ipc,semaphores</a><small>1</small></li>
  
    <li><a href="/tags/life/">life</a><small>1</small></li>
  
    <li><a href="/tags/makefile/">makefile</a><small>1</small></li>
  
    <li><a href="/tags/movie/">movie</a><small>1</small></li>
  
    <li><a href="/tags/open-source/">open source</a><small>1</small></li>
  
    <li><a href="/tags/pthread/">pthread</a><small>1</small></li>
  
    <li><a href="/tags/web/">web</a><small>1</small></li>
  
    <li><a href="/tags/websocket/">websocket</a><small>1</small></li>
  
    <li><a href="/tags/极客/">极客</a><small>1</small></li>
  
    <li><a href="/tags/程序员/">程序员</a><small>2</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2014 Zhaoyu Li
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<script type="text/javascript">
var disqus_shortname = 'zlmoment';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


<!-- InstantClick makes following links in your website instant. http://instantclick.io -->
<script src="/js/instantclick.min.js" data-no-instant></script>
<script data-no-instant>InstantClick.init();</script>
</body>
</html>