<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Page 3 | Hackecho</title>
  <meta name="author" content="Zhaoyu Li">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Hackecho"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Hackecho" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Hackecho</a></h1>
  <h2><a href="/">Blog by Zhaoyu Li</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
      <li><a href="/about">About</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-04-17T05:46:21.000Z"><a href="/2012/04/socket-programming-in-php/">Apr 17 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/04/socket-programming-in-php/">PHP中的Socket编程</a></h1>
  

    </header>
    <div class="entry">
      
        <p>关于PHP socket的资料网上着实不多，或者讲的都不是很全面。为了更好地用PHP来处理socket，天堂皓月博客特地来简单总结一下其用法，尽量会做到深入浅出：）</p>
<h3 id="-">文章结构：</h3>
<ul>
<li>Socket基础知识</li>
</ul>
<ul>
<li>编写服务器</li>
</ul>
<ul>
<li>编写客户端</li>
</ul>
<ul>
<li>总结</li>
</ul>
<p>通过这三部分你将会体验到Socket的魅力，并了解怎样去编写一个服务器，怎样通过Sockets连接到服务器，服务器怎样处理信息并将信息发送给相应的客户端。</p>
<p>不管你信不信，只要你用过PHP，就一定用过Sockets。HTTP服务器就是一个Socket服务器，浏览器就是客户端，也就是最简单的C/S模式。</p>
<h3 id="socket-">Socket基础知识</h3>
<p>我们可以把Socket当做是一种数据结构，客户端和服务器间通过这种数据结构来交换数据。服务器开始监听连接，当客户端想要连接服务器时，会通过服务器监听的端口开启一个会话，服务器收到客户端的请求后，建立连接完毕，然后继续监听下一次连接。</p>
<p>要产生一个Socket，你我们需要三个变量：一个协议（protocol）、一个socket类型（socket type）和一个公共协议类型（common protocol type）。下面将会详细介绍各个部分的具体内容。</p>
<p><strong>协议</strong></p>
<ul>
<li>AF_INET：这是大多数用来产生socket的协议，使用TCP或UDP来传输，用在IPv4的地址</li>
</ul>
<ul>
<li>AF_INET6：与上面类似，不过是来用在IPv6的地址</li>
</ul>
<ul>
<li>AF_UNIX：本地协议，使用在Unix和Linux系统上，它很少使用，一般都是当客户端和服务器在同一台及其上的时候使用</li>
</ul>
<p><strong>Socket类型</strong></p>
<ul>
<li>SOCK_STREAM：这个协议是按照顺序的、可靠的、数据完整的基于字节流的连接。这是一个使用最多的socket类型，这个socket是使用TCP来进行传输。</li>
</ul>
<ul>
<li>SOCK_DGRAM：这个协议是无连接的、固定长度的传输调用。该协议是不可靠的，使用UDP来进行它的连接。</li>
</ul>
<ul>
<li>SOCK_SEQPACKET：这个协议是双线路的、可靠的连接，发送固定长度的数据包进行传输。必须把这个包完整的接受才能进行读取。</li>
</ul>
<ul>
<li>SOCK_RAW：这个socket类型提供单一的网络访问，这个socket类型使用ICMP公共协议。（ping、traceroute使用该协议）</li>
</ul>
<ul>
<li>SOCK_RDM：这个类型是很少使用的，在大部分的操作系统上没有实现，它是提供给数据链路层使用，不保证数据包的顺序</li>
</ul>
<p><strong>公共协议</strong></p>
<ul>
<li>ICMP：互联网控制消息协议，主要使用在网关和主机上，用来检查网络状况和报告错误信息</li>
</ul>
<ul>
<li>UDP：用户数据报文协议，它是一个无连接，不可靠的传输协议</li>
</ul>
<ul>
<li>TCP：传输控制协议，这是一个使用最多的可靠的公共协议，它能保证数据包能够到达接受者那儿，如果在传输过程中发生错误，那么它将重新发送出错数据包。</li>
</ul>
<p>在PHP中我们使用socket_create()函数来产生一个Socket。socket_create()函数运行成功返回一个包含Socket的资源类型，如果没有成功则返回false。</p>
<p>1 resource socket_create(int protocol, int socketType, int commonProtocol);</p>
<p>PHP提供了很多操作Socket的函数。现在我们来看一个例子，了解PHP是如何产生、接受和监听一个socket。</p>
<pre><code>:::PHP
&lt;?php
$commonProtocol = getprotobyname(“tcp”);
$socket = socket_create(AF_INET, SOCK_STREAM, $commonProtocol);
socket_bind($socket, ‘localhost’, 1337);
socket_listen($socket);
// More socket functionality to come
?&gt;
</code></pre><p>我们来详细解释一下上面这个程序（基于行号）：</p>
<p>第二行：使用公共协议名字来获取一个协议类型。在这里使用的是TCP公共协议，如果你想使用UDP或者ICMP协议，就应该把getprotobyname()函数的参数改为“udp”或“icmp”。我们也可以不使用getprotobyname()函数而是直接指定SOL_TCP或SOL_UDP。</p>
<p>第三行：产生一个Socket并且返回一个Socket资源的实例。</p>
<p>第四行：有了一个Socket资源的实例以后，就必须把Socket绑定到一个IP地址和某一端口上。在这里绑定socket到本地计算机（127.0.0.1）的1337端口。</p>
<p>第五行：然后就需要监听所有进来的socket连接。</p>
<p>这时，我们就需要了解一下PHP中Socket函数的使用方法了。官方手册的介绍非常不错（<a href="http://www.php.net/manual/en/ref.sockets.php" target="_blank">猛戳这个链接</a>），下面只是简单列举几个最常用的。</p>
<ul>
<li>socket_accept() 接受一个Socket连接</li>
</ul>
<ul>
<li>socket_bind() 把socket绑定在一个IP地址和端口上</li>
</ul>
<ul>
<li>socket_close() 关闭一个socket资源</li>
</ul>
<ul>
<li>socket_connect() 开始一个socket连接</li>
</ul>
<ul>
<li>socket_create_listen() 在指定端口打开一个socket监听</li>
</ul>
<ul>
<li>socket_create() 产生一个socket，相当于产生一个socket的数据结构</li>
</ul>
<ul>
<li>socket_get_option() 获取socket选项</li>
</ul>
<ul>
<li>socket_getpeername() 获取远程主机的ip地址</li>
</ul>
<ul>
<li>socket_getsockname() 获取本地socket的ip地址</li>
</ul>
<ul>
<li>socket_listen() 监听由指定socket的所有连接</li>
</ul>
<ul>
<li>socket_read() 读取指定长度的数据</li>
</ul>
<ul>
<li>socket_readv() 读取从分散/聚合数组过来的数据</li>
</ul>
<ul>
<li>socket_recv() 从socket里结束数据到缓存</li>
</ul>
<ul>
<li>socket_recvfrom() 接受数据从指定的socket，如果没有指定则默认当前socket</li>
</ul>
<ul>
<li>socket_recvmsg() 从iovec里接受消息</li>
</ul>
<ul>
<li>socket_select() 多路选择</li>
</ul>
<ul>
<li>socket_send() 这个函数发送数据到已连接的socket</li>
</ul>
<ul>
<li>socket_sendmsg() 发送消息到socket</li>
</ul>
<ul>
<li>socket_sendto() 发送消息到指定地址的socket</li>
</ul>
<ul>
<li>socket_set_block() 在socket里设置为块模式</li>
</ul>
<ul>
<li>socket_set_nonblock() socket里设置为非块模式</li>
</ul>
<ul>
<li>socket_set_option() 设置socket选项</li>
</ul>
<ul>
<li>socket_shutdown() 这个函数允许你关闭读、写、或者指定的socket</li>
</ul>
<ul>
<li>socket_write() 写数据到socket缓存</li>
</ul>
<p>关于PHP Socket的基础知识就介绍到这里，还有不明白的可查看官方手册。下面介绍编写一个Socket服务器。</p>
<h3 id="-">编写服务器</h3>
<p>现在我们把第一个例子完善，使其能够监听一个指定的Socket并处理用户的连接。</p>
<pre><code>:::PHP
&lt;?php
$commonProtocol = getprotobyname(&quot;tcp&quot;);
$socket = socket_create(AF_INET, SOCK_STREAM, $commonProtocol);
socket_bind($socket, &#39;localhost&#39;, 1337);
socket_listen($socket);
// Accept any incoming connections to the server
$connection = socket_accept($socket);
if($connection)
{
   socket_write($connection, &quot;You have connected to the socket...\n\r&quot;);
}
?&gt;
</code></pre><p>注意这不是一个Web页面，如果你尝试使用Web浏览器来运行这个脚本，那么很有可能它会超过PHP运行30秒的限时。当然你可以使用下面的代码来设置一个无限的运行时间</p>
<blockquote>
<p>set_time_limit(0);</p>
</blockquote>
<p>但最好的办法还是直接使用命令提示符来运行：</p>
<blockquote>
<p>php server.php</p>
</blockquote>
<p>但截至目前，上面的服务器端有<strong>三个问题</strong>：</p>
<ol>
<li>它不能接受多个连接。</li>
</ol>
<ol>
<li>它只完成唯一的一个命令。</li>
</ol>
<ol>
<li>你不能通过Web浏览器连接这个服务器。</li>
</ol>
<p>在上一个代码的基础上再改进，使用下面的代码来做新服务器端：</p>
<pre><code>:::PHP
&lt;?php
// Set up our socket 
$commonProtocol = getprotobyname(&quot;tcp&quot;);
$socket = socket_create(AF_INET, SOCK_STREAM, $commonProtocol);
socket_bind($socket, &#39;localhost&#39;, 1337);
socket_listen($socket);
// Initialize the buffer 
$buffer = &quot;NO DATA&quot;;
while(true)
{
    // Accept any connections coming in on this socket
    $connection = socket_accept($socket);
    printf(&quot;Socket connected\r\n&quot;);
    // Check to see if there is anything in the buffer
    if($buffer != &quot;&quot;)
    {
        printf(&quot;Something is in the buffer...sending data...\r\n&quot;);
        socket_write($connection, $buffer . &quot;\r\n&quot;);
        printf(&quot;Wrote to socket\r\n&quot;);
    }
    else
    {
        printf(&quot;No Data in the buffer\r\n&quot;);
    }
    // Get the input
    while($data = socket_read($connection, 1024, PHP_NORMAL_READ))
    {
        $buffer = $data;
        socket_write($connection, &quot;Information Received\r\n&quot;);
        printf(&quot;Buffer: &quot; . $buffer . &quot;\r\n&quot;);
    }
    socket_close($connection);
    printf(&quot;Closed the socket\r\n\r\n&quot;);
}
?&gt;
</code></pre><p>这段程序初始化一个socket并且打开一个缓冲区收发数据。然后服务器开始等待连接，此时一旦产生一个连接，服务器将打印“Socket connected”。然后服务器检查缓冲区，如果缓冲区里有数据，服务器就把这些数据发送到连接的计算机客户端。然后服务器等待接收信息，并把接收到的信息保存，然后让连接的客户端知道信息接收成功后，服务器将关闭连接。连接关闭后，服务器将开始下一次处理连接的循环。</p>
<h3 id="-">编写客户端</h3>
<p>解决上面提到的第二个问题还是比较容易的。我们需要一个连接到服务器的页面来处理数据并发送到服务器。</p>
<p>我们来看下面的代码：</p>
<pre><code>:::PHP
&lt;?php
// Create the socket and connect 
$socket = socket_create(AF_INET, SOCK_STREAM, SOL_TCP);
$connection = socket_connect($socket,’localhost’, 1337);
while($buffer = socket_read($socket, 1024, PHP_NORMAL_READ))
{
    if($buffer == “NO DATA”)
    {
        echo(“&lt;p&gt;NO DATA&lt;/p&gt;”);
        break;
    }
    else
    {
        // Do something with the data in the buffer 
        echo(“&lt;p&gt;Buffer Data: “ . $buffer . “&lt;/p&gt;”);
    }
}
echo(“&lt;p&gt;Writing to Socket&lt;/p&gt;”);
// Write some test data to our socket
if(!socket_write($socket, “SOME DATA\r\n”))
{
    echo(“&lt;p&gt;Write failed&lt;/p&gt;”);
}
// Read any response from the socket
while($buffer = socket_read($socket, 1024, PHP_NORMAL_READ))
{
    echo(“&lt;p&gt;Data sent was: SOME DATA&lt;br&gt; Response was:” . $buffer . “&lt;/p&gt;”);
}
echo(“&lt;p&gt;Done Reading from Socket&lt;/p&gt;”);
?&gt;
</code></pre><p>这个例子的客户端连接到服务器后，客户端读取数据。如果这是客户端第一次连接服务器，服务器将发送“NO DATA”给客户端。如果客户端收到“NO DATA”说明其连接成功，客户端发送它的数据到服务器并等待服务器响应。一旦客户端接收到服务器的响应，客户端将把响应内容输出到屏幕上。</p>
<h3 id="-">总结</h3>
<p>如果还想深入了解PHP Socket，建议阅读更多的第三方资料或到PHP官方查询官方文档。今天就介绍到这里，如果有错误欢迎指正。</p>
<p>参考资料：《PHP Game Programming》</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-04-15T06:21:50.000Z"><a href="/2012/04/html5-websocket-communication-protocol/">Apr 15 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/04/html5-websocket-communication-protocol/">HTML5 之 WebSocket 通信协议介绍</a></h1>
  

    </header>
    <div class="entry">
      
        <p><strong>更新：Chrome和Firefox的WebSocket协议已更新到最新版，不再支持旧版协议。关于新版协议的介绍请看<a href="http://www.hackecho.com/" target="_blank">《WebSocket新版Hybi-10协议介绍》</a>，本篇文章中的握手协议和数据报文已不再适用。</strong></p>
<p>最近参与一个有关HTML5的比赛，要用到WebSocket，经过一些实验后简单总结一下WebSocket的基础用法。</p>
<p>WebSocket是HTML5的一种新的协议，它是实现了浏览器与服务器的双向通讯。</p>
<p>在 WebSocket API 中，浏览器和服务器只需要要做一个握手的动作，然后，浏览器和服务器之间就形成了一条快速通道。两者之间就直接可以数据互相传送。（这两小段介绍摘自维基百科）</p>
<h3 id="websocket-">WebSocket协议</h3>
<p>WebSocket的协议非常简单，这也是其最大的优点之一。</p>
<p>在客户端（如浏览器），可以利用JavaScript直接new WebSocket来实例化一个WebSocket对象，其参数格式为ws://yourdomain:port/path。WebSocket会根据这段字符串，发送Header到指定服务器端口，其数据格式大概如下：</p>
<pre><code>GET / HTTP/1.1
Origin: http://hackecho.com 
Cookie: __utma=99as
Connection: Upgrade
Host: hackecho.com
Sec-WebSocket-Key: uRovscZjNol/umbTt5uKmw==
Upgrade: websocket Sec-WebSocket-Version: 13
</code></pre><p>此时服务端应该返回的信息是：</p>
<pre><code>HTTP/1.    WebSocket Protocol Handshake
Date: Fri,     Feb     17:38:    GMT
Connection: Upgrade
Server: HackEcho Server
Upgrade: WebSocket
Access-Control-Allow-Origin: http://hackecho.com 
Access-Control-Allow-Credentials: true
Sec-WebSocket-Accept: rLHCkw/SKsO9GAH/ZSFhBATDKrU=
Access-Control-Allow-Headers: content-type
</code></pre><p>一旦握手成功建立连接，数据便可以通过WebSocket在服务器和客户端之间进行传送了。</p>
<h3 id="websocket-">WebSocket事件</h3>
<p><a href="/images/2012/04/events-500x250.jpg"><img src="/images/2012/04/events-500x250.jpg" alt=""></a></p>
<p>客户端在握手成功后，会触发WebSocket对象的onopen事件，告诉客户端连接已经成功建立了。</p>
<p>客户端的WebSocket对象一共绑定了四个事件：</p>
<p>1、onopen：连接建立时触发；</p>
<p>2、onmessage：收到服务端消息时触发；</p>
<p>3、onerror：连接出错时触发；</p>
<p>4、onclose：连接关闭时触发；</p>
<h3 id="-">客户端连接的建立</h3>
<p>这里提供一个例子来更好地理解客户端是怎样建立WebSocket连接的。例子来自于文末参考资料的第一篇文章。</p>
<p>将下列代码保存为一个html文件，如websocket.html，在浏览器中打开。页面会自动向服务器（由<a href="http://www.websocket.org提供）连接，发送一个消息并将返回的结果显示出来，最后断开连接。" target="_blank">http://www.websocket.org提供）连接，发送一个消息并将返回的结果显示出来，最后断开连接。</a></p>
<p>通过其中的JavaScript代码即可看出用JS在本地建立连接的所有过程，比较简单，不再赘述，请大家看代码。</p>
<p>（不知怎么回事，如果去掉行号的代码缩进会乱掉，所以只能带上行号... 网上有很多去行号方法，大家可以Google之。）</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;meta charset=&quot;utf-8&quot; /&gt;
&lt;title&gt;
    WebSocket Test
&lt;/title&gt;
&lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot;&gt;
    var wsUri = &quot;ws://echo.websocket.org/&quot;;
    var output;
    function init() {
        output = document.getElementById(&quot;output&quot;);
        testWebSocket();
    }
    function testWebSocket() {
        websocket = new WebSocket(wsUri);
        websocket.onopen = function(evt) {
            onOpen(evt)
        };
        websocket.onclose = function(evt) {
            onClose(evt)
        };
        websocket.onmessage = function(evt) {
            onMessage(evt)
        };
        websocket.onerror = function(evt) {
            onError(evt)
        };
    }
    function onOpen(evt) {
        writeToScreen(&quot;CONNECTED&quot;);
        doSend(&quot;WebSocket rocks&quot;);
    }
    function onClose(evt) {
        writeToScreen(&quot;DISCONNECTED&quot;);
    }
    function onMessage(evt) {
        writeToScreen(&#39;&lt;span style=&quot;color: blue;&quot;&gt;RESPONSE: &#39; + evt.data + &#39;&lt;/span&gt;&#39;);
        websocket.close();
    }
    function onError(evt) {
        writeToScreen(&#39;&lt;span style=&quot;color: red;&quot;&gt;ERROR:&lt;/span&gt; &#39; + evt.data);
    }
    function doSend(message) {
        writeToScreen(&quot;SENT: &quot; + message);
        websocket.send(message);
    }
    function writeToScreen(message) {
        var pre = document.createElement(&quot;p&quot;);
        pre.style.wordWrap = &quot;break-word&quot;;
        pre.innerHTML = message;
        output.appendChild(pre);
    }
    window.addEventListener(&quot;load&quot;, init, false);
&lt;/script&gt;
&lt;h2&gt;
    WebSocket Test
&lt;/h2&gt;
&lt;div id=&quot;output&quot;&gt;
&lt;/div&gt;

&lt;/html&gt;
</code></pre><h3 id="-">服务器端的实现</h3>
<p>在将WebSocket应用到实际中时，我们往往需要自己的服务器来响应各种请求以实现更加丰富的功能。从前面的协议介绍部分来看，实现一个WebSocket服务器端并不难。但本着“不重复制造轮子”的原则，我们将基于开源的<a href="http://code.google.com/p/phpwebsocket/" target="_blank">PHPWebSocket Project</a>来二次开发自己的服务器。PHPWebSocket Project中已实现握手协议部分，其它的功能将可以由我们自由添加。这里只讨论握手协议部分和一个简单的响应函数。</p>
<p>将下列代码保存为server.php文件：</p>
<pre><code>&lt;?php
error_reporting(E_ALL);
set_time_limit(0);
ob_implicit_flush();

$master  = WebSocket(&quot;localhost&quot;,12345);
$sockets = array($master);
$users   = array();
$debug   = false;

while(true){
    $changed = $sockets;
    socket_select($changed,$write=NULL,$except=NULL,NULL);
    foreach($changed as $socket){
        if($socket==$master){
            $client=socket_accept($master);
            if($client&lt;0){ console(&quot;socket_accept() failed&quot;); continue; }
            else{ connect($client); }
        }
        else{
            $bytes = @socket_recv($socket,$buffer,2048,0);
            if($bytes==0){ disconnect($socket); }
            else{
                $user = getuserbysocket($socket);
                if(!$user-&gt;handshake){ dohandshake($user,$buffer); }
                else{ process($user,$buffer); }
            }
        }
    }
}

//---------------------------------------------------------------
function process($user,$msg){
    $action = unwrap($msg);
    say(&quot;&lt; &quot;.$action);
    send($user-&gt;socket,&quot;lzy &quot;.$action);
}

function send($client,$msg){
    say(&quot;&gt; &quot;.$msg);
    $msg = wrap($msg);
    socket_write($client,$msg,strlen($msg));
}

function WebSocket($address,$port){
    $master=socket_create(AF_INET, SOCK_STREAM, SOL_TCP)     or die(&quot;socket_create() failed&quot;);
    socket_set_option($master, SOL_SOCKET, SO_REUSEADDR, 1)  or die(&quot;socket_option() failed&quot;);
    socket_bind($master, $address, $port)                    or die(&quot;socket_bind() failed&quot;);
    socket_listen($master,20)                                or die(&quot;socket_listen() failed&quot;);
    echo &quot;Server Started : &quot;.date(&#39;Y-m-d H:i:s&#39;).&quot;\n&quot;;
    echo &quot;Master socket  : &quot;.$master.&quot;\n&quot;;
    echo &quot;Listening on   : &quot;.$address.&quot; port &quot;.$port.&quot;\n\n&quot;;
    return $master;
}

function connect($socket){
    global $sockets,$users;
    $user = new User();
    $user-&gt;id = uniqid();
    $user-&gt;socket = $socket;
    array_push($users,$user);
    array_push($sockets,$socket);
    console($socket.&quot; CONNECTED!&quot;);
}

function disconnect($socket){
    global $sockets,$users;
    $found=null;
    $n=count($users);
    for($i=0;$i&lt;$n;$i++){
        if($users[$i]-&gt;socket==$socket){ $found=$i; break; }
    }
    if(!is_null($found)){ array_splice($users,$found,1); }
    $index = array_search($socket,$sockets);
    socket_close($socket);
    console($socket.&quot; DISCONNECTED!&quot;);
    if($index&gt;=0){ array_splice($sockets,$index,1); }
}

function dohandshake($user,$buffer){
    console(&quot;\nRequesting handshake...&quot;);
    console($buffer);
    list($resource,$host,$origin,$strkey1,$strkey2,$data) = getheaders($buffer);
    console(&quot;Handshaking...&quot;);

    $pattern = &#39;/[^\d]*/&#39;;
    $replacement = &#39;&#39;;
    $numkey= preg_replace($pattern, $replacement, $strkey1);
    $numkey= preg_replace($pattern, $replacement, $strkey2);

    $pattern = &#39;/[^ ]*/&#39;;
    $replacement = &#39;&#39;;
    $spaces= strlen(preg_replace($pattern, $replacement, $strkey1));
    $spaces= strlen(preg_replace($pattern, $replacement, $strkey2));

    if ($spaces== || $spaces== || $numkey% $spaces!= || $numkey% $spaces!= 0) {
        socket_close($user-&gt;socket);
        console(&#39;failed&#39;);
        return false;
    }

    $ctx = hash_init(&#39;md5&#39;);
    hash_update($ctx, pack(&quot;N&quot;, $numkey1/$spaces1));
    hash_update($ctx, pack(&quot;N&quot;, $numkey2/$spaces2));
    hash_update($ctx, $data);
    $hash_data = hash_final($ctx,true);

    $upgrade  = &quot;HTTP/1.WebSocket Protocol Handshake\r\n&quot; .
    &quot;Upgrade: WebSocket\r\n&quot; .
    &quot;Connection: Upgrade\r\n&quot; .
    &quot;Sec-WebSocket-Origin: &quot; . $origin . &quot;\r\n&quot; .
    &quot;Sec-WebSocket-Location: ws://&quot; . $host . $resource . &quot;\r\n&quot; .
    &quot;\r\n&quot; .
    $hash_data;

    socket_write($user-&gt;socket,$upgrade.chr(0),strlen($upgrade.chr(0)));
    $user-&gt;handshake=true;
    console($upgrade);
    console(&quot;Done handshaking...&quot;);
    return true;
}

function getheaders($req){
    $r=$h=$o=null;
    if(preg_match(&quot;/GET (.*) HTTP/&quot;   ,$req,$match)){ $r=$match[1]; }
    if(preg_match(&quot;/Host: (.*)\r\n/&quot;  ,$req,$match)){ $h=$match[1]; }
    if(preg_match(&quot;/Origin: (.*)\r\n/&quot;,$req,$match)){ $o=$match[1]; }
    if(preg_match(&quot;/Sec-WebSocket-Key2: (.*)\r\n/&quot;,$req,$match)){ $key2=$match[1]; }
    if(preg_match(&quot;/Sec-WebSocket-Key1: (.*)\r\n/&quot;,$req,$match)){ $key1=$match[1]; }
    if(preg_match(&quot;/\r\n(.*?)\$/&quot;,$req,$match)){ $data=$match[1]; }
    return array($r,$h,$o,$key1,$key2,$data);
}

function getuserbysocket($socket){
    global $users;
    $found=null;
    foreach($users as $user){
        if($user-&gt;socket==$socket){ $found=$user; break; }
    }
    return $found;
}

function     say($msg=&quot;&quot;){ echo $msg.&quot;\n&quot;; }
function    wrap($msg=&quot;&quot;){ return chr(0).$msg.chr(255); }
function  unwrap($msg=&quot;&quot;){ return substr($msg,1,strlen($msg)-2); }
function console($msg=&quot;&quot;){ global $debug; if($debug){ echo $msg.&quot;\n&quot;; } }

class User{
    var $id;
    var $socket;
    var $handshake;
}

?&gt;
</code></pre><p>运行php server.php命令启动服务器，这时服务器启动。</p>
<p>然后我们将下列代码保存为client.html文件：</p>
<pre><code>&lt;html&gt;
&lt;head&gt;
&lt;title&gt;WebSocket&lt;/title&gt;

&lt;style&gt;
html,body{font:normal 0.9em arial,helvetica;}
#log {width:440px; height:200px; border:1px solid #7F9DB9; overflow:auto;}
#msg {width:330px;}
&lt;/style&gt;

&lt;script&gt;
var socket;

function init(){
    var host = &quot;ws://localhost:12345/websocket/server.php&quot;;
    try{
        socket = new WebSocket(host);
        log(&#39;WebSocket - status &#39;+socket.readyState);
        socket.onopen    = function(msg){ log(&quot;Welcome - status &quot;+this.readyState); };
        socket.onmessage = function(msg){ log(&quot;Received: &quot;+msg.data); };
        socket.onclose   = function(msg){ log(&quot;Disconnected - status &quot;+this.readyState); };
    }
    catch(ex){ log(ex); }
    $(&quot;msg&quot;).focus();
}

function send(){
    var txt,msg;
    txt = $(&quot;msg&quot;);
    msg = txt.value;
    if(!msg){ alert(&quot;Message can not be empty&quot;); return; }
    txt.value=&quot;&quot;;
    txt.focus();
    try{ socket.send(msg); log(&#39;Sent: &#39;+msg); } catch(ex){ log(ex); }
}
function quit(){
    log(&quot;Goodbye!&quot;);
    socket.close();
    socket=null;
}

// Utilities
function $(id){ return document.getElementById(id); }
function log(msg){ $(&quot;log&quot;).innerHTML+=&quot;&lt;br&gt;&quot;+msg; }
function onkey(event){ if(event.keyCode==13){ send(); } }
&lt;/script&gt;

&lt;/head&gt;
&lt;body onload=&quot;init()&quot;&gt;
&lt;h3&gt;WebSocket v2.00&lt;/h3&gt;
&lt;div id=&quot;log&quot;&gt;&lt;/div&gt;
&lt;input id=&quot;msg&quot; type=&quot;textbox&quot; onkeypress=&quot;onkey(event)&quot;/&gt;
&lt;button onclick=&quot;send()&quot;&gt;Send&lt;/button&gt;
&lt;button onclick=&quot;quit()&quot;&gt;Quit&lt;/button&gt;
&lt;div&gt;Commands: hello, hi, name, age, date, time, thanks, bye&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><p>这时在浏览器中打开client.html，即可实现一个简单的通过WebSocket连接到本地服务器然后发送消息、响应消息的应用。</p>
<p>有兴趣的读者可以继续阅读以下参考资料：</p>
<h3 id="-">参考资料：</h3>
<p><a href="http://www.websocket.org/echo.html" target="_blank">《WebSocket Echo Test》</a></p>
<p><a href="http://www.zendstudio.net/archives/websocket-protocol/" target="_blank">《websocket 通信协议》</a></p>
<p><a href="http://blog.bingo929.com/html5-websockets.html" target="_blank">《HTML5 WebSockets 基础使用教程》</a></p>
<p><a href="http://zh.wikipedia.org/zh-cn/WebSocket" target="_blank">《WikiPedia WebSocket》</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-03-22T20:09:09.000Z"><a href="/2012/03/how-to-create-a-personal-blog/">Mar 22 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/03/how-to-create-a-personal-blog/">如何搭建个人独立博客</a></h1>
  

    </header>
    <div class="entry">
      
        <p>最近一些朋友问起怎样搭建独立博客，想到以前自己折腾时的迷茫和走过的一些弯路，觉得有必要稍微总结一下。这里简单描述一下整体上的步骤吧。</p>
<p><strong>严正声明：</strong>由于文章的特殊性，其中难免会涉及到一些域名商、主机商等，绝不存在任何广告嫌疑或其它意图，特此声明。</p>
<p>文章结构：</p>
<ul>
<li>独立博客与BSP的区别</li>
</ul>
<ul>
<li>申请域名</li>
</ul>
<ul>
<li>服务器主机</li>
</ul>
<ul>
<li>域名绑定</li>
</ul>
<ul>
<li>安装程序</li>
</ul>
<ul>
<li>开始使用</li>
</ul>
<h3 id="-bsp-">独立博客与BSP的区别</h3>
<p>BSP是指Blog Service Provider，意指第三方博客服务提供商，如新浪博客、搜狐博客等。BSP提供给你的是一个写博客的平台，对于整站程序或模板都无法实现自定义，而且域名只能是二级域名或三级域名（如xxx.blog.sina.com.cn）。而独立博客之所以“独立”，是因为其高度的自定义。比如域名是顶级的，还可以自选，博客程序自己可以选择，还可以定制，模板的话也可以自由定制。只要你能想到的，都可以做到。</p>
<p>但独立博客也有其缺点，如域名和主机要自己买，数据备份要自己做（弄不好会全站丢失数据），人气需要自己建立等等。不过这些对于我们来讲都是可以学习的，而且这些知识对于我们软件学院学生来讲迟早都要接触到，为何不早点利用呢。</p>
<p>写独立博客还有很多很多好处，写得时间久了自然能体会到。具体可以参看这篇文章<a href="http://www.hackecho.com/archives/38.html" target="_blank">《为什么你应该从现在开始就写博客》</a>，这里呢只说一点我的小感受，就是每天晚上的时候自己都会想，今天要写什么博客呢，然后就会在脑海中把整整一天都干了些什么、学了些什么回想一遍。但大多情况都发现自己一天其实没学到什么...然后就会BS自己一下，不断告诉自己，每天都要创造价值！</p>
<h3 id="-">申请域名</h3>
<p>既然是独立博客，当然要有一个独立域名，所以申请域名是第一步。个人不是很建议在国内注册域名，原因大家心里都明白哈。</p>
<p>首先是域名的选取问题。.com是比较合适的，当然也有人倡导个人博客用.me域名更酷。仁者见仁，智者见智，除了.org/.gov/.edu等专有域名外，其它都是可以的。.cn由于国家的最新政策，个人已经不允许申请了，那个cn域名白菜价的时代已经过去了：）至于域名名称，全凭个人爱好了，以前我的是uutroy.com，后来换成了现在Hackecho.com，原域名做了一个永久301重定向，依旧能用。域名最好一次选好，不要频繁更换，否则影响很大...</p>
<p>对于域名注册商，Godaddy.com和name.com口碑不错，Godaddy支持支付宝，网上还有很多优惠码，推荐使用。</p>
<h3 id="-">服务器主机</h3>
<p>这是最头疼的一个问题。以前瞎折腾的时候，主机这儿吃过不少亏，总的来说，建议大家买香港或美国的主机，如果想尽情折腾可以考虑使用VPS。很重要的一点：大多数博客程序（如Wordpress）都是PHP系统，所以一定要买PHP的主机，当然如果是其它语言的系统，就买相应的主机即可。</p>
<p>香港的主机我在衡天小张那里买过几款，使用情况还不错，ping值也不是很高，推荐一下。另外Wopus的主机也可以（新软攀峰官网的主机使用的是Wopus的VPS合租，可以<a href="http://bjtuxrpf.com" target="_blank">点击这里</a>测试）。</p>
<p>美国主机商很多很多，我们可以选择的也很多。这里简单列举几家，因为没有全部试用过，所以不做具体评论。</p>
<ul>
<li>Bluehost</li>
</ul>
<ul>
<li>Hawkhost</li>
</ul>
<ul>
<li>HostGator</li>
</ul>
<ul>
<li>HostMonster</li>
</ul>
<ul>
<li>DreamHost</li>
</ul>
<ul>
<li>等等等等</li>
</ul>
<p>VPS的话推荐Linode VPS，现在我用的就是Linode Fremont机房的512配置。</p>
<p>关于各种主机之间的差别，比如是否独立IP，DA或CPanel面板的区别，子目录绑定啥的，现在还不比完全弄明白，慢慢地也就知道了：）</p>
<p>IDC市场水太深，涉足需谨慎。</p>
<h3 id="-">域名绑定</h3>
<p>有了域名，有了主机，接下来就是把域名绑定到主机上，就可以通过域名访问主机了。下面以Godaddy为例：</p>
<p>由于Godaddy自己提供的DNS服务器在中国几乎全线被封，所以一般第一步我们要更换DNS解析服务器。我用的是国内的DNSPOD，还不错。具体怎样更改，完全又可以写篇博客了，而且网上现有的教程很多，本着高重用性的原则，这里不再赘述，请自行Google之。</p>
<p>更改DNS服务器一般几十分钟或1-2个小时生效，然后就可以在DNSPOD里管理自己的域名解析了。</p>
<p>最基本的是要添加两条A记录解析到主机IP，一条www的，一条@的，分别对应www.example.com和example.com。更多的请参考DNSPOD的帮助文档，非常详细。</p>
<p>DNSPOD的解析生效速度简直就是神速，我这里一般情况下几十秒生效。当然也有几个小时生效的可能性发生，那就只能等了。</p>
<h3 id="-">安装程序</h3>
<p>解析生效后，就可以安装博客程序了。可以选择Wordpress，或者国人开发的Typecho或Emlog等等。我使用的是Wordpress，推荐一下，相信你也会喜欢上它的。</p>
<p>将Wordpress的文件上传到服务器站点目录，建立好数据库，然后访问你的域名，一路“下一步”就OK了。</p>
<h3 id="-">开始使用</h3>
<p>OK，Enjoy it！</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-02-17T06:34:02.000Z"><a href="/2012/02/convertion-of-gbk-and-utf8-on-mac/">Feb 17 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/02/convertion-of-gbk-and-utf8-on-mac/">Mac下GBK与UTF8编码文件的批量转换</a></h1>
  

    </header>
    <div class="entry">
      
        <p>下载了一个Python改写的C语言100例，结果原作者使用的编码都是GBK，而我现在使用的Sublime Text 2和Textmate等都不支持GBK编码，导致打开全是乱码。网上也没有找到相应的转换工具，只好另辟蹊径。</p>
<p>关键时刻还是 Terminal 给力，介绍一条shell命令：iconv</p>
<p>就不细细介绍了，看下面的例子，就都懂了：</p>
<pre><code>iconv --list # 显示可识别的编码名称
iconv --list &gt;./infomation.log # 显示可识别的编码名称，将信息存入infomation.log文件中
iconv -f GB2312 -t UTF-8 a.html &gt; b.html # 转换GB2312编码的文件a.html为UTF-8编码，存入b.html
iconv -f GB2312 -t BIG5 a.html &gt; b.html # 转换GB2312编码的文件a.html为BIG5编码，存入b.html
</code></pre><p>进入正题，我们先cd进入保存所有文件的文件夹，然后执行下列命令：</p>
<pre><code>find *.py -exec sh -c &quot;iconv -f GB18030 -t UTF8 {} &gt; {}.py&quot; \;  
</code></pre><p>上面命令中的GB18030，如果你转换前的编码为GB2312，将 GB18030 代替为 GB2312 即可。</p>
<p>OK，搞定！</p>
<h3 id="-">补充说明：</h3>
<p>这只是为<strong>批量转换</strong>而生的方法，如果只是转换一两个文件，则可以直接在右键菜单中选择 服务-&gt;转换选定的简体中文文件 即可。当然，也可以用一款支持GBK的编辑器打开文件后存储一份新的UTF8格式的文件即可。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-01-30T05:35:33.000Z"><a href="/2012/01/git-notes/">Jan 29 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/01/git-notes/">Git 学习笔记</a></h1>
  

    </header>
    <div class="entry">
      
        <p>学习Git的笔记，会不定期更新。</p>
<p>我的Github地址：<a href="https://github.com/zlmoment" target="_blank"><a href="https://github.com/uutroy">https://github.com/uutroy</a></a></p>
<p>首先推荐两篇非常好的入门：</p>
<ul>
<li><a href="http://gitimmersion.com/" target="_blank">Git Immersion</a></li>
</ul>
<ul>
<li><a href="http://www.ralfebert.de/tutorials/git/#commit_a" target="_blank">Git Tutorial</a></li>
</ul>
<p>一般流程：取代码 → 更新到最新版本 → 修改代码 → 提交</p>
<h2 id="creating-a-new-repository">Creating a new repository</h2>
<blockquote>
<p>$ git init</p>
</blockquote>
<h2 id="-">取代码及修改全局设置</h2>
<p>git在创建提交的时候会记录你的名字和email地址，所以你应该告诉git这些内容。可以使用’git config’命令来设置，如果传递参数’-global’ ，它会将这些值记录在~/.gitconfig文件里，作为这些配置的默认值。</p>
<p>设置用户名与邮箱</p>
<blockquote>
<p>git config –global user.name “name”</p>
</blockquote>
<p>git config –global user.email “username@email.com”</p>
<p>查看设置值</p>
<blockquote>
<p>git config user.name</p>
</blockquote>
<p>从已有的git库中提取代码</p>
<blockquote>
<p>git clone git@github.com:appname.git myrepo</p>
</blockquote>
<h2 id="-">每次更改代码的操作</h2>
<p>更新本地代码到最新版本（需要merge才能合到本地代码中）</p>
<blockquote>
<p>git fetch</p>
</blockquote>
<p>合并更新后的代码到本地</p>
<blockquote>
<p>git merge</p>
</blockquote>
<p>更新代码方式的另一种方法(git pull是git fetch和git merge命令的一个组合)</p>
<blockquote>
<p>git pull</p>
</blockquote>
<p>修改代码后，查看已修改的内容</p>
<blockquote>
<p>git diff –cached</p>
</blockquote>
<p>将新增加文件加入到git中</p>
<blockquote>
<p>git add file1 file2 file3</p>
</blockquote>
<p>从git中删除文件</p>
<blockquote>
<p>git rm file1</p>
</blockquote>
<p>git rm -r dir1</p>
<p>提交修改</p>
<blockquote>
<p>git commit -m ‘this is memo’</p>
</blockquote>
<p>如果想省掉提交之前的 git add 命令，可以直接用</p>
<blockquote>
<p>git commit -a -m ‘this is memo’</p>
</blockquote>
<p>commit和commit -a的区别,：</p>
<p>commit -a相当于：</p>
<p>第一步：自动地add所有改动的代码，使得所有的开发代码都列于index file中</p>
<p>第二步：自动地删除那些在index file中但不在工作树中的文件</p>
<p>第三步：执行commit命令来提交</p>
<p>提交所有修改到远程服务器：</p>
<blockquote>
<p>git push</p>
</blockquote>
<h2 id="-">其它常用命令</h2>
<p>显示commit日志</p>
<blockquote>
<p>git log</p>
</blockquote>
<p>不仅显示commit日志，而且同时显示每次commit的代码改变。</p>
<blockquote>
<p>git log -p</p>
</blockquote>
<p>回滚代码：</p>
<blockquote>
<p>git revert HEAD</p>
</blockquote>
<p>你也可以revert更早的commit，例如：</p>
<blockquote>
<p>git revert HEAD^</p>
</blockquote>
<p>将branchname分支合并到当前分支中。(如果合并发生冲突，需要自己解决冲突)</p>
<blockquote>
<p>git merge branchname</p>
</blockquote>
<p>解决冲突</p>
<p>当merge命令自身无法解决冲突的时候，它会将工作树置于一种特殊的状态，并且给用户提供冲突信息，以期用户可以自己解决这些问题。当然在这个时候，未发生冲突的代码已经被git merge登记在了index file里了。如果你这个时候使用git diff，显示出来的只是发生冲突的代码信息。</p>
<p>在你解决了冲突之前，发生冲突的文件会一直在index file中被标记出来。这个时候，如果你使用git commit提交的话，git会提示：filename.txt needs merge</p>
<p>在发生冲突的时候，如果你使用git status命令，那么会显示出发生冲突的具体信息。</p>
<p>在你解决了冲突之后，你可以使用如下步骤来提交：</p>
<p>第一步(如果需要增加文件)：</p>
<blockquote>
<p>git add file1</p>
</blockquote>
<p>第二步：</p>
<blockquote>
<p>git commit</p>
</blockquote>
<p>参考资料：<a href="http://blog.enjoyrails.com/2008/12/31/git%E4%B8%80%E5%88%86%E9%92%9F%E6%95%99%E7%A8%8B/" target="_blank">《Git一分钟教程》</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-01-14T20:37:12.000Z"><a href="/2012/01/solution-to-need-of-ftp-account-in-wordpress/">Jan 14 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/01/solution-to-need-of-ftp-account-in-wordpress/">Wordpress提示填写FTP信息的解决办法</a></h1>
  

    </header>
    <div class="entry">
      
        <p>在上一篇文章《<a href="http://www.hackecho.com/" target="_blank">VPS折腾记</a>》中提到在升级Wordpress或添加删除主题和插件的时候需要填写FTP账户信息的问题，提示一般如下：</p>
<blockquote>
<p>要执行请求的操作，WordPress 需要访问您网页服务器的权限。 请输入您的 FTP 登录凭据以继续。 如果您忘记了您的登录凭据（如用户名、密码），请联系您的网站托管商。</p>
</blockquote>
<p>一般情况下，虚拟主机很少会出现这样的情况，如果使用 VPS 的话，这种情况就会比较多。主要原因是网站服务器运行PHP的用户和Wordpress文件夹的所有者不一样，目的就是为了安全，Wordpress在升级时会创建一个临时文件看看owner是不是和当前运行的PHP是否一样，如果不一样，就会出现这个界面。</p>
<p>第一种解决办法很简单，就是直接在wp-config.php 中加入FTP的配置代码：</p>
<pre><code>// ** FTP SETTINGS FOR AUTO-UPDATE ** //
define(‘FTP_HOST’, ‘localhost’);
define(‘FTP_USER’, ‘ftp帐号’);
define(‘FTP_PASS’, ‘ftp密码’);
</code></pre><p>当然我们更想从根本上解决问题，那么第二种个方法，就要从用户组下手了。</p>
<p>针对有高级管理权限的用户，如服务器或 VPS 等管理员，只需将 PHP 和网站目录设置成同一个用户组即可。一般是 www 用户组跑 PHP，所以将网站所在目录内所有文件夹和文件设置成www用户组即可，输入命令：</p>
<pre><code>chown -R www /home/wwwroot  
chgrp -R www /home/wwwroot  
</code></pre><p>记住将上述命令中的网站目录路径改为自己的路径即可。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2011-11-20T03:39:56.000Z"><a href="/2011/11/thinking-of-multi-level-classification/">Nov 19 2011</a></time>
      
      
  
    <h1 class="title"><a href="/2011/11/thinking-of-multi-level-classification/">关于多级分类的一个思考</a></h1>
  

    </header>
    <div class="entry">
      
        <p>最近做的几个项目都设计到了多级分类，不太清楚数据表怎样设计。经过一番探究后，发现一般有以下几种解决方案：</p>
<ul>
<li>每级分类一张表</li>
</ul>
<ul>
<li>只有一张分类表</li>
</ul>
<ul>
<li>一张分类名称表+一张分类关系表</li>
</ul>
<p>第三种方法是参考了Wordpress本身的分类方法，个人感觉用在手里的项目中有点大材小用，于是主要目标是在前两种中选择一种。</p>
<p>首先来看第一种，这是一般最先想到的方法，而且相对比较简单。但马上一想就会发现这种方法的弊端，如果只有两级分类还可以凑合，但如果涉及到多级分类或无限极分类就麻烦了，如果是五级分类就会有五张表，这明显不以维护而且不符合数据库设计原则。</p>
<p>再来看第二种方案：</p>
<p>如果只有一张表，那么我们必须能够标识各个分类之间的层次关系，层级等级。第一次的设计是这样的：</p>
<blockquote>
<p>cid</p>
<p>cname（分类名称）</p>
<p>parentcid（上级分类ID）</p>
<p>cat_level（当前分类层次）</p>
</blockquote>
<p>貌似很完美的样子，而且支持无限级分类。但在使用过程中发现一个问题：虽然有一个分类层次，但排序后它们的层次还是无法直接显示出来。（在其中一个项目中曾经使用过这种方法，当时的解决方案是在View层又加了一次排序来动态的生成HTML代码，每次排序都要遍历一次父类，很恐怖。）。于是，第二次设计修改如下：</p>
<blockquote>
<p>cid</p>
<p>cname（分类名称）</p>
<p>parentcid（上级分类ID）</p>
<p>cat_level（当前分类层次）</p>
<p>cat_path（当前分类路径）</p>
</blockquote>
<p>其中增加了一个字段分类路径，意思是当前分类到顶级分类的完整路径，以一级ID,二级ID，…..，当前级ID的格式存储。如1,2,2。这样的好处是，我们按分类路径进行一下排序会发现它自然地按照层级关系读取出数据来了，层次清晰，简单明了。</p>
<p>好了，先说到这儿，关于更多的多级分类的数据表设计我们以后再深入讨论。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2011-11-17T07:57:09.000Z"><a href="/2011/11/childhood-of-programming-and-computer/">Nov 17 2011</a></time>
      
      
  
    <h1 class="title"><a href="/2011/11/childhood-of-programming-and-computer/">那些年与编程和计算机有关的小事儿</a></h1>
  

    </header>
    <div class="entry">
      
        <p>不知道写这种文章算不算回忆录，因为说回忆录未免有些早。记得初中的时候写过一本《我的小学回忆录》，将从入学一年级第一天起开始能想起来的人和事都记录了下来，如今这本未出版的手写书已不知去向，小学的记忆也越来越模糊。忽然想不如趁着现在对一些往事还尚存记忆，稍微回忆一下，也算对自己的鼓励吧。</p>
<p>从小就是一个对电脑比较感兴趣的人，有时候兴趣是没有理由的，因为那时周围很多同学使用电脑仅限于聊QQ和半条命，而我却对除此之外的一些其它东西有着非常浓厚的兴趣。印象比较深的是买了很多很多的电脑书籍，当时最惬意的事情就是趴在桌前，做完作业后看那本比砖头还厚的《电脑医院》，一看就是四五个小时，后来还照葫芦画瓢写了个破坏注册表的.reg脚本，号称是我制造的第一个电脑病毒！</p>
<p>由于很多电脑名词不明白，便买书、查资料。什么《注册表终极操作》、《BIOS配置指南》、《电脑上网故障1000问》、《榨干你的电脑》等等，还有全年的《电脑迷》、《电脑爱好者》、《IT新闻周刊》和不怎么看得懂的《CHIP新电脑》等。尤记得当时第一次重装系统时的激动，第一次电脑崩溃时的伤心，第一次编译通过一个程序，第一次入侵别人电脑等等的第一次，现在回想起来，真有一番体味。</p>
<p>跟所有少年一样，在当时那个年龄段，都有一个黑客梦。当时最崇拜的人是陈盈豪，因为他的CIH病毒第一次颠覆了我的观念：病毒原来还可以破坏硬件设备！不过我始终没有去静下心来潜心研究那些汇编代码，不过那段经历确实小小地满足了一个少年的黑客梦，至少，成功盗过QQ，成功入侵肉鸡植入灰鸽子，成功进入某网站根目录....不过作为一个遵循黑客守则的少年，盗来的QQ一个都没动过，灰鸽子也没干过不好的事情，入侵网络更是进一下就退出了而已。</p>
<p>当然，后来不再继续研究“黑客”，开始研究正道。但之前crack、0day的一些经历还是让我学到了很多很多东西。永远感激一个论坛，让我得以成长，著名的看雪论坛。</p>
<p>说到后来的编程，不得不提到Delphi 7，这是成功生产出我人生中第一款像样软件的工具和语言。当时其实什么也不懂，也不知道什么是面向对象，什么是数据库，也没又编程基础，但好在Delphi 7有很多例子，结果照猫画虎竟也做出了我的处女作软件，是一款心理测试的程序，叫做“美丽预测”。当时还加了注册码，哈哈，现在想想真是有意思。当时比较火的软件站有天空和华军，于是便试着做了一些投递。只有很少一部分软件站收录了“美丽预测”，而现在，这款软件已经在网上完全找不到踪影了，不过在家里的电脑里，永远珍藏着它的所有源代码和所有版本。感谢当时用到的SetupFactory和其它各类工具。当时我初三。</p>
<p><img src="/images/2011/11/200910181953287680.jpg" alt=""></p>
<p>后来有一段时间我下载了最新版的Delphi，结果发现已经不再是使用Pascal了。Delphi 7还是那个永远的Delphi 7，因为它是记忆中的经典，至少对于我来说，是的。</p>
<p>再后来，有了基础，便开始接触到MS的VS系列，其实这不是第一次接触VS系列，真正的第一次接触还是在小学时，传统的DOS机器上的Fox。时间太久，以至于都不记得Fox是用来干嘛的了，只记得黑屏白字和打出的一张张表格（貌似是数据表吧）。图形界面出来后，虽然带来的极大的方便，但那种没有鼠标，清一色的方正牌机器，黑屏白字和大大的显示器，还是我对电脑的第一印象呢。</p>
<p>接下来，我也不知道何时起，开始迷上了互联网编程。当时傻傻地用FrontPage做了自己的“李昭谕工作室”网站，还帮同学做了“某某军事图片网站”，当时是用扫描仪一张一张将图片扫描进电脑，然后用扫描仪自带的编辑软件编辑图片（当时不会PS），然后一张张放到网页做好链接等等。当时感觉FrontPage简直就是神器啊！什么都可以做，乐此不疲。直至后来，开始学习了HTML和CSS后，才发现用记事本手动写网页才是最好的方法，FP和DW都是浮云。不过那段回忆真得很美好，当时所有做好的网站都已经打包放在家里的电脑上，偶尔去看看，看看当时傻傻的我。</p>
<p>这大概就是童年时代一些与编程和计算机有关的小事儿了，当然不是全部，还有很多经典的回忆片段没有写下来，还有一些经典的工具软件没有记下来。不过还是在此缅怀一下那些逝去的经典软件，那些经典的黑客工具，还有那些逝去的记忆。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2011-11-10T03:15:03.000Z"><a href="/2011/11/deployment-of-thinkphp/">Nov 9 2011</a></time>
      
      
  
    <h1 class="title"><a href="/2011/11/deployment-of-thinkphp/">ThinkPHP部署二三事儿</a></h1>
  

    </header>
    <div class="entry">
      
        <p>费尽周折，终于得以进入信息中心的机房一探究竟了。学校所有的服务器和托管服务器都在这里，内景也跟之前想象的差不多，整齐的一排排机柜，各种颜色的指示灯和密密麻麻的网线，还有很强大的冷却空调。不过唯一不爽的是巨大的噪音。</p>
<p>今天是去部署ThinkPHP刚做的一套系统，和安秦共同完成的。从上周六到今天，除了上课时间外火力全开，终于如期完成。当然还有不如意的地方，马上进入内测阶段，接受考验，哈哈。</p>
<p>简单总结一下今天遇到的各种奇奇怪怪的问题，经过我们五个小时的探索，还好都算解决了。不过也看出来自己真正薄弱的地方，下一步继续努力。</p>
<p>我们把原服务器格式化重新安装了Ubuntu 11.04。之前想安装Windows Server 2003，不过又想正好借机实践一下近期学的Linux知识，于是果断换了Ubuntu系统。考虑到使用方便问题，没有用Server版，桌面版够用。</p>
<p>安装的过程还算顺利，服务器配置很强大，跑个Ubuntu还是很顺利的。然后就遇到了第一个问题，也是我们今天遇到的最坑爹，最苦恼，最没有办法的问题。。</p>
<p>由于是内网部署，我们配好静态IP后，竟然发现不能访问！可以ping通，但访问时一直都是Forbidden状态。我们上网查各种方法来试图解决，都无法打通内网和外网这个桥梁。唯一能访问的知识同域内的几个网站，比如特思论坛。更痛苦的是无法连接上交大的开源镜像，导致Ubuntu无法配置PHP服务器环境。。。</p>
<p>其实问题很简单，管理员的内外网端口映射已经做好，但防火墙配置出现问题，把我们的所有请求都拦截了...也就是说，我们需要联系管理员配置下网络防火墙即可。。。</p>
<p>接着我们配置好了PHP运行环境，将我们的项目进行部署。这里的问题都是关于ThinkPHP的了，大牛可以直接略过。</p>
<p><strong>乱码问题</strong></p>
<p>嗯，不用多说，MySQL编码的问题...</p>
<p><strong>权限问题</strong></p>
<p>ThinkPHP的Runtime文件夹需要755的权限，直接从Windows环境下拷过去的项目一定要重新配置下权限。</p>
<p><strong>找不到Public模块</strong></p>
<p>我们用.htaccess配置了URLRewrite，把index.php隐去了，但奇怪的是诸如<a href="http://localhost/Public/...的地址全部都显示为“无法找到Public模块。”Public是个共用文件夹，我们把一些图片，CSS和JS放在里面，但ThinkPHP却去加载Public" target="_blank">http://localhost/Public/...的地址全部都显示为“无法找到Public模块。”Public是个共用文件夹，我们把一些图片，CSS和JS放在里面，但ThinkPHP却去加载Public</a> Action，导致无法找到模块。</p>
<p>起初以为是.htaccess的问题，安秦把重写规则改了好多遍依旧不能解决问题，ThinkPHP的URLMODE试了一遍也不行。我隐约记得以前写过一个ThinkPHP项目中遇到过同样的问题，但后来怎么解决的却始终想不起来。正当问题进入“白热化”阶段，我们准备写一个PublicAction来捕捉所有请求的时候，终于。。。</p>
<p>问题是，在Windows下面URL是不区分大小写的，但在Linux下面，大家应该都清楚吧，case sensitive！</p>
<p>好了，问题解决了。</p>
<p>明天下午继续去解决防火墙问题，不出差错，马上就可以上线咯！</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2011-10-23T22:57:50.000Z"><a href="/2011/10/stay-in-my-mind-2/">Oct 23 2011</a></time>
      
      
  
    <h1 class="title"><a href="/2011/10/stay-in-my-mind-2/">驻足在马路边的秋殇（二）</a></h1>
  

    </header>
    <div class="entry">
      
        <p><img src="/images/2011/10/a8206193_s-300x199.jpg" alt=""></p>
<hr>
<p>09年10月末，秋殇（一）发表在我的QQ空间里。后来我把它导入了这个博客（地址：<a href="http://www.hackecho.com/" target="_blank">《驻足在马路边的秋殇》</a>），留存纪念。如今，两年过去了，我已很少再动文字。偶尔会去红袖一把，期望能添些墨香，或者仅仅是不想失去这种感觉。如今的时间不多，或者，心累了。</p>
<p>秋，到了。</p>
<p>少年不识愁滋味，爱上层楼，爱上层楼，为赋新词强说愁。而今识尽愁滋味，欲说还休，欲说还休，却道天凉好个秋。</p>
<p>不及幼安忧国忧民，却也能体会此情此景。秋殇总能让人若有所感，泛起一些思绪，安静下来，仔细地体会。</p>
<hr>
<p><strong>遗忘</strong></p>
<p>一位以前很要好的哥们儿昨天打电话给我，寒暄过后，竟然问我：“你知道我是谁吧？”我说废话，你的声音变成灰也认识。朋友笑到：“好多人跟我聊半天了才问我你是谁，竟然不记得我了！这才几年啊，真是的！”</p>
<p>是啊，这是第三年，可又能怪谁呢。QQ的好友列表里有这样三个分组，分别是小学、初中、高中同学，后来小学组的人只剩下了4个人，初中组的也在不断减少，高中组的还好，但陌生的名字却越来越多。后来进行好友整理，索性将三个组合为了一个组，叫做以前的朋友。删除了一些“陌生人”，看起来整洁多了。再后来，使用好友管理的“单向好友”功能，竟然发现有四十多个单向好友，意思就是有四十个人，他们的好友列表里有我，而我却没有他们。</p>
<p>遗忘总在不经意间。</p>
<p>什么是落寞，就是你隐身了两年，然后当你鼓起勇气上线时，却不会再有人联系你。有人说“总有一群朋友如死人一般躺在你的好友列表里，偶尔诈诈尸，时不时还会改改他们的墓志铭。”这说的就是你我吧。</p>
<p>还有朋友责怪我，你回来一趟也不告诉我们一声，一起出来吃个饭，又不是不认识。我说一定会的，如果有时间的话。</p>
<p>我想和那些我失去的、淡忘的朋友说声对不起。</p>
<hr>
<p><strong>回忆</strong></p>
<p>秋不是回忆的最好季节，因为每个季节都是回忆。</p>
<p>小时候听着迈克尔杰克逊长大，后来MJ突然离世，那个时代也随之结束。我不属于那个时代，却着实让我感受到了时间的推进。为了忘却的纪念，很长一段时间再也没有听过MJ的歌。直到突然有一天，耳边想起了那熟悉的《dangerous》，我凝固了。音乐就像时光机器，能够记录一个时代的情感。伴随着音乐，我体会到了过去的感觉。对，是感觉，完全没有场景的浮现，没有一丝相似的岁岁年年，只有那熟悉而又陌生的感觉。</p>
<p>去不到的地方，叫远方。</p>
<p>回不到的过去，叫记忆。</p>
<hr>
<p><strong>殇</strong></p>
<p>幸福花开在彼岸，我在此岸遥遥观望，当忧伤化为灰烬，我就会到达那幸福的起点。</p>
<p>国庆去泰山，我特意在一年前来时一个相同的地方，用相同的姿势拍了张照片。回来后我把它们合在一张照片中，朋友们都评价变了好多。</p>
<p>是啊，变了好多，我自己都感受到了。</p>
<p>问谷雨，是不是一个人不敢看镜子里的自己，就代表这个人对自己没有自信呢？镜子里的我让我不敢相信，这个形容枯槁的人是我吗？</p>
<p>问李岩，是不是现在的我与大一时的我相比，没有当时积极活跃了呢？“嗯，是的，你低调了。”</p>
<p>问自己，相由心生，外在是由内在构建的，你低沉了？</p>
<p>又想起了多年前的“重生法则”，要不要再一次凤凰涅槃。</p>
<hr>
<p>这个秋天，有人热情饱满收获果实，可是有的人却说不够；有人感叹着在梦中徜徉心海，有人却因为这个季节而频繁失眠；有人说秋高气爽适合登高，有人却觉得很累……</p>
<p>“而今识尽愁滋味，欲说还休，欲说还休，却道天凉好个秋。”</p>
<p>是啊，天凉好个秋！</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





<nav id="pagination">
  
    <a href="/page/2/" class="alignleft prev">Prev</a>
  
  
    <a href="/page/4/" class="alignright next">Next</a>
  
  <div class="clearfix"></div>
</nav></div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:hackecho.com">
  </form>
</div>

  

  
<div class="widget tag">
  <h3 class="title">Recent Posts</h3>
  <ul class="entry">
    
      <li>
        <a href="/2014/04/hadoop-cluster-setup-instruction-with-fedora-20/">Hadoop Cluster Setup Instruction with Fedora 20</a>
      </li>
    
      <li>
        <a href="/2013/10/real-time-emotion-analysis-on-twitter/">Real-time Emotion Analysis On Twitter</a>
      </li>
    
      <li>
        <a href="/2013/04/cuda-parallel-reduction/">CUDA中并行规约（Parallel Reduction）的优化</a>
      </li>
    
      <li>
        <a href="/2013/04/basics-of-mpi/">MPI 并行程序设计基础</a>
      </li>
    
      <li>
        <a href="/2013/03/a-letter-to-myself/">写给四年前刚开始编程的自己</a>
      </li>
    
  </ul>
</div>


  <div class="widget tag">
<h3 class="title">Links</h3>
<ul class="entry">
	<li><a href="http://vicdory.com/ data-no-instant" target="_blank" title="Kailun Shi">Kailun Shi</a></li>
	<li><a href="http://guo-min-zhi.github.io/ data-no-instant" target="_blank" title="远方">远方</a></li>
	<li><a href="http://mingplusplus.com/blog/ data-no-instant" target="_blank" title="Ming++">Ming++</a></li>
	<li><a href="http://ruiwu.me/ data-no-instant" target="_blank" title="RuiWu">RuiWu</a></li>
</ul>
</div>

  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/Android/">Android</a><small>1</small></li>
  
    <li><a href="/tags/Android,AsyncTask/">Android,AsyncTask</a><small>1</small></li>
  
    <li><a href="/tags/Android,SharedPreferences/">Android,SharedPreferences</a><small>1</small></li>
  
    <li><a href="/tags/BidData/">BidData</a><small>1</small></li>
  
    <li><a href="/tags/Decorator,Python/">Decorator,Python</a><small>1</small></li>
  
    <li><a href="/tags/GBK,Mac,UTF8/">GBK,Mac,UTF8</a><small>1</small></li>
  
    <li><a href="/tags/Git/">Git</a><small>1</small></li>
  
    <li><a href="/tags/Google+/">Google+</a><small>1</small></li>
  
    <li><a href="/tags/Hadoop/">Hadoop</a><small>1</small></li>
  
    <li><a href="/tags/JSON,XML,PHP/">JSON,XML,PHP</a><small>1</small></li>
  
    <li><a href="/tags/Life/">Life</a><small>1</small></li>
  
    <li><a href="/tags/Linux,HFS/">Linux,HFS</a><small>1</small></li>
  
    <li><a href="/tags/MPI/">MPI</a><small>1</small></li>
  
    <li><a href="/tags/MVC, PHP/">MVC, PHP</a><small>1</small></li>
  
    <li><a href="/tags/PHP,Socket/">PHP,Socket</a><small>1</small></li>
  
    <li><a href="/tags/Python/">Python</a><small>1</small></li>
  
    <li><a href="/tags/ThinkPHP/">ThinkPHP</a><small>1</small></li>
  
    <li><a href="/tags/WebSocket,HTML5/">WebSocket,HTML5</a><small>1</small></li>
  
    <li><a href="/tags/Wordpress/">Wordpress</a><small>2</small></li>
  
    <li><a href="/tags/boost,thread/">boost,thread</a><small>1</small></li>
  
    <li><a href="/tags/cuda,parallel,reduction/">cuda,parallel,reduction</a><small>1</small></li>
  
    <li><a href="/tags/fly-of-promgrammer/">fly-of-promgrammer</a><small>1</small></li>
  
    <li><a href="/tags/gcc/">gcc</a><small>1</small></li>
  
    <li><a href="/tags/ipc,semaphores/">ipc,semaphores</a><small>1</small></li>
  
    <li><a href="/tags/life/">life</a><small>1</small></li>
  
    <li><a href="/tags/makefile/">makefile</a><small>1</small></li>
  
    <li><a href="/tags/movie/">movie</a><small>1</small></li>
  
    <li><a href="/tags/open source/">open source</a><small>1</small></li>
  
    <li><a href="/tags/pthread/">pthread</a><small>1</small></li>
  
    <li><a href="/tags/web/">web</a><small>1</small></li>
  
    <li><a href="/tags/websocket/">websocket</a><small>1</small></li>
  
    <li><a href="/tags/极客/">极客</a><small>1</small></li>
  
    <li><a href="/tags/程序员/">程序员</a><small>2</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2014 Zhaoyu Li
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<script type="text/javascript">
var disqus_shortname = 'zlmoment';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


<!-- InstantClick makes following links in your website instant. http://instantclick.io -->
<script src="/js/instantclick.min.js" data-no-instant></script>
<script data-no-instant>InstantClick.init();</script>
</body>
</html>