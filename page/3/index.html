<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Page 3 | Hackecho</title>
  <meta name="author" content="Zhaoyu Li">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Hackecho"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Hackecho" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-37227120-1', 'hackecho.com');
      ga('send', 'pageview');

    </script>

  <!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Hackecho</a></h1>
  <h2><a href="/">Blog by Zhaoyu Li</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/" data-no-instant>Home</a></li>
    
      <li><a href="/archives" data-no-instant>Archives</a></li>
    
      <li><a href="/about" data-no-instant>About</a></li>
    
      <li><a href="https://github.com/zlmoment/Leetcode-Solutions" data-no-instant>LeetCode</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-05-03T15:28:03.000Z"><a href="/2012/05/seven-habits-of-hight-effective-people/">May 3 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/05/seven-habits-of-hight-effective-people/">高效人士的七种习惯（中英对照）</a></h1>
  

    </header>
    <div class="entry">
      
        <p><strong>摘要：</strong></p>
<p>Habit 1: Be Proactive 凡事积极主动</p>
<p>Habit 2: Begin with the End in Mind 先定目标而后有行动</p>
<p>Habit 3: Put First Things First 重要的事要先做</p>
<p>Habit 4: Think Win-Win 为了大家都赢</p>
<p>Habit 5: Seek First to Understand, Then to Be Understood 先理解别人，再让别人理解自己</p>
<p>Habit 6: Synergize 协同合作</p>
<p>Habit 7: Sharpen the Saw 磨亮锯子（意指不断自我提高）</p>
<p><strong>全文：</strong></p>
<p>高效人士的七种习惯</p>
<p>斯蒂芬·科卫教授（Prof. Stephen Covey）</p>
<p>Our character is a composite of our habits. Changing habits is hard, but can be done by tremendous commitment. A (good) habit can be defined as the intersection of knowledge, skill and desire. Change is a cycle of being and seeing (visualization).</p>
<p>Our objective is to move progressively on a maturity continuum from dependence to independence to interdependence. Although independence is the current paradigm of our society, we can accomplish much more by cooperation and specialization. However, we must achieve independence before we can choose interdependence.</p>
<p>我们的性格是我们的习惯的集合物。改变习惯是困难的，但只要下定特大的决心，习惯是可以改变的。一种（良好）习惯可以被定义为知识、技能和愿望的交汇点。改变即是存在和视觉的循环。</p>
<p>我们的目标是，从依赖到独立、再到互相依赖，在成熟连续流中循序渐进。虽然独立是当前我们的社会模式，但是我们通过合作和专业化却可以取得更多的成绩。尽管如此，在能够选择相互依赖之前，我们必须取得独立。</p>
<h3 id="Habit_1:_Be_Proactive_凡事积极主动">Habit 1: Be Proactive 凡事积极主动</h3>
<p>The first and most basic habit of a highly effective person in any environment is the habit of proactivity. Being proactive means that as human beings, we are responsible for our own lives. Our behavior is a function of our decisions, not our conditions. We can subordinate feelings to values. We have the initiative and the responsibility to make things happen.</p>
<p>Look at the word responsibility-response-ability-the ability to choose your responses. Highly proactive people recognize that responsibility. They do not blame circumstances, conditions, or conditioning for their behavior. Their behavior is a product of their own conscious choice, based on values, rather than a product of their conditions, based on feeling. The opposite of proactive is reactive. The spirit of reactive people is the transfer of responsibility. Their language absolves them of responsibility.</p>
<p>Proactive people focus their time and energy on their Circle of Influence (things they can control) in lieu of reacting to or worrying about conditions over which they have little or no control (Circle of Concern). In so doing,proactive people use positive energy to influence conditions and increase their Circle of Influence.</p>
<p>在任何环境中做事效率很高的人都具有的首要以及基本的习惯是积极主动的习惯。积极主动的含义是，我们作为人类，应该对我们自己的生命负责。我们的行为不是环境而是我们做出的决定的结果。我们可以使感觉服从价值。我们有创造的主动性和责任性。</p>
<p>看看responsibility（责任）这个词，它由response（反应）和ability（能力）两个词组成，意思是选择做出反应的能力。非常积极主动的人认识到这种责任。他们不抱怨环境、条件或者环境对他们的驯化作用。他们的行为是他们自己基于价值而有意做出选择的一种产物，而不是基于感情的、他们的条件的产物。积极主动的反义词是消极被动。消极被动者的精神是逃避责任，他们的言辞为自己开脱责任。</p>
<p>积极主动的人将自己的时间和精力集中在自己的“势力范围”（自己可以控制的事物）之内，而不是对自己几乎不能或完全不能控制的条件（“关注范围”）做出被动的反应或担心。</p>
<h3 id="Habit_2:_Begin_with_the_End_in_Mind_先定目标而后有行动">Habit 2: Begin with the End in Mind 先定目标而后有行动</h3>
<p>To begin with the end in mind means to begin each day with a clear understanding of your desired direction and destination. By keeping that end in mind you can make certain that whatever you do on any particular day does not violate the criteria you have defined as supremely important, and that each day of your life contributes in a meaningful way to the vision you have of your life as a whole.</p>
<p>Begin with the end in mind is based on the principle that all things are created twice. There’s a mental or first creation and a physical or second creation. The second, or physical creation, follows from the first, just as a building follows from a blueprint. In our personal lives, if we do not develop our own self-awareness and become responsible for first creations, we empower other people and circumstances to shape our lives by default.</p>
<p>Leadership is the first creation. Management is the second creation. Management is a bottom line focus: How can I best accomplish certain things? Leadership deals with the top line: What are the things I want to accomplish? In the words of both Peter Drucker and Warren Bennis, “Management is doing things right; leadership is doing the right things.” Management is efficiency in climbing the ladder of success; leadership determines whether the ladder is leaning against the right wall.</p>
<p>先有目标而后有行动，意思是每一天开始时，你都清楚地了解自己想要实现的方向或目标。当你心怀目标，你才能做到每一个具体的日子所做的任何事情都不违反你已经确定的极其重要的标准，你生活中的每一天都在以一种积极的方式有助于达到你整个人生的愿景。</p>
<p>“先有目标而后有行动”是建立在这样一种原理基础上的，即所有事情都经历两次创造。第一种是精神创造，第二种是物质创造。第二种或物质创造产生于第一种创造，正如先有蓝图再盖房子一样。在我们的个人生活中，如果我们不开发自我意识，不对第一种创造负责，我们就会让别人和环境错误地改变我们的人生。</p>
<p>领导是第一种创造，管理是第二种创造。管理关注基层工作：我怎样能够完成某些事情？领导处理高层事务：那些事情是我想要完成的？用德鲁克和本尼斯两人的话，就是：”管理是把事情做得正确，领导是做正确的事情。”管理是在成功阶梯上攀登的效率，领导是确定是否把梯子放到了正确的墙上。</p>
<h3 id="Habit_3:_Put_First_Things_First_重要的事要先做">Habit 3: Put First Things First 重要的事要先做</h3>
<p>What are first things? First things are those things that you, personally, find most worth doing. They move you in the right direction and help you achieve the purpose expressed in your mission statement.</p>
<p>Put First Things First involves organizing and managing time and events according to the personal priorities established in Habit 2 (Begin with the End in Mind). Habit 2 is the first or mental creation. Habit 3, then, is the second, or physical creation. It’s the day-in, day-out, moment by moment doing it.</p>
<p>哪些事是重要的事情？重要的事情就是那些你自己发现最值得做的事情。它们使你沿着正确的方向前进，帮助你达到你在个人使命里陈述的目标。</p>
<p>“重要的事要先做”牵涉到根据习惯二（“先有目标而后有行动”）里所建立的个人优先事项对时间、事件进行组织和管理。习惯二是第一种或精神创造，而习惯三是第二种或物质创造。它是日进日出、每时每刻地做事。</p>
<h3 id="Habit_4:_Think_Win-Win_为了大家都赢">Habit 4: Think Win-Win 为了大家都赢</h3>
<p>In relationships and businesses, effectiveness is largely achieved through the cooperative efforts of two or more people. Marriages and other partnerships are interdependent realities, and yet people often approach these relationships with an<br>independent mentality, which is like trying to play golf with a tennis racket-the tool isn’t suited to the sport.</p>
<p>Most of us learn to base our self-worth on comparisons and competition. We think about succeeding in terms of someone else failing. That is, if I win, you lose. Or if you win, I lose. There is only so much pie and if you get a big piece there is less for me. People with this type of Scarcity Mentality find it difficult to share recognition and power, and to be happy for the successes of others, especially those closest to them.</p>
<p>Win-Win, on the other hand, is based on the paradigm that there is plenty for everybody, that one person’s success is not achieved at the expense or exclusion of the success of others. Win-Win sees life as a cooperative, not a competitive arena. Win-Win is a frame of mind and heart that constantly seeks mutual benefit in all human interactions. Win-Win means that agreements or solutions are mutually beneficial and satisfying.</p>
<p>在社会关系和商务活动中，效率大体上都要经过两个或两个以上的人的合作努力才能取得。婚姻和其他伙伴关系是互相依赖的现实，然而人们却经常以一种独立的心态处理这些关系，如同用网球拍去打高尔夫球——使用了不适合这种体育运动的工具。</p>
<p>我们中的多数人学会了将自我价值建立在比较和竞争之上。我们想着在别人摔倒时进行超越。这就是说，如果我赢，就是你输。或者，如果你赢，就是我输。馅饼就这么大，如果你得到一大块，我得到的就要少。怀有这种”稀缺心态”的人很难与人分享赞誉与权力，很难为别人特别是天天跟自己在一起的人获得成功而感到高兴。</p>
<p>在另一方面，“双赢”或“大家都赢”是建立在每个人都有许多机会这个思想方式上的，即一个人并不是以牺牲别人利益或排除别人成功而取得成功。“大家都赢”把人生看作是合作而不是竞争的舞台。“大家都赢”是在所有人类共处中不断需求相互利益的一种心灵结构。“大家都赢”意味着各种约定和方案对于大家都是有益处而且是使大家都满意的。</p>
<h3 id="Habit_5:_Seek_First_to_Understand,_Then_to_Be_Understood_先理解别人，再让别人理解自己">Habit 5: Seek First to Understand, Then to Be Understood 先理解别人，再让别人理解自己</h3>
<p>Communication is the most important skill in life. We spend most of our waking hours communicating. But consider this: You’ve spent years learning how to read and write. Years learning how to speak. But what about listening? What training or education have you had that enables you to listen so that you really, deeply understand another human being from that individuals’ own frame of reference?</p>
<p>Seeking first to understand, or diagnosing before you prescribe, is a correct principle manifest in many areas of life. A wise doctor will diagnose before writing a prescription. A good engineer will understand the forces, the stresses at work, before designing the bridge. An effective salesperson first seeks to understand the needs of the customer before offering a product. Similarly, an effective communicator will first seek to understand another’s views before seeking to be understood.</p>
<p>Until people feel properly diagnosed they will not be open to prescriptions. We typically seek first to be understood. Most people do not listen with the intent to understand; they listen with the intent to reply. They’re either speaking or preparing to speak. They’re filtering everything through their own paradigms,reading their autobiography into other people’s lives.</p>
<p>沟通是人生最为重要的技能，我们将醒着的大部分时间用来沟通。但是，你要考虑这个问题：你花了许多年时间读书、认字、说话，但是学习聆听了吗？你所接受过的教育或培训，有没有课程使你能够通过聆听从而站在另一个人的角度去真正深刻地理解他？</p>
<p>寻求先理解别人，或者是先诊断再开方，是人生许多领域正确的原则妙方。明智的大夫在开方之前先诊断。出色的工程师在设计桥梁之前先要理解力学和运营应力。有效率的销售员在推荐一种产品之前首先要寻求理解客户的需要。同样，有效率的沟通者在寻求别人理解自己之前，先要寻求理解别人的观点。人们只有在感到得到了恰当的诊断之后才会愿意接受处方。</p>
<p>我们通常是首先要别人理解自己。大多数人不是怀着理解别人的意图去聆听，他们聆听的意图是要别人做出回答。他们要么是说话，要么是准备说话。他们用自己的模式过滤一切，以自己的经历来理解别人的生活。</p>
<h3 id="Habit_6:_Synergize_协同合作">Habit 6: Synergize 协同合作</h3>
<p>Synergy is everywhere in nature. The intermingled roots of two plants growing closely together improve the quality of the soil. Two pieces of wood bonded together hold much more than the total of the weight held by each separately. The whole is<br>greater than the sum of its parts. One plus one equals three or more.</p>
<p>The principle of synergy also holds true in social interactions. Two people, creatively cooperating, will be able to produce far better results than either one could alone. Synergy lets us discover jointly things that we are much less likely todiscover by ourselves. It occurs when minds stimulate each other and ideas call forth ideas. I say something that stimulates your mind; you respond with an idea that stimulates mine. I share that new idea with you, and the process repeats itself andeven builds.</p>
<p>Synergy works. It is the crowning achievement of all the previous habits. It is effectiveness in an interdependent reality-it is teamwork, team building, the development of unity and creativity with other human beings.</p>
<p>Valuing the differences is the essence of synergy-the mental, the emotional, the physiological differences between people. And the key to valuing those differences is to realize that all people see the world, not as it is, but as they are. When we value differences and bring different perspectives together in the spirit of mutual respect, people then feel free to seek the best possible alternative, often the Third Alternative, one that is substantially better than either of the original proposals. Finding a third alternative is not compromise, but represents a Win-win solution for both parties.</p>
<p>协同是自然界的普遍现象。依偎在一起生长的两种植物的根交织在一起，能够改良土壤的质量。两根木棍绑在一起所承受的分量要比单独一根所承受的分量大得多。整体大于部件之和。一加一等于三甚至更多。</p>
<p>协同原理在社会互动中也是真理。进行创造性合作的两个人所创造的成果，比两人中任何一个人单独去做要多得多。协同让我们共同发现我们个人所较少发现的东西。当主意相互碰撞、想法相互启发，协同效应就发生了。我说的事情激发你的想法，你回应的主意又对我有所启发。我与你分享一个新的主意，而这个过程不断重复，甚至有所建树。</p>
<p>协同合作是有效的，它是在前面所有习惯基础上取得的成绩。它是存在于一种相互依赖的现实之中的效率——是团队工作，是团队建设，是与别人团结创造的发展。</p>
<p>重视差异——人们在智力、情感、心理上的差异——是协同合作的精髓。重视差异的关键是，承认人们不是以客观存在而是以自己的认识去看待世界。当我们重视分歧，根据相互尊重的精神把不同的观点带到一起，那么大家就能够自由地寻求可能的最佳方案，通常是“第三种方案”。这种方案事实上要比原有的任何一种提议都要好。找到一个第三种方案并不是妥协，而它是代表了能使双方皆赢的答案。</p>
<h3 id="Habit_7:_Sharpen_the_Saw_磨亮锯子">Habit 7: Sharpen the Saw 磨亮锯子</h3>
<p>Habit 7 is the habit that makes all the others possible. Sharpen the Saw means preserving and enhancing the greatest asset you have-you. It means having a balanced, systematic program for self-renewal in the four areas of our lives: physical, mental, emotional-social, and spiritual. Without this discipline, the body becomes weak, the mind mechanical, the emotions raw, the spirit insensitive, and the person selfish.</p>
<p>This is the single most powerful investment we can ever make in life-investment in ourselves, in the only instrument we have with which to deal with life and to contribute. Yet when people get busy producing, or sawing, they seldom take time to Sharpen the Saw because maintenance seldom pays dramatic, immediate dividends.</p>
<p>This daily Private Victory is the key to the development of the Seven Habits, and it’s completely within our control. Renewal is the principle and the process that empowers us to move on an upward spiral of growth and change, of continuous improvement.</p>
<p>习惯七是使所有其它习惯变得可能的习惯。“磨亮锯子”意思是保存并增强你所拥有的最大资产——你。这个意思就是，在人生的四个领域——身体、智力、情感或社会、精神——制定一个平衡的、系统的自我提高计划。没有这么一条，身体将会变得虚弱，心灵将会变得死板，情感将会变得呆滞，精神将会变得迟钝，人将会变得自私。</p>
<p>这是我们在生活中最能够进行的单一最有效果的投资——对我们自己、对我们所拥有的唯一工具进行投资。有了它，我们便可应对生活、做出贡献。</p>
<p>这种每天都能有的“个人胜利”是开发七种习惯的关键，而且它是完全能够被我们自己所控制的。自我提高是这样一种法则和过程，它使我们能够象螺旋那样向上成长和变化，经历持续不断的改善。</p>
<p><em>来源：网络</em></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-04-30T00:03:08.000Z"><a href="/2012/04/new-hybi-10-protocol-of-websocket/">Apr 29 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/04/new-hybi-10-protocol-of-websocket/">WebSocket新版Hybi-10协议介绍</a></h1>
  

    </header>
    <div class="entry">
      
        <p>不知道问什么，网上的几乎所有关于WebSocket的讲解都是旧版协议，开源的PHP-WebSocket也早不更新了。一开始还以为是服务器程序的原因，后来发现是协议变更了。而且好不容易将握手协议更换为新版后，发现传送的数据都是乱码（见<a href="http://weibo.com/1784705505/ygyi4A0Pj" target="_blank" rel="external">这里</a>），原来数据报文的格式也进行了非常大的变更！</p>
<p>之前我们曾介绍过基于WebSocket协议的服务器实现，但那篇文章中提到的WebSocket协议标准还是草案7.5、7.6的标准，如今只有Safari支持此版本的协议，Chrome和Firefox最新版都已升级至Hybi-10（<a href="http://tools.ietf.org/html/draft-ietf-hybi-thewebsocketprotocol-10" target="_blank" rel="external">协议地址</a>）。因此，我们再来介绍一下WebSocket新版协议Hybi-10。这次协议变更非常大，主要集中在握手协议和数据传输的格式上。下面我们来详细介绍一下。</p>
<h3 id="握手协议">握手协议</h3>
<p>我们先来看一下大致的区别：</p>
<ol>
<li>最老的websocket草案标准中是没有安全key，草案7.5、7.6中有两个安全key，而现在的草案10中只有一个安全key，即将7.5、7.6中http头中的”Sec-WebSocket-Key1”与”Sec-WebSocket-Key2”合并为了一个”Sec-WebSocket-Key”</li>
</ol>
<ol>
<li>把http头中Upgrade的值由”WebSocket”修改为了”websocket”；http头中的”-Origin”修改为了”Sec-WebSocket-Origin”;</li>
</ol>
<ol>
<li>增加了http头”Sec-WebSocket-Accept”，用来返回原来草案7.5、7.6服务器返回给客户端的握手验证，原来是以内容的形式返回，现在是放到了http头中；另外服务器返回客户端的验证方式也有变化。</li>
</ol>
<p>服务器生成验证的方式变化较大，我们来做一介绍。</p>
<p>旧版：</p>
<pre><code>GET / HTTP/<span class="number">1.1</span>
<span class="label">Upgrade:</span> WebSocket
<span class="label">Connection:</span> Upgrade
<span class="label">Host:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">1337</span>
<span class="label">Origin:</span> http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8000</span>
<span class="label">Cookie:</span> sessionid=xxxx<span class="comment">; calView=day; dayCurrentDate=1314288000000</span>
<span class="keyword">Sec</span>-WebSocket-Key1: cV`p1* <span class="number">42</span><span class="preprocessor">#7  ^9}_ 647  08{</span>
<span class="keyword">Sec</span>-WebSocket-Key2: O8 <span class="number">415</span> <span class="number">8</span>x37R A8   <span class="number">4</span>
<span class="comment">;"######</span>
</code></pre><p>旧版生成Token的方法如下：</p>
<p>取出Sec-WebSocket-Key1中的所有数字字符形成一个数值，这里是1427964708，然后除以Key1中的空格数目，得到一个数值，保留该数值整数位，得到数值N1；对Sec-WebSocket-Key2采取同样的算法，得到第二个整数N2；把N1和N2按照Big-Endian字符序列连接起来，然后再与另外一个Key3连接，得到一个原始序列ser_key。Key3是指在握手请求最后，有一个8字节的奇怪的字符串“;”######”，这个就是Key3。然后对ser_key进行一次md5运算得出一个16字节长的digest，这就是老版本协议需要的token，然后将这个token附在握手消息的最后发送回Client，即可完成握手。</p>
<p>新版：</p>
<pre><code><span class="request">GET <span class="string">/</span> HTTP/1.1</span>
<span class="attribute">Upgrade</span>: <span class="string">websocket</span>
<span class="attribute">Connection</span>: <span class="string">Upgrade</span>
<span class="attribute">Host</span>: <span class="string">127.0.0.1:1337</span>
<span class="attribute">Sec-WebSocket-Origin</span>: <span class="string">http://127.0.0.1:8000</span>
<span class="attribute">Sec-WebSocket-Key</span>: <span class="string">erWJbDVAlYnHvHNulgrW8Q==</span>
<span class="attribute">Sec-WebSocket-Version</span>: <span class="string">8</span>
<span class="attribute">Cookie</span>: <span class="string">csrftoken=xxxxxx; sessionid=xxxxx</span>
</code></pre><p>新版生成Token的方法如下：</p>
<p>首先服务器将key（长度24）截取出来，如4tAjitqO9So2Wu8lkrsq3w==，用它和自定义的一个字符串（长度36）258EAFA5-E914-47DA-95CA-C5AB0DC85B11连接起来，然后把这一字符串进行SHA-1算法加密，得到长度为20字节的二进制数据，再将这些数据经过Base64编码，最终得到服务端的密钥，也就是ser_key。服务器将ser_key附在返回值Sec-WebSocket-Accept后，至此握手成功。</p>
<h3 id="数据报文格式">数据报文格式</h3>
<p>旧版协议比较简单，仅仅是在原始数据前加了个’\x00′，在最后面加了个’\xFF’，即假如Client发送一个字符串’test’，实际上WebSocket Server收到的数据是：’x00test\xFF’，所以只需要剥离掉首尾那两个字符就可以了。</p>
<p>新版的协议对这部分规定比较复杂，以下是其格式标准：（下图在Firefox可能会出现错乱，请换用Chrome）</p>
<pre><code>      <span class="number">0</span>                   <span class="number">1</span>                   <span class="number">2</span>                   <span class="number">3</span>
      <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> <span class="number">0</span> <span class="number">1</span>
     +-+-+-+-+-------+-+-------------+-------------------------------+
     |<span class="literal">F</span>|R|R|R| opcode|M| Payload len |    Extended payload length    |
     |I|S|S|S|  (<span class="number">4</span>)  |A|     (<span class="number">7</span>)     |             (<span class="number">16</span>/<span class="number">63</span>)           |
     |N|V|V|V|       |S|             |   (<span class="keyword">if</span> payload len==<span class="number">126</span>/<span class="number">127</span>)   |
     | |<span class="number">1</span>|<span class="number">2</span>|<span class="number">3</span>|       |K|             |                               |
     +-+-+-+-+-------+-+-------------+ - - - - - - - - - - - - - - - +
     |     Extended payload length continued, <span class="keyword">if</span> payload len == <span class="number">127</span>  |
     + - - - - - - - - - - - - - - - +-------------------------------+
     |                               |Masking-key, <span class="keyword">if</span> MASK set to <span class="number">1</span>  |
     +-------------------------------+-------------------------------+
     | Masking-key (continued)       |          Payload Data         |
     +-------------------------------- - - - - - - - - - - - - - - - +
     :                     Payload Data continued <span class="keyword">...</span>                :
     + - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +
     |                     Payload Data continued <span class="keyword">...</span>                |
     +---------------------------------------------------------------+
</code></pre><p><strong>FIN：</strong>1位，用来表明这是一个消息的最后的消息片断，当然第一个消息片断也可能是最后的一个消息片断；</p>
<p><strong>RSV1, RSV2, RSV3:</strong> 分别都是1位，如果双方之间没有约定自定义协议，那么这几位的值都必须为0,否则必须断掉WebSocket连接；</p>
<p><strong>Opcode:</strong>4位操作码，定义有效负载数据，如果收到了一个未知的操作码，连接也必须断掉，以下是定义的操作码：</p>
<ul>
<li>%x0 表示连续消息片断</li>
</ul>
<ul>
<li>%x1 表示文本消息片断</li>
</ul>
<ul>
<li>%x2 表未二进制消息片断</li>
</ul>
<ul>
<li>%x3-7 为将来的非控制消息片断保留的操作码</li>
</ul>
<ul>
<li>%x8 表示连接关闭</li>
</ul>
<ul>
<li>%x9 表示心跳检查的ping</li>
</ul>
<ul>
<li>%xA 表示心跳检查的pong</li>
</ul>
<ul>
<li>%xB-F 为将来的控制消息片断的保留操作码</li>
</ul>
<p><strong>Mask:</strong>1位，定义传输的数据是否有加掩码,如果设置为1,掩码键必须放在masking-key区域，客户端发送给服务端的所有消息，此位的值都是1；</p>
<p><strong>Payload length: </strong>传输数据的长度，以字节的形式表示：7位、7+16位、或者7+64位。如果这个值以字节表示是0-125这个范围，那这个值就表示传输数据的长度；如果这个值是126，则随后的两个字节表示的是一个16进制无符号数，用来表示传输数据的长度；如果这个值是127,则随后的是8个字节表示的一个64位无符合数，这个数用来表示传输数据的长度。多字节长度的数量是以网络字节的顺序表示。负载数据的长度为扩展数据及应用数据之和，扩展数据的长度可能为0,因而此时负载数据的长度就为应用数据的长度。</p>
<p><strong>Masking-key:</strong>0或4个字节，客户端发送给服务端的数据，都是通过内嵌的一个32位值作为掩码的；掩码键只有在掩码位设置为1的时候存在。<br><strong>Payload data: </strong> (x+y)位，负载数据为扩展数据及应用数据长度之和。<br><strong>Extension data:</strong>x位，如果客户端与服务端之间没有特殊约定，那么扩展数据的长度始终为0，任何的扩展都必须指定扩展数据的长度，或者长度的计算方式，以及在握手时如何确定正确的握手方式。如果存在扩展数据，则扩展数据就会包括在负载数据的长度之内。<br><strong>Application data:</strong>y位，任意的应用数据，放在扩展数据之后，应用数据的长度=负载数据的长度-扩展数据的长度。</p>
<p>以下是Python实现的解码和编码，兼容新旧版协议，仅供参考：</p>
<pre><code>:::Python
<span class="function"><span class="keyword">def</span> <span class="title">send_data</span><span class="params">(self, raw_str)</span>:</span>
    <span class="keyword">if</span> self.sockets[self][<span class="string">'new_version'</span>]:
        back_str = []
        back_str.append(<span class="string">'\x81'</span>)
        data_length = len(raw_str)

        <span class="keyword">if</span> data_length &lt;= <span class="number">125</span>:
            back_str.append(chr(data_length))
        <span class="keyword">else</span>:
            back_str.append(chr(<span class="number">126</span>))
            back_str.append(chr(data_length &gt;&gt; <span class="number">8</span>))
            back_str.append(chr(data_length &amp; <span class="number">0xFF</span>))

        back_str = <span class="string">""</span>.join(back_str) + raw_str
        self.transport.write(back_str)
    <span class="keyword">else</span>:
        back_str = <span class="string">'\x00%s\xFF'</span> % (raw_str)
        self.transport.write(back_str)

<span class="function"><span class="keyword">def</span> <span class="title">parse_recv_data</span><span class="params">(self, msg)</span>:</span>
    raw_str = <span class="string">''</span>

    <span class="keyword">if</span> self.sockets[self][<span class="string">'new_version'</span>]:
        code_length = ord(msg[<span class="number">1</span>]) &amp; <span class="number">127</span>

        <span class="keyword">if</span> code_length == <span class="number">126</span>:
            masks = msg[<span class="number">4</span>:<span class="number">8</span>]
            data = msg[<span class="number">8</span>:]
        <span class="keyword">elif</span> code_length == <span class="number">127</span>:
            masks = msg[<span class="number">10</span>:<span class="number">14</span>]
            data = msg[<span class="number">14</span>:]
        <span class="keyword">else</span>:
            masks = msg[<span class="number">2</span>:<span class="number">6</span>]
            data = msg[<span class="number">6</span>:]

        i = <span class="number">0</span>
        <span class="keyword">for</span> d <span class="keyword">in</span> data:
            raw_str += chr(ord(d) ^ ord(masks[i%<span class="number">4</span>]))
            i += <span class="number">1</span>
    <span class="keyword">else</span>:
        raw_str = msg.split(<span class="string">"\xFF"</span>)[<span class="number">0</span>][<span class="number">1</span>:]

    <span class="keyword">return</span> raw_str
</code></pre>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-04-17T05:46:21.000Z"><a href="/2012/04/socket-programming-in-php/">Apr 17 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/04/socket-programming-in-php/">PHP中的Socket编程</a></h1>
  

    </header>
    <div class="entry">
      
        <p>关于PHP socket的资料网上着实不多，或者讲的都不是很全面。为了更好地用PHP来处理socket，天堂皓月博客特地来简单总结一下其用法，尽量会做到深入浅出：）</p>
<h3 id="文章结构：">文章结构：</h3>
<ul>
<li>Socket基础知识</li>
</ul>
<ul>
<li>编写服务器</li>
</ul>
<ul>
<li>编写客户端</li>
</ul>
<ul>
<li>总结</li>
</ul>
<p>通过这三部分你将会体验到Socket的魅力，并了解怎样去编写一个服务器，怎样通过Sockets连接到服务器，服务器怎样处理信息并将信息发送给相应的客户端。</p>
<p>不管你信不信，只要你用过PHP，就一定用过Sockets。HTTP服务器就是一个Socket服务器，浏览器就是客户端，也就是最简单的C/S模式。</p>
<h3 id="Socket基础知识">Socket基础知识</h3>
<p>我们可以把Socket当做是一种数据结构，客户端和服务器间通过这种数据结构来交换数据。服务器开始监听连接，当客户端想要连接服务器时，会通过服务器监听的端口开启一个会话，服务器收到客户端的请求后，建立连接完毕，然后继续监听下一次连接。</p>
<p>要产生一个Socket，你我们需要三个变量：一个协议（protocol）、一个socket类型（socket type）和一个公共协议类型（common protocol type）。下面将会详细介绍各个部分的具体内容。</p>
<p><strong>协议</strong></p>
<ul>
<li>AF_INET：这是大多数用来产生socket的协议，使用TCP或UDP来传输，用在IPv4的地址</li>
</ul>
<ul>
<li>AF_INET6：与上面类似，不过是来用在IPv6的地址</li>
</ul>
<ul>
<li>AF_UNIX：本地协议，使用在Unix和Linux系统上，它很少使用，一般都是当客户端和服务器在同一台及其上的时候使用</li>
</ul>
<p><strong>Socket类型</strong></p>
<ul>
<li>SOCK_STREAM：这个协议是按照顺序的、可靠的、数据完整的基于字节流的连接。这是一个使用最多的socket类型，这个socket是使用TCP来进行传输。</li>
</ul>
<ul>
<li>SOCK_DGRAM：这个协议是无连接的、固定长度的传输调用。该协议是不可靠的，使用UDP来进行它的连接。</li>
</ul>
<ul>
<li>SOCK_SEQPACKET：这个协议是双线路的、可靠的连接，发送固定长度的数据包进行传输。必须把这个包完整的接受才能进行读取。</li>
</ul>
<ul>
<li>SOCK_RAW：这个socket类型提供单一的网络访问，这个socket类型使用ICMP公共协议。（ping、traceroute使用该协议）</li>
</ul>
<ul>
<li>SOCK_RDM：这个类型是很少使用的，在大部分的操作系统上没有实现，它是提供给数据链路层使用，不保证数据包的顺序</li>
</ul>
<p><strong>公共协议</strong></p>
<ul>
<li>ICMP：互联网控制消息协议，主要使用在网关和主机上，用来检查网络状况和报告错误信息</li>
</ul>
<ul>
<li>UDP：用户数据报文协议，它是一个无连接，不可靠的传输协议</li>
</ul>
<ul>
<li>TCP：传输控制协议，这是一个使用最多的可靠的公共协议，它能保证数据包能够到达接受者那儿，如果在传输过程中发生错误，那么它将重新发送出错数据包。</li>
</ul>
<p>在PHP中我们使用socket_create()函数来产生一个Socket。socket_create()函数运行成功返回一个包含Socket的资源类型，如果没有成功则返回false。</p>
<p>1 resource socket_create(int protocol, int socketType, int commonProtocol);</p>
<p>PHP提供了很多操作Socket的函数。现在我们来看一个例子，了解PHP是如何产生、接受和监听一个socket。</p>
<pre><code><span class="attribute">:::PHP</span>
&lt;?php
$commonProtocol = getprotobyname(“tcp”);
$socket = socket<span class="emphasis">_create(AF_</span>INET, SOCK<span class="emphasis">_STREAM, $commonProtocol);
socket_</span>bind($socket, ‘localhost’, 1337);
socket<span class="emphasis">_listen($socket);
// More socket functionality to come
?&gt;</span>
</code></pre><p>我们来详细解释一下上面这个程序（基于行号）：</p>
<p>第二行：使用公共协议名字来获取一个协议类型。在这里使用的是TCP公共协议，如果你想使用UDP或者ICMP协议，就应该把getprotobyname()函数的参数改为“udp”或“icmp”。我们也可以不使用getprotobyname()函数而是直接指定SOL_TCP或SOL_UDP。</p>
<p>第三行：产生一个Socket并且返回一个Socket资源的实例。</p>
<p>第四行：有了一个Socket资源的实例以后，就必须把Socket绑定到一个IP地址和某一端口上。在这里绑定socket到本地计算机（127.0.0.1）的1337端口。</p>
<p>第五行：然后就需要监听所有进来的socket连接。</p>
<p>这时，我们就需要了解一下PHP中Socket函数的使用方法了。官方手册的介绍非常不错（<a href="http://www.php.net/manual/en/ref.sockets.php" target="_blank" rel="external">猛戳这个链接</a>），下面只是简单列举几个最常用的。</p>
<ul>
<li>socket_accept() 接受一个Socket连接</li>
</ul>
<ul>
<li>socket_bind() 把socket绑定在一个IP地址和端口上</li>
</ul>
<ul>
<li>socket_close() 关闭一个socket资源</li>
</ul>
<ul>
<li>socket_connect() 开始一个socket连接</li>
</ul>
<ul>
<li>socket_create_listen() 在指定端口打开一个socket监听</li>
</ul>
<ul>
<li>socket_create() 产生一个socket，相当于产生一个socket的数据结构</li>
</ul>
<ul>
<li>socket_get_option() 获取socket选项</li>
</ul>
<ul>
<li>socket_getpeername() 获取远程主机的ip地址</li>
</ul>
<ul>
<li>socket_getsockname() 获取本地socket的ip地址</li>
</ul>
<ul>
<li>socket_listen() 监听由指定socket的所有连接</li>
</ul>
<ul>
<li>socket_read() 读取指定长度的数据</li>
</ul>
<ul>
<li>socket_readv() 读取从分散/聚合数组过来的数据</li>
</ul>
<ul>
<li>socket_recv() 从socket里结束数据到缓存</li>
</ul>
<ul>
<li>socket_recvfrom() 接受数据从指定的socket，如果没有指定则默认当前socket</li>
</ul>
<ul>
<li>socket_recvmsg() 从iovec里接受消息</li>
</ul>
<ul>
<li>socket_select() 多路选择</li>
</ul>
<ul>
<li>socket_send() 这个函数发送数据到已连接的socket</li>
</ul>
<ul>
<li>socket_sendmsg() 发送消息到socket</li>
</ul>
<ul>
<li>socket_sendto() 发送消息到指定地址的socket</li>
</ul>
<ul>
<li>socket_set_block() 在socket里设置为块模式</li>
</ul>
<ul>
<li>socket_set_nonblock() socket里设置为非块模式</li>
</ul>
<ul>
<li>socket_set_option() 设置socket选项</li>
</ul>
<ul>
<li>socket_shutdown() 这个函数允许你关闭读、写、或者指定的socket</li>
</ul>
<ul>
<li>socket_write() 写数据到socket缓存</li>
</ul>
<p>关于PHP Socket的基础知识就介绍到这里，还有不明白的可查看官方手册。下面介绍编写一个Socket服务器。</p>
<h3 id="编写服务器">编写服务器</h3>
<p>现在我们把第一个例子完善，使其能够监听一个指定的Socket并处理用户的连接。</p>
<pre><code>:::PHP
<span class="php"><span class="preprocessor">&lt;?php</span>
<span class="variable">$commonProtocol</span> = getprotobyname(<span class="string">"tcp"</span>);
<span class="variable">$socket</span> = socket_create(AF_INET, SOCK_STREAM, <span class="variable">$commonProtocol</span>);
socket_bind(<span class="variable">$socket</span>, <span class="string">'localhost'</span>, <span class="number">1337</span>);
socket_listen(<span class="variable">$socket</span>);
<span class="comment">// Accept any incoming connections to the server</span>
<span class="variable">$connection</span> = socket_accept(<span class="variable">$socket</span>);
<span class="keyword">if</span>(<span class="variable">$connection</span>)
{
   socket_write(<span class="variable">$connection</span>, <span class="string">"You have connected to the socket...\n\r"</span>);
}
<span class="preprocessor">?&gt;</span></span>
</code></pre><p>注意这不是一个Web页面，如果你尝试使用Web浏览器来运行这个脚本，那么很有可能它会超过PHP运行30秒的限时。当然你可以使用下面的代码来设置一个无限的运行时间</p>
<blockquote>
<p>set_time_limit(0);</p>
</blockquote>
<p>但最好的办法还是直接使用命令提示符来运行：</p>
<blockquote>
<p>php server.php</p>
</blockquote>
<p>但截至目前，上面的服务器端有<strong>三个问题</strong>：</p>
<ol>
<li>它不能接受多个连接。</li>
</ol>
<ol>
<li>它只完成唯一的一个命令。</li>
</ol>
<ol>
<li>你不能通过Web浏览器连接这个服务器。</li>
</ol>
<p>在上一个代码的基础上再改进，使用下面的代码来做新服务器端：</p>
<pre><code>:::PHP
&lt;?php
// Set up our socket 
<span class="variable">$commonProtocol</span> = getprotobyname(<span class="string">"tcp"</span>);
<span class="variable">$socket</span> = socket_create(AF_INET, SOCK_STREAM, <span class="variable">$commonProtocol</span>);
socket_<span class="built_in">bind</span>(<span class="variable">$socket</span>, <span class="string">'localhost'</span>, <span class="number">1337</span>);
socket_listen(<span class="variable">$socket</span>);
// Initialize the buffer 
<span class="variable">$buffer</span> = <span class="string">"NO DATA"</span>;
<span class="keyword">while</span>(<span class="literal">true</span>)
{
    // Accept any connections coming <span class="keyword">in</span> on this socket
    <span class="variable">$connection</span> = socket_accept(<span class="variable">$socket</span>);
    <span class="built_in">printf</span>(<span class="string">"Socket connected\r\n"</span>);
    // Check to see <span class="keyword">if</span> there is anything <span class="keyword">in</span> the buffer
    <span class="keyword">if</span>(<span class="variable">$buffer</span> != <span class="string">""</span>)
    {
        <span class="built_in">printf</span>(<span class="string">"Something is in the buffer...sending data...\r\n"</span>);
        socket_write(<span class="variable">$connection</span>, <span class="variable">$buffer</span> . <span class="string">"\r\n"</span>);
        <span class="built_in">printf</span>(<span class="string">"Wrote to socket\r\n"</span>);
    }
    <span class="keyword">else</span>
    {
        <span class="built_in">printf</span>(<span class="string">"No Data in the buffer\r\n"</span>);
    }
    // Get the input
    <span class="keyword">while</span>(<span class="variable">$data</span> = socket_<span class="built_in">read</span>(<span class="variable">$connection</span>, <span class="number">1024</span>, PHP_NORMAL_READ))
    {
        <span class="variable">$buffer</span> = <span class="variable">$data</span>;
        socket_write(<span class="variable">$connection</span>, <span class="string">"Information Received\r\n"</span>);
        <span class="built_in">printf</span>(<span class="string">"Buffer: "</span> . <span class="variable">$buffer</span> . <span class="string">"\r\n"</span>);
    }
    socket_close(<span class="variable">$connection</span>);
    <span class="built_in">printf</span>(<span class="string">"Closed the socket\r\n\r\n"</span>);
}
?&gt;
</code></pre><p>这段程序初始化一个socket并且打开一个缓冲区收发数据。然后服务器开始等待连接，此时一旦产生一个连接，服务器将打印“Socket connected”。然后服务器检查缓冲区，如果缓冲区里有数据，服务器就把这些数据发送到连接的计算机客户端。然后服务器等待接收信息，并把接收到的信息保存，然后让连接的客户端知道信息接收成功后，服务器将关闭连接。连接关闭后，服务器将开始下一次处理连接的循环。</p>
<h3 id="编写客户端">编写客户端</h3>
<p>解决上面提到的第二个问题还是比较容易的。我们需要一个连接到服务器的页面来处理数据并发送到服务器。</p>
<p>我们来看下面的代码：</p>
<pre><code>:::PHP
<span class="php"><span class="preprocessor">&lt;?php</span>
<span class="comment">// Create the socket and connect </span>
<span class="variable">$socket</span> = socket_create(AF_INET, SOCK_STREAM, SOL_TCP);
<span class="variable">$connection</span> = socket_connect(<span class="variable">$socket</span>,’localhost’, <span class="number">1337</span>);
<span class="keyword">while</span>(<span class="variable">$buffer</span> = socket_read(<span class="variable">$socket</span>, <span class="number">1024</span>, PHP_NORMAL_READ))
{
    <span class="keyword">if</span>(<span class="variable">$buffer</span> == “NO DATA”)
    {
        <span class="keyword">echo</span>(“&lt;p&gt;NO DATA&lt;/p&gt;”);
        <span class="keyword">break</span>;
    }
    <span class="keyword">else</span>
    {
        <span class="comment">// Do something with the data in the buffer </span>
        <span class="keyword">echo</span>(“&lt;p&gt;Buffer Data: “ . <span class="variable">$buffer</span> . “&lt;/p&gt;”);
    }
}
<span class="keyword">echo</span>(“&lt;p&gt;Writing to Socket&lt;/p&gt;”);
<span class="comment">// Write some test data to our socket</span>
<span class="keyword">if</span>(!socket_write(<span class="variable">$socket</span>, “SOME DATA\r\n”))
{
    <span class="keyword">echo</span>(“&lt;p&gt;Write failed&lt;/p&gt;”);
}
<span class="comment">// Read any response from the socket</span>
<span class="keyword">while</span>(<span class="variable">$buffer</span> = socket_read(<span class="variable">$socket</span>, <span class="number">1024</span>, PHP_NORMAL_READ))
{
    <span class="keyword">echo</span>(“&lt;p&gt;Data sent was: SOME DATA&lt;br&gt; Response was:” . <span class="variable">$buffer</span> . “&lt;/p&gt;”);
}
<span class="keyword">echo</span>(“&lt;p&gt;Done Reading from Socket&lt;/p&gt;”);
<span class="preprocessor">?&gt;</span></span>
</code></pre><p>这个例子的客户端连接到服务器后，客户端读取数据。如果这是客户端第一次连接服务器，服务器将发送“NO DATA”给客户端。如果客户端收到“NO DATA”说明其连接成功，客户端发送它的数据到服务器并等待服务器响应。一旦客户端接收到服务器的响应，客户端将把响应内容输出到屏幕上。</p>
<h3 id="总结">总结</h3>
<p>如果还想深入了解PHP Socket，建议阅读更多的第三方资料或到PHP官方查询官方文档。今天就介绍到这里，如果有错误欢迎指正。</p>
<p>参考资料：《PHP Game Programming》</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-04-15T06:21:50.000Z"><a href="/2012/04/html5-websocket-communication-protocol/">Apr 15 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/04/html5-websocket-communication-protocol/">HTML5 之 WebSocket 通信协议介绍</a></h1>
  

    </header>
    <div class="entry">
      
        <p><strong>更新：Chrome和Firefox的WebSocket协议已更新到最新版，不再支持旧版协议。关于新版协议的介绍请看<a href="http://www.hackecho.com/" target="_blank" rel="external">《WebSocket新版Hybi-10协议介绍》</a>，本篇文章中的握手协议和数据报文已不再适用。</strong></p>
<p>最近参与一个有关HTML5的比赛，要用到WebSocket，经过一些实验后简单总结一下WebSocket的基础用法。</p>
<p>WebSocket是HTML5的一种新的协议，它是实现了浏览器与服务器的双向通讯。</p>
<p>在 WebSocket API 中，浏览器和服务器只需要要做一个握手的动作，然后，浏览器和服务器之间就形成了一条快速通道。两者之间就直接可以数据互相传送。（这两小段介绍摘自维基百科）</p>
<h3 id="WebSocket协议">WebSocket协议</h3>
<p>WebSocket的协议非常简单，这也是其最大的优点之一。</p>
<p>在客户端（如浏览器），可以利用JavaScript直接new WebSocket来实例化一个WebSocket对象，其参数格式为ws://yourdomain:port/path。WebSocket会根据这段字符串，发送Header到指定服务器端口，其数据格式大概如下：</p>
<pre><code><span class="request">GET <span class="string">/</span> HTTP/1.1</span>
<span class="attribute">Origin</span>: <span class="string">http://hackecho.com </span>
<span class="attribute">Cookie</span>: <span class="string">__utma=99as</span>
<span class="attribute">Connection</span>: <span class="string">Upgrade</span>
<span class="attribute">Host</span>: <span class="string">hackecho.com</span>
<span class="attribute">Sec-WebSocket-Key</span>: <span class="string">uRovscZjNol/umbTt5uKmw==</span>
<span class="attribute">Upgrade</span>: <span class="string">websocket Sec-WebSocket-Version: 13</span>
</code></pre><p>此时服务端应该返回的信息是：</p>
<pre><code><span class="status">HTTP/1.    WebSocket Protocol Handshake</span>
<span class="attribute">Date</span>: <span class="string">Fri,     Feb     17:38:    GMT</span>
<span class="attribute">Connection</span>: <span class="string">Upgrade</span>
<span class="attribute">Server</span>: <span class="string">HackEcho Server</span>
<span class="attribute">Upgrade</span>: <span class="string">WebSocket</span>
<span class="attribute">Access-Control-Allow-Origin</span>: <span class="string">http://hackecho.com </span>
<span class="attribute">Access-Control-Allow-Credentials</span>: <span class="string">true</span>
<span class="attribute">Sec-WebSocket-Accept</span>: <span class="string">rLHCkw/SKsO9GAH/ZSFhBATDKrU=</span>
<span class="attribute">Access-Control-Allow-Headers</span>: <span class="string">content-type</span>
</code></pre><p>一旦握手成功建立连接，数据便可以通过WebSocket在服务器和客户端之间进行传送了。</p>
<h3 id="WebSocket事件">WebSocket事件</h3>
<p><a href="/images/2012/04/events-500x250.jpg"><img src="/images/2012/04/events-500x250.jpg" alt=""></a></p>
<p>客户端在握手成功后，会触发WebSocket对象的onopen事件，告诉客户端连接已经成功建立了。</p>
<p>客户端的WebSocket对象一共绑定了四个事件：</p>
<p>1、onopen：连接建立时触发；</p>
<p>2、onmessage：收到服务端消息时触发；</p>
<p>3、onerror：连接出错时触发；</p>
<p>4、onclose：连接关闭时触发；</p>
<h3 id="客户端连接的建立">客户端连接的建立</h3>
<p>这里提供一个例子来更好地理解客户端是怎样建立WebSocket连接的。例子来自于文末参考资料的第一篇文章。</p>
<p>将下列代码保存为一个html文件，如websocket.html，在浏览器中打开。页面会自动向服务器（由<a href="http://www.websocket.org提供）连接，发送一个消息并将返回的结果显示出来，最后断开连接。" target="_blank" rel="external">http://www.websocket.org提供）连接，发送一个消息并将返回的结果显示出来，最后断开连接。</a></p>
<p>通过其中的JavaScript代码即可看出用JS在本地建立连接的所有过程，比较简单，不再赘述，请大家看代码。</p>
<p>（不知怎么回事，如果去掉行号的代码缩进会乱掉，所以只能带上行号… 网上有很多去行号方法，大家可以Google之。）</p>
<pre><code><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"utf-8"</span> /&gt;</span>
<span class="tag">&lt;<span class="title">title</span>&gt;</span>
    WebSocket Test
<span class="tag">&lt;/<span class="title">title</span>&gt;</span>
<span class="tag">&lt;<span class="title">script</span> <span class="attribute">language</span>=<span class="value">"javascript"</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="javascript">
    <span class="keyword">var</span> wsUri = <span class="string">"ws://echo.websocket.org/"</span>;
    <span class="keyword">var</span> output;
    <span class="function"><span class="keyword">function</span> <span class="title">init</span><span class="params">()</span> </span>{
        output = <span class="built_in">document</span>.getElementById(<span class="string">"output"</span>);
        testWebSocket();
    }
    <span class="function"><span class="keyword">function</span> <span class="title">testWebSocket</span><span class="params">()</span> </span>{
        websocket = <span class="keyword">new</span> WebSocket(wsUri);
        websocket.onopen = <span class="function"><span class="keyword">function</span><span class="params">(evt)</span> </span>{
            onOpen(evt)
        };
        websocket.onclose = <span class="function"><span class="keyword">function</span><span class="params">(evt)</span> </span>{
            onClose(evt)
        };
        websocket.onmessage = <span class="function"><span class="keyword">function</span><span class="params">(evt)</span> </span>{
            onMessage(evt)
        };
        websocket.onerror = <span class="function"><span class="keyword">function</span><span class="params">(evt)</span> </span>{
            onError(evt)
        };
    }
    <span class="function"><span class="keyword">function</span> <span class="title">onOpen</span><span class="params">(evt)</span> </span>{
        writeToScreen(<span class="string">"CONNECTED"</span>);
        doSend(<span class="string">"WebSocket rocks"</span>);
    }
    <span class="function"><span class="keyword">function</span> <span class="title">onClose</span><span class="params">(evt)</span> </span>{
        writeToScreen(<span class="string">"DISCONNECTED"</span>);
    }
    <span class="function"><span class="keyword">function</span> <span class="title">onMessage</span><span class="params">(evt)</span> </span>{
        writeToScreen(<span class="string">'&lt;span style="color: blue;"&gt;RESPONSE: '</span> + evt.data + <span class="string">'&lt;/span&gt;'</span>);
        websocket.close();
    }
    <span class="function"><span class="keyword">function</span> <span class="title">onError</span><span class="params">(evt)</span> </span>{
        writeToScreen(<span class="string">'&lt;span style="color: red;"&gt;ERROR:&lt;/span&gt; '</span> + evt.data);
    }
    <span class="function"><span class="keyword">function</span> <span class="title">doSend</span><span class="params">(message)</span> </span>{
        writeToScreen(<span class="string">"SENT: "</span> + message);
        websocket.send(message);
    }
    <span class="function"><span class="keyword">function</span> <span class="title">writeToScreen</span><span class="params">(message)</span> </span>{
        <span class="keyword">var</span> pre = <span class="built_in">document</span>.createElement(<span class="string">"p"</span>);
        pre.style.wordWrap = <span class="string">"break-word"</span>;
        pre.innerHTML = message;
        output.appendChild(pre);
    }
    <span class="built_in">window</span>.addEventListener(<span class="string">"load"</span>, init, <span class="literal">false</span>);
</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
<span class="tag">&lt;<span class="title">h2</span>&gt;</span>
    WebSocket Test
<span class="tag">&lt;/<span class="title">h2</span>&gt;</span>
<span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"output"</span>&gt;</span>
<span class="tag">&lt;/<span class="title">div</span>&gt;</span>

<span class="tag">&lt;/<span class="title">html</span>&gt;</span>
</code></pre><h3 id="服务器端的实现">服务器端的实现</h3>
<p>在将WebSocket应用到实际中时，我们往往需要自己的服务器来响应各种请求以实现更加丰富的功能。从前面的协议介绍部分来看，实现一个WebSocket服务器端并不难。但本着“不重复制造轮子”的原则，我们将基于开源的<a href="http://code.google.com/p/phpwebsocket/" target="_blank" rel="external">PHPWebSocket Project</a>来二次开发自己的服务器。PHPWebSocket Project中已实现握手协议部分，其它的功能将可以由我们自由添加。这里只讨论握手协议部分和一个简单的响应函数。</p>
<p>将下列代码保存为server.php文件：</p>
<pre><code><span class="php"><span class="preprocessor">&lt;?php</span>
error_reporting(E_ALL);
set_time_limit(<span class="number">0</span>);
ob_implicit_flush();

<span class="variable">$master</span>  = WebSocket(<span class="string">"localhost"</span>,<span class="number">12345</span>);
<span class="variable">$sockets</span> = <span class="keyword">array</span>(<span class="variable">$master</span>);
<span class="variable">$users</span>   = <span class="keyword">array</span>();
<span class="variable">$debug</span>   = <span class="keyword">false</span>;

<span class="keyword">while</span>(<span class="keyword">true</span>){
    <span class="variable">$changed</span> = <span class="variable">$sockets</span>;
    socket_select(<span class="variable">$changed</span>,<span class="variable">$write</span>=<span class="keyword">NULL</span>,<span class="variable">$except</span>=<span class="keyword">NULL</span>,<span class="keyword">NULL</span>);
    <span class="keyword">foreach</span>(<span class="variable">$changed</span> <span class="keyword">as</span> <span class="variable">$socket</span>){
        <span class="keyword">if</span>(<span class="variable">$socket</span>==<span class="variable">$master</span>){
            <span class="variable">$client</span>=socket_accept(<span class="variable">$master</span>);
            <span class="keyword">if</span>(<span class="variable">$client</span>&lt;<span class="number">0</span>){ console(<span class="string">"socket_accept() failed"</span>); <span class="keyword">continue</span>; }
            <span class="keyword">else</span>{ connect(<span class="variable">$client</span>); }
        }
        <span class="keyword">else</span>{
            <span class="variable">$bytes</span> = @socket_recv(<span class="variable">$socket</span>,<span class="variable">$buffer</span>,<span class="number">2048</span>,<span class="number">0</span>);
            <span class="keyword">if</span>(<span class="variable">$bytes</span>==<span class="number">0</span>){ disconnect(<span class="variable">$socket</span>); }
            <span class="keyword">else</span>{
                <span class="variable">$user</span> = getuserbysocket(<span class="variable">$socket</span>);
                <span class="keyword">if</span>(!<span class="variable">$user</span><span class="variable">-&gt;handshake</span>){ dohandshake(<span class="variable">$user</span>,<span class="variable">$buffer</span>); }
                <span class="keyword">else</span>{ process(<span class="variable">$user</span>,<span class="variable">$buffer</span>); }
            }
        }
    }
}

<span class="comment">//---------------------------------------------------------------</span>
<span class="function"><span class="keyword">function</span> <span class="title">process</span><span class="params">(<span class="variable">$user</span>,<span class="variable">$msg</span>)</span></span>{
    <span class="variable">$action</span> = unwrap(<span class="variable">$msg</span>);
    say(<span class="string">"&lt; "</span>.<span class="variable">$action</span>);
    send(<span class="variable">$user</span><span class="variable">-&gt;socket</span>,<span class="string">"lzy "</span>.<span class="variable">$action</span>);
}

<span class="function"><span class="keyword">function</span> <span class="title">send</span><span class="params">(<span class="variable">$client</span>,<span class="variable">$msg</span>)</span></span>{
    say(<span class="string">"&gt; "</span>.<span class="variable">$msg</span>);
    <span class="variable">$msg</span> = wrap(<span class="variable">$msg</span>);
    socket_write(<span class="variable">$client</span>,<span class="variable">$msg</span>,strlen(<span class="variable">$msg</span>));
}

<span class="function"><span class="keyword">function</span> <span class="title">WebSocket</span><span class="params">(<span class="variable">$address</span>,<span class="variable">$port</span>)</span></span>{
    <span class="variable">$master</span>=socket_create(AF_INET, SOCK_STREAM, SOL_TCP)     <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">"socket_create() failed"</span>);
    socket_set_option(<span class="variable">$master</span>, SOL_SOCKET, SO_REUSEADDR, <span class="number">1</span>)  <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">"socket_option() failed"</span>);
    socket_bind(<span class="variable">$master</span>, <span class="variable">$address</span>, <span class="variable">$port</span>)                    <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">"socket_bind() failed"</span>);
    socket_listen(<span class="variable">$master</span>,<span class="number">20</span>)                                <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">"socket_listen() failed"</span>);
    <span class="keyword">echo</span> <span class="string">"Server Started : "</span>.date(<span class="string">'Y-m-d H:i:s'</span>).<span class="string">"\n"</span>;
    <span class="keyword">echo</span> <span class="string">"Master socket  : "</span>.<span class="variable">$master</span>.<span class="string">"\n"</span>;
    <span class="keyword">echo</span> <span class="string">"Listening on   : "</span>.<span class="variable">$address</span>.<span class="string">" port "</span>.<span class="variable">$port</span>.<span class="string">"\n\n"</span>;
    <span class="keyword">return</span> <span class="variable">$master</span>;
}

<span class="function"><span class="keyword">function</span> <span class="title">connect</span><span class="params">(<span class="variable">$socket</span>)</span></span>{
    <span class="keyword">global</span> <span class="variable">$sockets</span>,<span class="variable">$users</span>;
    <span class="variable">$user</span> = <span class="keyword">new</span> User();
    <span class="variable">$user</span><span class="variable">-&gt;id</span> = uniqid();
    <span class="variable">$user</span><span class="variable">-&gt;socket</span> = <span class="variable">$socket</span>;
    array_push(<span class="variable">$users</span>,<span class="variable">$user</span>);
    array_push(<span class="variable">$sockets</span>,<span class="variable">$socket</span>);
    console(<span class="variable">$socket</span>.<span class="string">" CONNECTED!"</span>);
}

<span class="function"><span class="keyword">function</span> <span class="title">disconnect</span><span class="params">(<span class="variable">$socket</span>)</span></span>{
    <span class="keyword">global</span> <span class="variable">$sockets</span>,<span class="variable">$users</span>;
    <span class="variable">$found</span>=<span class="keyword">null</span>;
    <span class="variable">$n</span>=count(<span class="variable">$users</span>);
    <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="variable">$n</span>;<span class="variable">$i</span>++){
        <span class="keyword">if</span>(<span class="variable">$users</span>[<span class="variable">$i</span>]<span class="variable">-&gt;socket</span>==<span class="variable">$socket</span>){ <span class="variable">$found</span>=<span class="variable">$i</span>; <span class="keyword">break</span>; }
    }
    <span class="keyword">if</span>(!is_null(<span class="variable">$found</span>)){ array_splice(<span class="variable">$users</span>,<span class="variable">$found</span>,<span class="number">1</span>); }
    <span class="variable">$index</span> = array_search(<span class="variable">$socket</span>,<span class="variable">$sockets</span>);
    socket_close(<span class="variable">$socket</span>);
    console(<span class="variable">$socket</span>.<span class="string">" DISCONNECTED!"</span>);
    <span class="keyword">if</span>(<span class="variable">$index</span>&gt;=<span class="number">0</span>){ array_splice(<span class="variable">$sockets</span>,<span class="variable">$index</span>,<span class="number">1</span>); }
}

<span class="function"><span class="keyword">function</span> <span class="title">dohandshake</span><span class="params">(<span class="variable">$user</span>,<span class="variable">$buffer</span>)</span></span>{
    console(<span class="string">"\nRequesting handshake..."</span>);
    console(<span class="variable">$buffer</span>);
    <span class="keyword">list</span>(<span class="variable">$resource</span>,<span class="variable">$host</span>,<span class="variable">$origin</span>,<span class="variable">$strkey1</span>,<span class="variable">$strkey2</span>,<span class="variable">$data</span>) = getheaders(<span class="variable">$buffer</span>);
    console(<span class="string">"Handshaking..."</span>);

    <span class="variable">$pattern</span> = <span class="string">'/[^\d]*/'</span>;
    <span class="variable">$replacement</span> = <span class="string">''</span>;
    <span class="variable">$numkey</span>= preg_replace(<span class="variable">$pattern</span>, <span class="variable">$replacement</span>, <span class="variable">$strkey1</span>);
    <span class="variable">$numkey</span>= preg_replace(<span class="variable">$pattern</span>, <span class="variable">$replacement</span>, <span class="variable">$strkey2</span>);

    <span class="variable">$pattern</span> = <span class="string">'/[^ ]*/'</span>;
    <span class="variable">$replacement</span> = <span class="string">''</span>;
    <span class="variable">$spaces</span>= strlen(preg_replace(<span class="variable">$pattern</span>, <span class="variable">$replacement</span>, <span class="variable">$strkey1</span>));
    <span class="variable">$spaces</span>= strlen(preg_replace(<span class="variable">$pattern</span>, <span class="variable">$replacement</span>, <span class="variable">$strkey2</span>));

    <span class="keyword">if</span> (<span class="variable">$spaces</span>== || <span class="variable">$spaces</span>== || <span class="variable">$numkey</span>% <span class="variable">$spaces</span>!= || <span class="variable">$numkey</span>% <span class="variable">$spaces</span>!= <span class="number">0</span>) {
        socket_close(<span class="variable">$user</span><span class="variable">-&gt;socket</span>);
        console(<span class="string">'failed'</span>);
        <span class="keyword">return</span> <span class="keyword">false</span>;
    }

    <span class="variable">$ctx</span> = hash_init(<span class="string">'md5'</span>);
    hash_update(<span class="variable">$ctx</span>, pack(<span class="string">"N"</span>, <span class="variable">$numkey1</span>/<span class="variable">$spaces1</span>));
    hash_update(<span class="variable">$ctx</span>, pack(<span class="string">"N"</span>, <span class="variable">$numkey2</span>/<span class="variable">$spaces2</span>));
    hash_update(<span class="variable">$ctx</span>, <span class="variable">$data</span>);
    <span class="variable">$hash_data</span> = hash_final(<span class="variable">$ctx</span>,<span class="keyword">true</span>);

    <span class="variable">$upgrade</span>  = <span class="string">"HTTP/1.WebSocket Protocol Handshake\r\n"</span> .
    <span class="string">"Upgrade: WebSocket\r\n"</span> .
    <span class="string">"Connection: Upgrade\r\n"</span> .
    <span class="string">"Sec-WebSocket-Origin: "</span> . <span class="variable">$origin</span> . <span class="string">"\r\n"</span> .
    <span class="string">"Sec-WebSocket-Location: ws://"</span> . <span class="variable">$host</span> . <span class="variable">$resource</span> . <span class="string">"\r\n"</span> .
    <span class="string">"\r\n"</span> .
    <span class="variable">$hash_data</span>;

    socket_write(<span class="variable">$user</span><span class="variable">-&gt;socket</span>,<span class="variable">$upgrade</span>.chr(<span class="number">0</span>),strlen(<span class="variable">$upgrade</span>.chr(<span class="number">0</span>)));
    <span class="variable">$user</span><span class="variable">-&gt;handshake</span>=<span class="keyword">true</span>;
    console(<span class="variable">$upgrade</span>);
    console(<span class="string">"Done handshaking..."</span>);
    <span class="keyword">return</span> <span class="keyword">true</span>;
}

<span class="function"><span class="keyword">function</span> <span class="title">getheaders</span><span class="params">(<span class="variable">$req</span>)</span></span>{
    <span class="variable">$r</span>=<span class="variable">$h</span>=<span class="variable">$o</span>=<span class="keyword">null</span>;
    <span class="keyword">if</span>(preg_match(<span class="string">"/GET (.*) HTTP/"</span>   ,<span class="variable">$req</span>,<span class="variable">$match</span>)){ <span class="variable">$r</span>=<span class="variable">$match</span>[<span class="number">1</span>]; }
    <span class="keyword">if</span>(preg_match(<span class="string">"/Host: (.*)\r\n/"</span>  ,<span class="variable">$req</span>,<span class="variable">$match</span>)){ <span class="variable">$h</span>=<span class="variable">$match</span>[<span class="number">1</span>]; }
    <span class="keyword">if</span>(preg_match(<span class="string">"/Origin: (.*)\r\n/"</span>,<span class="variable">$req</span>,<span class="variable">$match</span>)){ <span class="variable">$o</span>=<span class="variable">$match</span>[<span class="number">1</span>]; }
    <span class="keyword">if</span>(preg_match(<span class="string">"/Sec-WebSocket-Key2: (.*)\r\n/"</span>,<span class="variable">$req</span>,<span class="variable">$match</span>)){ <span class="variable">$key2</span>=<span class="variable">$match</span>[<span class="number">1</span>]; }
    <span class="keyword">if</span>(preg_match(<span class="string">"/Sec-WebSocket-Key1: (.*)\r\n/"</span>,<span class="variable">$req</span>,<span class="variable">$match</span>)){ <span class="variable">$key1</span>=<span class="variable">$match</span>[<span class="number">1</span>]; }
    <span class="keyword">if</span>(preg_match(<span class="string">"/\r\n(.*?)\$/"</span>,<span class="variable">$req</span>,<span class="variable">$match</span>)){ <span class="variable">$data</span>=<span class="variable">$match</span>[<span class="number">1</span>]; }
    <span class="keyword">return</span> <span class="keyword">array</span>(<span class="variable">$r</span>,<span class="variable">$h</span>,<span class="variable">$o</span>,<span class="variable">$key1</span>,<span class="variable">$key2</span>,<span class="variable">$data</span>);
}

<span class="function"><span class="keyword">function</span> <span class="title">getuserbysocket</span><span class="params">(<span class="variable">$socket</span>)</span></span>{
    <span class="keyword">global</span> <span class="variable">$users</span>;
    <span class="variable">$found</span>=<span class="keyword">null</span>;
    <span class="keyword">foreach</span>(<span class="variable">$users</span> <span class="keyword">as</span> <span class="variable">$user</span>){
        <span class="keyword">if</span>(<span class="variable">$user</span><span class="variable">-&gt;socket</span>==<span class="variable">$socket</span>){ <span class="variable">$found</span>=<span class="variable">$user</span>; <span class="keyword">break</span>; }
    }
    <span class="keyword">return</span> <span class="variable">$found</span>;
}

<span class="function"><span class="keyword">function</span>     <span class="title">say</span><span class="params">(<span class="variable">$msg</span>=<span class="string">""</span>)</span></span>{ <span class="keyword">echo</span> <span class="variable">$msg</span>.<span class="string">"\n"</span>; }
<span class="function"><span class="keyword">function</span>    <span class="title">wrap</span><span class="params">(<span class="variable">$msg</span>=<span class="string">""</span>)</span></span>{ <span class="keyword">return</span> chr(<span class="number">0</span>).<span class="variable">$msg</span>.chr(<span class="number">255</span>); }
<span class="function"><span class="keyword">function</span>  <span class="title">unwrap</span><span class="params">(<span class="variable">$msg</span>=<span class="string">""</span>)</span></span>{ <span class="keyword">return</span> substr(<span class="variable">$msg</span>,<span class="number">1</span>,strlen(<span class="variable">$msg</span>)-<span class="number">2</span>); }
<span class="function"><span class="keyword">function</span> <span class="title">console</span><span class="params">(<span class="variable">$msg</span>=<span class="string">""</span>)</span></span>{ <span class="keyword">global</span> <span class="variable">$debug</span>; <span class="keyword">if</span>(<span class="variable">$debug</span>){ <span class="keyword">echo</span> <span class="variable">$msg</span>.<span class="string">"\n"</span>; } }

<span class="class"><span class="keyword">class</span> <span class="title">User</span></span>{
    <span class="keyword">var</span> <span class="variable">$id</span>;
    <span class="keyword">var</span> <span class="variable">$socket</span>;
    <span class="keyword">var</span> <span class="variable">$handshake</span>;
}

<span class="preprocessor">?&gt;</span></span>
</code></pre><p>运行php server.php命令启动服务器，这时服务器启动。</p>
<p>然后我们将下列代码保存为client.html文件：</p>
<pre><code><span class="tag">&lt;<span class="title">html</span>&gt;</span>
<span class="tag">&lt;<span class="title">head</span>&gt;</span>
<span class="tag">&lt;<span class="title">title</span>&gt;</span>WebSocket<span class="tag">&lt;/<span class="title">title</span>&gt;</span>

<span class="tag">&lt;<span class="title">style</span>&gt;</span><span class="css">
<span class="tag">html</span>,<span class="tag">body</span><span class="rules">{<span class="rule"><span class="attribute">font</span>:<span class="value">normal <span class="number">0.9em</span> arial,helvetica</span></span>;<span class="rule">}</span></span>
<span class="id">#log</span> <span class="rules">{<span class="rule"><span class="attribute">width</span>:<span class="value"><span class="number">440px</span></span></span>; <span class="rule"><span class="attribute">height</span>:<span class="value"><span class="number">200px</span></span></span>; <span class="rule"><span class="attribute">border</span>:<span class="value"><span class="number">1px</span> solid <span class="hexcolor">#7F9DB9</span></span></span>; <span class="rule"><span class="attribute">overflow</span>:<span class="value">auto</span></span>;<span class="rule">}</span></span>
<span class="id">#msg</span> <span class="rules">{<span class="rule"><span class="attribute">width</span>:<span class="value"><span class="number">330px</span></span></span>;<span class="rule">}</span></span>
</span><span class="tag">&lt;/<span class="title">style</span>&gt;</span>

<span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript">
<span class="keyword">var</span> socket;

<span class="function"><span class="keyword">function</span> <span class="title">init</span><span class="params">()</span></span>{
    <span class="keyword">var</span> host = <span class="string">"ws://localhost:12345/websocket/server.php"</span>;
    <span class="keyword">try</span>{
        socket = <span class="keyword">new</span> WebSocket(host);
        log(<span class="string">'WebSocket - status '</span>+socket.readyState);
        socket.onopen    = <span class="function"><span class="keyword">function</span><span class="params">(msg)</span></span>{ log(<span class="string">"Welcome - status "</span>+<span class="keyword">this</span>.readyState); };
        socket.onmessage = <span class="function"><span class="keyword">function</span><span class="params">(msg)</span></span>{ log(<span class="string">"Received: "</span>+msg.data); };
        socket.onclose   = <span class="function"><span class="keyword">function</span><span class="params">(msg)</span></span>{ log(<span class="string">"Disconnected - status "</span>+<span class="keyword">this</span>.readyState); };
    }
    <span class="keyword">catch</span>(ex){ log(ex); }
    $(<span class="string">"msg"</span>).focus();
}

<span class="function"><span class="keyword">function</span> <span class="title">send</span><span class="params">()</span></span>{
    <span class="keyword">var</span> txt,msg;
    txt = $(<span class="string">"msg"</span>);
    msg = txt.value;
    <span class="keyword">if</span>(!msg){ alert(<span class="string">"Message can not be empty"</span>); <span class="keyword">return</span>; }
    txt.value=<span class="string">""</span>;
    txt.focus();
    <span class="keyword">try</span>{ socket.send(msg); log(<span class="string">'Sent: '</span>+msg); } <span class="keyword">catch</span>(ex){ log(ex); }
}
<span class="function"><span class="keyword">function</span> <span class="title">quit</span><span class="params">()</span></span>{
    log(<span class="string">"Goodbye!"</span>);
    socket.close();
    socket=<span class="literal">null</span>;
}

<span class="comment">// Utilities</span>
<span class="function"><span class="keyword">function</span> <span class="title">$</span><span class="params">(id)</span></span>{ <span class="keyword">return</span> <span class="built_in">document</span>.getElementById(id); }
<span class="function"><span class="keyword">function</span> <span class="title">log</span><span class="params">(msg)</span></span>{ $(<span class="string">"log"</span>).innerHTML+=<span class="string">"&lt;br&gt;"</span>+msg; }
<span class="function"><span class="keyword">function</span> <span class="title">onkey</span><span class="params">(event)</span></span>{ <span class="keyword">if</span>(event.keyCode==<span class="number">13</span>){ send(); } }
</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>

<span class="tag">&lt;/<span class="title">head</span>&gt;</span>
<span class="tag">&lt;<span class="title">body</span> <span class="attribute">onload</span>=<span class="value">"init()"</span>&gt;</span>
<span class="tag">&lt;<span class="title">h3</span>&gt;</span>WebSocket v2.00<span class="tag">&lt;/<span class="title">h3</span>&gt;</span>
<span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"log"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;<span class="title">input</span> <span class="attribute">id</span>=<span class="value">"msg"</span> <span class="attribute">type</span>=<span class="value">"textbox"</span> <span class="attribute">onkeypress</span>=<span class="value">"onkey(event)"</span>/&gt;</span>
<span class="tag">&lt;<span class="title">button</span> <span class="attribute">onclick</span>=<span class="value">"send()"</span>&gt;</span>Send<span class="tag">&lt;/<span class="title">button</span>&gt;</span>
<span class="tag">&lt;<span class="title">button</span> <span class="attribute">onclick</span>=<span class="value">"quit()"</span>&gt;</span>Quit<span class="tag">&lt;/<span class="title">button</span>&gt;</span>
<span class="tag">&lt;<span class="title">div</span>&gt;</span>Commands: hello, hi, name, age, date, time, thanks, bye<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;/<span class="title">body</span>&gt;</span>
<span class="tag">&lt;/<span class="title">html</span>&gt;</span>
</code></pre><p>这时在浏览器中打开client.html，即可实现一个简单的通过WebSocket连接到本地服务器然后发送消息、响应消息的应用。</p>
<p>有兴趣的读者可以继续阅读以下参考资料：</p>
<h3 id="参考资料：">参考资料：</h3>
<p><a href="http://www.websocket.org/echo.html" target="_blank" rel="external">《WebSocket Echo Test》</a></p>
<p><a href="http://www.zendstudio.net/archives/websocket-protocol/" target="_blank" rel="external">《websocket 通信协议》</a></p>
<p><a href="http://blog.bingo929.com/html5-websockets.html" target="_blank" rel="external">《HTML5 WebSockets 基础使用教程》</a></p>
<p><a href="http://zh.wikipedia.org/zh-cn/WebSocket" target="_blank" rel="external">《WikiPedia WebSocket》</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-03-22T20:09:09.000Z"><a href="/2012/03/how-to-create-a-personal-blog/">Mar 22 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/03/how-to-create-a-personal-blog/">如何搭建个人独立博客</a></h1>
  

    </header>
    <div class="entry">
      
        <p>最近一些朋友问起怎样搭建独立博客，想到以前自己折腾时的迷茫和走过的一些弯路，觉得有必要稍微总结一下。这里简单描述一下整体上的步骤吧。</p>
<p><strong>严正声明：</strong>由于文章的特殊性，其中难免会涉及到一些域名商、主机商等，绝不存在任何广告嫌疑或其它意图，特此声明。</p>
<p>文章结构：</p>
<ul>
<li>独立博客与BSP的区别</li>
</ul>
<ul>
<li>申请域名</li>
</ul>
<ul>
<li>服务器主机</li>
</ul>
<ul>
<li>域名绑定</li>
</ul>
<ul>
<li>安装程序</li>
</ul>
<ul>
<li>开始使用</li>
</ul>
<h3 id="独立博客与BSP的区别">独立博客与BSP的区别</h3>
<p>BSP是指Blog Service Provider，意指第三方博客服务提供商，如新浪博客、搜狐博客等。BSP提供给你的是一个写博客的平台，对于整站程序或模板都无法实现自定义，而且域名只能是二级域名或三级域名（如xxx.blog.sina.com.cn）。而独立博客之所以“独立”，是因为其高度的自定义。比如域名是顶级的，还可以自选，博客程序自己可以选择，还可以定制，模板的话也可以自由定制。只要你能想到的，都可以做到。</p>
<p>但独立博客也有其缺点，如域名和主机要自己买，数据备份要自己做（弄不好会全站丢失数据），人气需要自己建立等等。不过这些对于我们来讲都是可以学习的，而且这些知识对于我们软件学院学生来讲迟早都要接触到，为何不早点利用呢。</p>
<p>写独立博客还有很多很多好处，写得时间久了自然能体会到。具体可以参看这篇文章<a href="http://www.hackecho.com/archives/38.html" target="_blank" rel="external">《为什么你应该从现在开始就写博客》</a>，这里呢只说一点我的小感受，就是每天晚上的时候自己都会想，今天要写什么博客呢，然后就会在脑海中把整整一天都干了些什么、学了些什么回想一遍。但大多情况都发现自己一天其实没学到什么…然后就会BS自己一下，不断告诉自己，每天都要创造价值！</p>
<h3 id="申请域名">申请域名</h3>
<p>既然是独立博客，当然要有一个独立域名，所以申请域名是第一步。个人不是很建议在国内注册域名，原因大家心里都明白哈。</p>
<p>首先是域名的选取问题。.com是比较合适的，当然也有人倡导个人博客用.me域名更酷。仁者见仁，智者见智，除了.org/.gov/.edu等专有域名外，其它都是可以的。.cn由于国家的最新政策，个人已经不允许申请了，那个cn域名白菜价的时代已经过去了：）至于域名名称，全凭个人爱好了，以前我的是uutroy.com，后来换成了现在Hackecho.com，原域名做了一个永久301重定向，依旧能用。域名最好一次选好，不要频繁更换，否则影响很大…</p>
<p>对于域名注册商，Godaddy.com和name.com口碑不错，Godaddy支持支付宝，网上还有很多优惠码，推荐使用。</p>
<h3 id="服务器主机">服务器主机</h3>
<p>这是最头疼的一个问题。以前瞎折腾的时候，主机这儿吃过不少亏，总的来说，建议大家买香港或美国的主机，如果想尽情折腾可以考虑使用VPS。很重要的一点：大多数博客程序（如Wordpress）都是PHP系统，所以一定要买PHP的主机，当然如果是其它语言的系统，就买相应的主机即可。</p>
<p>香港的主机我在衡天小张那里买过几款，使用情况还不错，ping值也不是很高，推荐一下。另外Wopus的主机也可以（新软攀峰官网的主机使用的是Wopus的VPS合租，可以<a href="http://bjtuxrpf.com" target="_blank" rel="external">点击这里</a>测试）。</p>
<p>美国主机商很多很多，我们可以选择的也很多。这里简单列举几家，因为没有全部试用过，所以不做具体评论。</p>
<ul>
<li>Bluehost</li>
</ul>
<ul>
<li>Hawkhost</li>
</ul>
<ul>
<li>HostGator</li>
</ul>
<ul>
<li>HostMonster</li>
</ul>
<ul>
<li>DreamHost</li>
</ul>
<ul>
<li>等等等等</li>
</ul>
<p>VPS的话推荐Linode VPS，现在我用的就是Linode Fremont机房的512配置。</p>
<p>关于各种主机之间的差别，比如是否独立IP，DA或CPanel面板的区别，子目录绑定啥的，现在还不比完全弄明白，慢慢地也就知道了：）</p>
<p>IDC市场水太深，涉足需谨慎。</p>
<h3 id="域名绑定">域名绑定</h3>
<p>有了域名，有了主机，接下来就是把域名绑定到主机上，就可以通过域名访问主机了。下面以Godaddy为例：</p>
<p>由于Godaddy自己提供的DNS服务器在中国几乎全线被封，所以一般第一步我们要更换DNS解析服务器。我用的是国内的DNSPOD，还不错。具体怎样更改，完全又可以写篇博客了，而且网上现有的教程很多，本着高重用性的原则，这里不再赘述，请自行Google之。</p>
<p>更改DNS服务器一般几十分钟或1-2个小时生效，然后就可以在DNSPOD里管理自己的域名解析了。</p>
<p>最基本的是要添加两条A记录解析到主机IP，一条www的，一条@的，分别对应www.example.com和example.com。更多的请参考DNSPOD的帮助文档，非常详细。</p>
<p>DNSPOD的解析生效速度简直就是神速，我这里一般情况下几十秒生效。当然也有几个小时生效的可能性发生，那就只能等了。</p>
<h3 id="安装程序">安装程序</h3>
<p>解析生效后，就可以安装博客程序了。可以选择Wordpress，或者国人开发的Typecho或Emlog等等。我使用的是Wordpress，推荐一下，相信你也会喜欢上它的。</p>
<p>将Wordpress的文件上传到服务器站点目录，建立好数据库，然后访问你的域名，一路“下一步”就OK了。</p>
<h3 id="开始使用">开始使用</h3>
<p>OK，Enjoy it！</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-02-17T06:34:02.000Z"><a href="/2012/02/convertion-of-gbk-and-utf8-on-mac/">Feb 17 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/02/convertion-of-gbk-and-utf8-on-mac/">Mac下GBK与UTF8编码文件的批量转换</a></h1>
  

    </header>
    <div class="entry">
      
        <p>下载了一个Python改写的C语言100例，结果原作者使用的编码都是GBK，而我现在使用的Sublime Text 2和Textmate等都不支持GBK编码，导致打开全是乱码。网上也没有找到相应的转换工具，只好另辟蹊径。</p>
<p>关键时刻还是 Terminal 给力，介绍一条shell命令：iconv</p>
<p>就不细细介绍了，看下面的例子，就都懂了：</p>
<pre><code>iconv --list <span class="comment"># 显示可识别的编码名称</span>
iconv --list &gt;./infomation.log <span class="comment"># 显示可识别的编码名称，将信息存入infomation.log文件中</span>
<span class="input"><span class="prompt">iconv -f GB2312 -t UTF-8 a.html &gt;</span> b.html <span class="comment"># 转换GB2312编码的文件a.html为UTF-8编码，存入b.html</span></span>
<span class="input"><span class="prompt">iconv -f GB2312 -t BIG5 a.html &gt;</span> b.html <span class="comment"># 转换GB2312编码的文件a.html为BIG5编码，存入b.html</span></span>
</code></pre><p>进入正题，我们先cd进入保存所有文件的文件夹，然后执行下列命令：</p>
<pre><code><span class="keyword">find</span> *.<span class="keyword">py</span> -exec <span class="keyword">sh</span> -<span class="keyword">c</span> <span class="string">"iconv -f GB18030 -t UTF8 {} &gt; {}.py"</span> \;  
</code></pre>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2012/02/convertion-of-gbk-and-utf8-on-mac/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-01-30T05:35:33.000Z"><a href="/2012/01/git-notes/">Jan 29 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/01/git-notes/">Git 学习笔记</a></h1>
  

    </header>
    <div class="entry">
      
        <p>学习Git的笔记，会不定期更新。</p>
<p>我的Github地址：<a href="https://github.com/zlmoment" target="_blank" rel="external">https://github.com/uutroy</a></p>
<p>首先推荐两篇非常好的入门：</p>
<ul>
<li><a href="http://gitimmersion.com/" target="_blank" rel="external">Git Immersion</a></li>
</ul>
<ul>
<li><a href="http://www.ralfebert.de/tutorials/git/#commit_a" target="_blank" rel="external">Git Tutorial</a></li>
</ul>
<p>一般流程：取代码 → 更新到最新版本 → 修改代码 → 提交</p>
<h2 id="Creating_a_new_repository">Creating a new repository</h2>
<blockquote>
<p>$ git init</p>
</blockquote>
<h2 id="取代码及修改全局设置">取代码及修改全局设置</h2>
<p>git在创建提交的时候会记录你的名字和email地址，所以你应该告诉git这些内容。可以使用’git config’命令来设置，如果传递参数’-global’ ，它会将这些值记录在~/.gitconfig文件里，作为这些配置的默认值。</p>
<p>设置用户名与邮箱</p>
<blockquote>
<p>git config –global user.name “name”</p>
</blockquote>
<p>git config –global user.email “username@email.com”</p>
<p>查看设置值</p>
<blockquote>
<p>git config user.name</p>
</blockquote>
<p>从已有的git库中提取代码</p>
<blockquote>
<p>git clone git@github.com:appname.git myrepo</p>
</blockquote>
<h2 id="每次更改代码的操作">每次更改代码的操作</h2>
<p>更新本地代码到最新版本（需要merge才能合到本地代码中）</p>
<blockquote>
<p>git fetch</p>
</blockquote>
<p>合并更新后的代码到本地</p>
<blockquote>
<p>git merge</p>
</blockquote>
<p>更新代码方式的另一种方法(git pull是git fetch和git merge命令的一个组合)</p>
<blockquote>
<p>git pull</p>
</blockquote>
<p>修改代码后，查看已修改的内容</p>
<blockquote>
<p>git diff –cached</p>
</blockquote>
<p>将新增加文件加入到git中</p>
<blockquote>
<p>git add file1 file2 file3</p>
</blockquote>
<p>从git中删除文件</p>
<blockquote>
<p>git rm file1</p>
</blockquote>
<p>git rm -r dir1</p>
<p>提交修改</p>
<blockquote>
<p>git commit -m ‘this is memo’</p>
</blockquote>
<p>如果想省掉提交之前的 git add 命令，可以直接用</p>
<blockquote>
<p>git commit -a -m ‘this is memo’</p>
</blockquote>
<p>commit和commit -a的区别,：</p>
<p>commit -a相当于：</p>
<p>第一步：自动地add所有改动的代码，使得所有的开发代码都列于index file中</p>
<p>第二步：自动地删除那些在index file中但不在工作树中的文件</p>
<p>第三步：执行commit命令来提交</p>
<p>提交所有修改到远程服务器：</p>
<blockquote>
<p>git push</p>
</blockquote>
<h2 id="其它常用命令">其它常用命令</h2>
<p>显示commit日志</p>
<blockquote>
<p>git log</p>
</blockquote>
<p>不仅显示commit日志，而且同时显示每次commit的代码改变。</p>
<blockquote>
<p>git log -p</p>
</blockquote>
<p>回滚代码：</p>
<blockquote>
<p>git revert HEAD</p>
</blockquote>
<p>你也可以revert更早的commit，例如：</p>
<blockquote>
<p>git revert HEAD^</p>
</blockquote>
<p>将branchname分支合并到当前分支中。(如果合并发生冲突，需要自己解决冲突)</p>
<blockquote>
<p>git merge branchname</p>
</blockquote>
<p>解决冲突</p>
<p>当merge命令自身无法解决冲突的时候，它会将工作树置于一种特殊的状态，并且给用户提供冲突信息，以期用户可以自己解决这些问题。当然在这个时候，未发生冲突的代码已经被git merge登记在了index file里了。如果你这个时候使用git diff，显示出来的只是发生冲突的代码信息。</p>
<p>在你解决了冲突之前，发生冲突的文件会一直在index file中被标记出来。这个时候，如果你使用git commit提交的话，git会提示：filename.txt needs merge</p>
<p>在发生冲突的时候，如果你使用git status命令，那么会显示出发生冲突的具体信息。</p>
<p>在你解决了冲突之后，你可以使用如下步骤来提交：</p>
<p>第一步(如果需要增加文件)：</p>
<blockquote>
<p>git add file1</p>
</blockquote>
<p>第二步：</p>
<blockquote>
<p>git commit</p>
</blockquote>
<p>参考资料：<a href="http://blog.enjoyrails.com/2008/12/31/git%E4%B8%80%E5%88%86%E9%92%9F%E6%95%99%E7%A8%8B/" target="_blank" rel="external">《Git一分钟教程》</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-01-14T20:37:12.000Z"><a href="/2012/01/solution-to-need-of-ftp-account-in-wordpress/">Jan 14 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/01/solution-to-need-of-ftp-account-in-wordpress/">Wordpress提示填写FTP信息的解决办法</a></h1>
  

    </header>
    <div class="entry">
      
        <p>在上一篇文章《<a href="http://www.hackecho.com/" target="_blank" rel="external">VPS折腾记</a>》中提到在升级Wordpress或添加删除主题和插件的时候需要填写FTP账户信息的问题，提示一般如下：</p>
<blockquote>
<p>要执行请求的操作，WordPress 需要访问您网页服务器的权限。 请输入您的 FTP 登录凭据以继续。 如果您忘记了您的登录凭据（如用户名、密码），请联系您的网站托管商。</p>
</blockquote>
<p>一般情况下，虚拟主机很少会出现这样的情况，如果使用 VPS 的话，这种情况就会比较多。主要原因是网站服务器运行PHP的用户和Wordpress文件夹的所有者不一样，目的就是为了安全，Wordpress在升级时会创建一个临时文件看看owner是不是和当前运行的PHP是否一样，如果不一样，就会出现这个界面。</p>
<p>第一种解决办法很简单，就是直接在wp-config.php 中加入FTP的配置代码：</p>
<pre><code><span class="comment">// ** FTP SETTINGS FOR AUTO-UPDATE ** //</span>
<span class="class"><span class="keyword">define</span></span>(‘FTP_HOST’, ‘localhost’);
<span class="class"><span class="keyword">define</span></span>(‘FTP_USER’, ‘ftp帐号’);
<span class="class"><span class="keyword">define</span></span>(‘FTP_PASS’, ‘ftp密码’);
</code></pre><p>当然我们更想从根本上解决问题，那么第二种个方法，就要从用户组下手了。</p>
<p>针对有高级管理权限的用户，如服务器或 VPS 等管理员，只需将 PHP 和网站目录设置成同一个用户组即可。一般是 www 用户组跑 PHP，所以将网站所在目录内所有文件夹和文件设置成www用户组即可，输入命令：</p>
<pre><code>chown -R www <span class="regexp">/home/</span>wwwroot  
chgrp -R www <span class="regexp">/home/</span>wwwroot  
</code></pre><p>记住将上述命令中的网站目录路径改为自己的路径即可。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2011-11-20T03:39:56.000Z"><a href="/2011/11/thinking-of-multi-level-classification/">Nov 19 2011</a></time>
      
      
  
    <h1 class="title"><a href="/2011/11/thinking-of-multi-level-classification/">关于多级分类的一个思考</a></h1>
  

    </header>
    <div class="entry">
      
        <p>最近做的几个项目都设计到了多级分类，不太清楚数据表怎样设计。经过一番探究后，发现一般有以下几种解决方案：</p>
<ul>
<li>每级分类一张表</li>
</ul>
<ul>
<li>只有一张分类表</li>
</ul>
<ul>
<li>一张分类名称表+一张分类关系表</li>
</ul>
<p>第三种方法是参考了Wordpress本身的分类方法，个人感觉用在手里的项目中有点大材小用，于是主要目标是在前两种中选择一种。</p>
<p>首先来看第一种，这是一般最先想到的方法，而且相对比较简单。但马上一想就会发现这种方法的弊端，如果只有两级分类还可以凑合，但如果涉及到多级分类或无限极分类就麻烦了，如果是五级分类就会有五张表，这明显不以维护而且不符合数据库设计原则。</p>
<p>再来看第二种方案：</p>
<p>如果只有一张表，那么我们必须能够标识各个分类之间的层次关系，层级等级。第一次的设计是这样的：</p>
<blockquote>
<p>cid</p>
<p>cname（分类名称）</p>
<p>parentcid（上级分类ID）</p>
<p>cat_level（当前分类层次）</p>
</blockquote>
<p>貌似很完美的样子，而且支持无限级分类。但在使用过程中发现一个问题：虽然有一个分类层次，但排序后它们的层次还是无法直接显示出来。（在其中一个项目中曾经使用过这种方法，当时的解决方案是在View层又加了一次排序来动态的生成HTML代码，每次排序都要遍历一次父类，很恐怖。）。于是，第二次设计修改如下：</p>
<blockquote>
<p>cid</p>
<p>cname（分类名称）</p>
<p>parentcid（上级分类ID）</p>
<p>cat_level（当前分类层次）</p>
<p>cat_path（当前分类路径）</p>
</blockquote>
<p>其中增加了一个字段分类路径，意思是当前分类到顶级分类的完整路径，以一级ID,二级ID，…..，当前级ID的格式存储。如1,2,2。这样的好处是，我们按分类路径进行一下排序会发现它自然地按照层级关系读取出数据来了，层次清晰，简单明了。</p>
<p>好了，先说到这儿，关于更多的多级分类的数据表设计我们以后再深入讨论。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2011-11-17T07:57:09.000Z"><a href="/2011/11/childhood-of-programming-and-computer/">Nov 17 2011</a></time>
      
      
  
    <h1 class="title"><a href="/2011/11/childhood-of-programming-and-computer/">那些年与编程和计算机有关的小事儿</a></h1>
  

    </header>
    <div class="entry">
      
        <p>不知道写这种文章算不算回忆录，因为说回忆录未免有些早。记得初中的时候写过一本《我的小学回忆录》，将从入学一年级第一天起开始能想起来的人和事都记录了下来，如今这本未出版的手写书已不知去向，小学的记忆也越来越模糊。忽然想不如趁着现在对一些往事还尚存记忆，稍微回忆一下，也算对自己的鼓励吧。</p>
<p>从小就是一个对电脑比较感兴趣的人，有时候兴趣是没有理由的，因为那时周围很多同学使用电脑仅限于聊QQ和半条命，而我却对除此之外的一些其它东西有着非常浓厚的兴趣。印象比较深的是买了很多很多的电脑书籍，当时最惬意的事情就是趴在桌前，做完作业后看那本比砖头还厚的《电脑医院》，一看就是四五个小时，后来还照葫芦画瓢写了个破坏注册表的.reg脚本，号称是我制造的第一个电脑病毒！</p>
<p>由于很多电脑名词不明白，便买书、查资料。什么《注册表终极操作》、《BIOS配置指南》、《电脑上网故障1000问》、《榨干你的电脑》等等，还有全年的《电脑迷》、《电脑爱好者》、《IT新闻周刊》和不怎么看得懂的《CHIP新电脑》等。尤记得当时第一次重装系统时的激动，第一次电脑崩溃时的伤心，第一次编译通过一个程序，第一次入侵别人电脑等等的第一次，现在回想起来，真有一番体味。</p>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2011/11/childhood-of-programming-and-computer/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





<nav id="pagination">
  
    <a href="/page/2/" class="alignleft prev">Prev</a>
  
  
    <a href="/page/4/" class="alignright next">Next</a>
  
  <div class="clearfix"></div>
</nav></div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:hackecho.com">
  </form>
</div>

  

  
<div class="widget tag">
  <h3 class="title">Recent Posts</h3>
  <ul class="entry">
    
      <li>
        <a href="/2014/05/connecting-to-emr-masternode-via-ssh/">Connecting to EMR masternode via SSH</a>
      </li>
    
      <li>
        <a href="/2014/04/notes-about-maven/">Notes about Maven</a>
      </li>
    
      <li>
        <a href="/2014/04/hadoop-cluster-setup-instruction-with-fedora-20/">Hadoop Cluster Setup Instruction with Fedora 20</a>
      </li>
    
      <li>
        <a href="/2013/10/real-time-emotion-analysis-on-twitter/">Real-time Emotion Analysis On Twitter</a>
      </li>
    
      <li>
        <a href="/2013/04/cuda-parallel-reduction/">CUDA中并行规约（Parallel Reduction）的优化</a>
      </li>
    
      <li>
        <a href="/2013/04/basics-of-mpi/">MPI 并行程序设计基础</a>
      </li>
    
      <li>
        <a href="/2013/03/a-letter-to-myself/">写给四年前刚开始编程的自己</a>
      </li>
    
  </ul>
</div>


  <div class="widget tag">
<h3 class="title">Links</h3>
<ul class="entry">
	<li><a href="http://vicdory.com/" target="_blank" title="Kailun Shi">Kailun Shi</a></li>
	<li><a href="http://guo-min-zhi.github.io/" target="_blank" title="远方">远方</a></li>
	<li><a href="http://mingplusplus.com/blog/" target="_blank" title="Ming++">Ming++</a></li>
	<li><a href="http://ruiwu.me/" target="_blank" title="RuiWu">RuiWu</a></li>
</ul>
</div>

  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/Android/">Android</a><small>1</small></li>
  
    <li><a href="/tags/Android,AsyncTask/">Android,AsyncTask</a><small>1</small></li>
  
    <li><a href="/tags/Android,SharedPreferences/">Android,SharedPreferences</a><small>1</small></li>
  
    <li><a href="/tags/BidData/">BidData</a><small>1</small></li>
  
    <li><a href="/tags/Decorator,Python/">Decorator,Python</a><small>1</small></li>
  
    <li><a href="/tags/EMR/">EMR</a><small>1</small></li>
  
    <li><a href="/tags/GBK,Mac,UTF8/">GBK,Mac,UTF8</a><small>1</small></li>
  
    <li><a href="/tags/Git/">Git</a><small>1</small></li>
  
    <li><a href="/tags/Google+/">Google+</a><small>1</small></li>
  
    <li><a href="/tags/Hadoop/">Hadoop</a><small>1</small></li>
  
    <li><a href="/tags/JSON,XML,PHP/">JSON,XML,PHP</a><small>1</small></li>
  
    <li><a href="/tags/Life/">Life</a><small>1</small></li>
  
    <li><a href="/tags/Linux,HFS/">Linux,HFS</a><small>1</small></li>
  
    <li><a href="/tags/MPI/">MPI</a><small>1</small></li>
  
    <li><a href="/tags/MVC,-PHP/">MVC, PHP</a><small>1</small></li>
  
    <li><a href="/tags/Maven/">Maven</a><small>1</small></li>
  
    <li><a href="/tags/PHP,Socket/">PHP,Socket</a><small>1</small></li>
  
    <li><a href="/tags/Python/">Python</a><small>1</small></li>
  
    <li><a href="/tags/ThinkPHP/">ThinkPHP</a><small>1</small></li>
  
    <li><a href="/tags/WebSocket,HTML5/">WebSocket,HTML5</a><small>1</small></li>
  
    <li><a href="/tags/Wordpress/">Wordpress</a><small>2</small></li>
  
    <li><a href="/tags/boost,thread/">boost,thread</a><small>1</small></li>
  
    <li><a href="/tags/cuda,parallel,reduction/">cuda,parallel,reduction</a><small>1</small></li>
  
    <li><a href="/tags/fly-of-promgrammer/">fly-of-promgrammer</a><small>1</small></li>
  
    <li><a href="/tags/gcc/">gcc</a><small>1</small></li>
  
    <li><a href="/tags/ipc,semaphores/">ipc,semaphores</a><small>1</small></li>
  
    <li><a href="/tags/life/">life</a><small>1</small></li>
  
    <li><a href="/tags/makefile/">makefile</a><small>1</small></li>
  
    <li><a href="/tags/movie/">movie</a><small>1</small></li>
  
    <li><a href="/tags/open-source/">open source</a><small>1</small></li>
  
    <li><a href="/tags/pthread/">pthread</a><small>1</small></li>
  
    <li><a href="/tags/web/">web</a><small>1</small></li>
  
    <li><a href="/tags/websocket/">websocket</a><small>1</small></li>
  
    <li><a href="/tags/极客/">极客</a><small>1</small></li>
  
    <li><a href="/tags/程序员/">程序员</a><small>2</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2014 Zhaoyu Li
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<script type="text/javascript">
var disqus_shortname = 'zlmoment';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


<!-- InstantClick makes following links in your website instant. http://instantclick.io -->
<script src="/js/instantclick.min.js" data-no-instant></script>
<script data-no-instant>InstantClick.init();</script>
</body>
</html>